import { Meta } from '@storybook/blocks';
import { getAPIDocumentationLink, getAPIPropsLink } from './utils/get-api-documentation-link';

<Meta title="Introduction" />

# Introduction to @joint/react

**@joint/react** is a modern React wrapper for [JointJS](https://www.jointjs.com/). It simplifies building interactive diagrams and graphs in React apps with idiomatic components, hooks, and utilities to manage nodes, links, and interactions.

## üìå Core Components

### 1. {getAPIDocumentationLink('GraphProvider')}
The `GraphProvider` component provides a shared [JointJS Graph](https://docs.jointjs.com/api/dia/Graph/) context to its descendants. Wrap parts of your app that read or write graph state.

```tsx
import { GraphProvider } from '@joint/react';

<GraphProvider>
  {/* Add Paper or other components here */}
</GraphProvider>
```

### 2. {getAPIDocumentationLink('Paper')}
`Paper` renders nodes and links. It wraps the [JointJS Paper](https://docs.jointjs.com/learn/quickstart/paper/) and exposes props like {getAPIPropsLink('Paper', 'renderElement')} to control rendering. You can use multiple views in the same `GraphProvider` (e.g., main canvas + minimap). When using multiple views in development, set a unique `id` for each view to avoid conflicts.

```tsx
import { GraphProvider } from '@joint/react';

const renderElement = ({ width, height }) => (
  <rect width={width} height={height} fill="cyan" />
);

<GraphProvider>
  <Paper width={800} height={600} renderElement={renderElement} />
</GraphProvider>
```

### 3. **Rendering HTML content**
Because JointJS is SVG‚Äëbased, you have two options for HTML:
- Use SVG `<foreignObject>` (simple, but with Safari caveats)
- Use the experimental {getAPIPropsLink('Paper', 'useHTMLOverlay')} prop to render real HTML outside the SVG

```tsx
const renderElement = ({ width, height }) => (
  <foreignObject width={width} height={height}>
    <div style={{ background: 'lightgray' }}>
      HTML Content here
    </div>
  </foreignObject>
);

<GraphProvider>
  <Paper renderElement={renderElement} />
</GraphProvider>
```

## üõ†Ô∏è Core Hooks and Utilities

### üîπ Accessing Elements
- {getAPIDocumentationLink('useElements')}: Retrieve all graph elements (requires `GraphProvider` context).
- {getAPIDocumentationLink('useElement')}: Retrieve individual element data, typically used within `renderElement`.

### üîπ Modifying Elements
Use the graph APIs to update state. Hooks provide convenient access:
- {getAPIDocumentationLink('useGraph')}: Read/write the graph (e.g., `graph.setCells()`)

### üîπ Graph and Paper Instances
- {getAPIDocumentationLink('useGraph')}: Access the JointJS [Graph](https://docs.jointjs.com/api/dia/Graph/)
- {getAPIDocumentationLink('usePaper')}: Access the JointJS [Paper](https://docs.jointjs.com/learn/quickstart/paper/)

### üîπ Creating Nodes and Links
- {getAPIDocumentationLink('createElements')}: Utility for creating nodes.

```ts
import { createElements } from '@joint/react';

const initialElements = createElements([
  { id: '1', type: 'rect', x: 10, y: 10, width: 100, height: 100 },
]);
```

- {getAPIDocumentationLink('createLinks')}: Utility for creating links between nodes.

```ts
import { createLinks } from '@joint/react';

const initialLinks = createLinks([
  { source: '1', target: '2', id: '1-2' },
]);
```

---

## How It Works

Under the hood, **@joint/react** listens to changes in `dia.Graph`, which acts as the single source of truth. When you update the graph (add/modify cells), React components subscribe and re-render accordingly. Access the graph via `useGraph()` to perform updates like `graph.setCells()`.

---

## Known Issues

### Avoid Certain CSS Properties in `<foreignObject>`
Some CSS properties can cause rendering issues in Safari when used inside an SVG `<foreignObject>`. To ensure compatibility, avoid the following properties:

- `position` (other than `static`)
- `-webkit-transform-style`
- `-webkit-backface-visibility`
- `transition`
- `transform`

### Recommended Workaround
If you need to use HTML inside an SVG with cross-browser support:

- Use minimal CSS inside `<foreignObject>`.
- Stick to static positioning and avoid CSS transforms.
- Consider overlaying HTML outside the SVG using absolute positioning.

### Flickering
React's asynchronous rendering can cause flickering when dynamically adding ports or resizing elements. We are aware of this issue and are working on a fix.

### Controlled Mode
Currently, **@joint/react** uses `useSyncExternalStore` to listen to graph changes. The graph is the source of truth, so `initialElements` and `initialLinks` are only used during initialization. To modify state, update the graph directly via hooks like `useGraph`. A fully controlled mode is under development.
