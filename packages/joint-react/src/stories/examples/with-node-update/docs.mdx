import { Meta, Story, Canvas, Controls, Markdown } from '@storybook/blocks';
import * as Stories from './story';
import Code from './code?raw';
import CodeWithColorPicker from './code-with-color?raw';
import CodeWithSVG from './code-with-svg?raw';
import CodeNodeRemove from './code-add-remove-node?raw';

<Meta of={Stories} />

# Updating Nodes Dynamically

This guide demonstrates various ways to update nodes (elements) in your diagram using the `useCellActions` hook. Learn how to modify element properties, add new elements, and remove existing ones.

## Overview

The `useCellActions` hook provides methods to modify the graph state:
- **set**: Update existing element properties
- **insert**: Add new elements or links
- **remove**: Delete elements or links

## Basic Node Update

The simplest way to update a node is using the `set` method with an updater function.

<Canvas of={Stories.Default} />

<Markdown>
{`\`\`\`tsx
${Code}
\`\`\``}
</Markdown>

## Update with Color Picker

This example shows how to update node properties dynamically based on user input, such as a color picker.

<Canvas of={Stories.WithColorPicker} />

<Markdown>
{`\`\`\`tsx
${CodeWithColorPicker}
\`\`\``}
</Markdown>

## Update with SVG Rendering

Demonstrates updating nodes that are rendered as SVG elements, showing how property changes affect the visual representation.

<Canvas of={Stories.WithSVG} />

<Markdown>
{`\`\`\`tsx
${CodeWithSVG}
\`\`\``}
</Markdown>

## Add and Remove Nodes

This example shows how to dynamically add and remove nodes from the graph, enabling interactive diagram editing.

<Canvas of={Stories.WithNodeRemove} />

<Markdown>
{`\`\`\`tsx
${CodeNodeRemove}
\`\`\``}
</Markdown>

## Key Patterns

### Updating Properties

```tsx
const { set } = useCellActions();

// Update a single property
set('element-id', (prev) => ({ ...prev, label: 'New Label' }));

// Update multiple properties
set('element-id', (prev) => ({ 
  ...prev, 
  x: 100, 
  y: 200,
  color: 'blue' 
}));
```

### Adding Elements

```tsx
const { insert } = useCellActions();

insert('elements', {
  id: 'new-element',
  x: 100,
  y: 100,
  width: 100,
  height: 50,
});
```

### Removing Elements

```tsx
const { remove } = useCellActions();

remove('element-id');
```

## Best Practices

1. **Immutable updates**: Always return new objects in updater functions
2. **Type safety**: Use TypeScript to ensure correct property types
3. **Batch updates**: Consider batching multiple updates for performance
4. **Error handling**: Validate element IDs before updating




