/*! JointJS v3.0.0-beta (2019-06-06) - JavaScript diagramming library


This Source Code Form is subject to the terms of the Mozilla Public
License, v. 2.0. If a copy of the MPL was not distributed with this
file, You can obtain one at http://mozilla.org/MPL/2.0/.
*/
this.joint=this.joint||{},this.joint.shapes=this.joint.shapes||{},function(t,n,i,P,R,M){"use strict";n=n&&n.hasOwnProperty("default")?n.default:n,i=i&&i.hasOwnProperty("default")?i.default:i,P=P&&P.hasOwnProperty("default")?P.default:P,R=R&&R.hasOwnProperty("default")?R.default:R;var e,r,o="joint-",s=function(t){return t?t.toString().split(" ").map(function(t){return t.substr(0,o.length)!==o&&(t=o+t),t}).join(" "):t},a=function(t,e){for(var i={},r={},n=R.namespace.svg,o=e||n,s=document.createDocumentFragment(),a=[t,s,o];0<a.length;){o=a.pop();for(var l=a.pop(),h=a.pop(),f=0,u=h.length;f<u;f++){var c=h[f];if(!c.hasOwnProperty("tagName"))throw new Error("json-dom-parser: missing tagName");var d=c.tagName;c.hasOwnProperty("namespaceURI")&&(o=c.namespaceURI);var p=document.createElementNS(o,d),g=o===n,m=g?R:P,v=c.attributes;v&&m(p).attr(v);var y=c.style;if(y&&P(p).css(y),c.hasOwnProperty("className")){var b=c.className;g?p.className.baseVal=b:p.className=b}if(c.hasOwnProperty("textContent")&&(p.textContent=c.textContent),c.hasOwnProperty("selector")){var k=c.selector;if(i[k])throw new Error("json-dom-parser: selector must be unique");m(i[k]=p).attr("joint-selector",k)}if(c.hasOwnProperty("groupSelector")){var x=c.groupSelector;Array.isArray(x)||(x=[x]);for(var w=0,C=x.length;w<C;w++){var A=x[w],E=r[A];E||(E=r[A]=[]),E.push(p)}}l.appendChild(p);var L=c.children;Array.isArray(L)&&a.push(L,p,o)}}return{fragment:s,selectors:i,groupSelectors:r}},m=function(t,e,i){for(var r,n=Array.isArray(e)?e.slice():e.split(i||"/");n.length;){if(r=n.shift(),!(Object(t)===t&&r in t))return;t=t[r]}return t},v=function(t,e,i,r){for(var n=Array.isArray(e)?e:e.split(r||"/"),o=t,s=0,a=n.length;s<a-1;s++)o=o[n[s]]||(o[n[s]]={});return o[n[a-1]]=i,t},y=function(t,e,i){i=i||"/";var r=Array.isArray(e)?e.slice():e.split(i),n=r.pop();if(0<r.length){var o=m(t,r,i);o&&delete o[n]}else delete t[n];return t},l=function(t){return l.id=l.id||1,t.id=void 0===t.id?"j_"+l.id++:t.id,t.id},h=function(){var n;if("undefined"!=typeof window&&(n=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame),!n){var o=0;n=function(t){var e=(new Date).getTime(),i=Math.max(0,16-(e-o)),r=setTimeout(function(){t(e+i)},i);return o=e+i,r}}return function(t,e){for(var i=[],r=arguments.length-2;0<r--;)i[r]=arguments[r+2];return n(void 0!==e?t.bind.apply(t,[e].concat(i)):t)}}(),f=((r="undefined"!=typeof window)&&(e=window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.webkitCancelRequestAnimationFrame||window.msCancelAnimationFrame||window.msCancelRequestAnimationFrame||window.oCancelAnimationFrame||window.oCancelRequestAnimationFrame||window.mozCancelAnimationFrame||window.mozCancelRequestAnimationFrame),e=e||clearTimeout,r?e.bind(window):e),u=function(t){return $(t)&&"%"===t.slice(-1)},F=function(t,e){var i=parseFloat(t);if(Number.isNaN(i))return null;var r,n={};if(n.value=i,null==e)r="[A-Za-z]*";else if(Array.isArray(e)){if(0===e.length)return null;r=e.join("|")}else $(e)&&(r=e);var o,s=(o=new RegExp("(?:\\d+(?:\\.\\d+)*)("+r+")$").exec(t))?o[1]:null;return null===s?null:(n.unit=s,n)},c=function(t,e,i,r){r=r||{},i=i||{};var n=e.width,o=e.height,s=r.svgDocument||R("svg").node,a=R("tspan").node,l=R("text").attr(i).append(a).node,h=document.createTextNode("");l.style.opacity=0,l.style.display="block",a.style.display="block",a.appendChild(h),s.appendChild(l),r.svgDocument||document.body.appendChild(s);for(var f,u,c,d=r.separator||" ",p=r.eol||"\n",g=r.hyphen?new RegExp(r.hyphen):/[^\w\d]/,m=t.split(d),v=[],y=[],b=0,k=0,x=m.length;b<x;b++){var w=m[b];if(w)if(p&&0<=w.indexOf(p))if(1<w.length){for(var C=w.split(p),A=0,E=C.length-1;A<E;A++)C.splice(2*A+1,0,p);Array.prototype.splice.apply(m,[b,1].concat(C)),b--,x+=C.length-1}else k++;else{if(h.data=y[k]?y[k]+" "+w:w,a.getComputedTextLength()<=n)y[k]=h.data,(f||u)&&(v[k++]=!0,u=f=0);else{if(!y[k]||f){var L=!!f;if(f=w.length-1,L||!f){if(!f){if(!y[k]){y=[];break}m.splice(b,2,w+m[b+1]),x--,v[k++]=!0,b--;continue}m[b]=w.substring(0,f),m[b+1]=w.substring(f)+m[b+1]}else{if(u)m.splice(b,2,m[b]+m[b+1]),u=0;else{var P=w.search(g);-1<P&&P!==w.length-1&&0!==P&&(u=P+1,f=0),m.splice(b,1,w.substring(0,u||f),w.substring(u||f)),x++}k&&!v[k-1]&&k--}b--;continue}k++,b--}if(void 0!==o){var M;if(void 0===c)c=(M="auto"===i.lineHeight?{value:1.5,unit:"em"}:F(i.lineHeight,["em"])||{value:1,unit:"em"}).value,"em"===M.unit&&(c*=l.getBBox().height);if(c*y.length>o){var z=Math.floor(o/c)-1;y.splice(z+1);var N=r.ellipsis;if(!N||z<0)break;"string"!=typeof N&&(N="â€¦");var T,_,S=y[z],B=S.length;do{if(_=S[B],T=S.substring(0,B),_?_.match(d)&&(T+=_):T+="string"==typeof d?d:" ",T+=N,h.data=T,a.getComputedTextLength()<=n){y[z]=T;break}B--}while(0<=B);break}}}}return r.svgDocument?s.removeChild(l):document.body.removeChild(s),y.join(p)},d={linear:function(t){return t},quad:function(t){return t*t},cubic:function(t){return t*t*t},inout:function(t){if(t<=0)return 0;if(1<=t)return 1;var e=t*t,i=e*t;return 4*(t<.5?i:3*(t-e)+i-.75)},exponential:function(t){return Math.pow(2,10*(t-1))},bounce:function(t){for(var e=0,i=1;;e+=i,i/=2)if((7-4*e)/11<=t){var r=(11-6*e-11*t)/4;return-r*r+i*i}},reverse:function(e){return function(t){return 1-e(1-t)}},reflect:function(e){return function(t){return.5*(t<.5?e(2*t):2-e(2-2*t))}},clamp:function(i,r,n){return r=r||0,n=n||1,function(t){var e=i(t);return e<r?r:n<e?n:e}},back:function(e){return e||(e=1.70158),function(t){return t*t*((e+1)*t-e)}},elastic:function(e){return e||(e=1.5),function(t){return Math.pow(2,10*(t-1))*Math.cos(20*Math.PI*e/3*t)}}},p={number:function(e,t){var i=t-e;return function(t){return e+i*t}},object:function(n,o){var s=Object.keys(n);return function(t){var e,i,r={};for(e=s.length-1;-1!=e;e--)r[i=s[e]]=n[i]+(o[i]-n[i])*t;return r}},hexColor:function(t,e){var i=parseInt(t.slice(1),16),r=parseInt(e.slice(1),16),n=255&i,o=(255&r)-n,s=65280&i,a=(65280&r)-s,l=16711680&i,h=(16711680&r)-l;return function(t){return"#"+(1<<24|n+o*t&255|s+a*t&65280|l+h*t&16711680).toString(16).slice(1)}},unit:function(e,t){var i=/(-?[0-9]*.[0-9]*)(px|em|cm|mm|in|pt|pc|%)/,r=i.exec(e),n=i.exec(t),o=n[1].indexOf("."),s=0<o?n[1].length-o-1:0;e=+r[1];var a=+n[1]-e,l=r[2];return function(t){return(e+a*t).toFixed(s)+l}}},C=(i.assign,i.defaults,i.defaultsDeep,i.assign),b=i.defaults,k=i.defaultsDeep,x=i.invokeMap||i.invoke,w=i.sortedIndexBy||i.sortedIndex,A=i.uniqBy||i.uniq,E=(i.clone,i.cloneDeep),L=i.isEmpty,z=i.isEqual,N=i.isFunction,T=i.isPlainObject,_=i.toArray,S=(i.debounce,i.groupBy),B=(i.sortBy,i.flattenDeep,i.without),j=(i.difference,i.intersection,i.union,i.has),O=i.result,D=i.omit,I=i.pick,V=(i.bindAll,i.forIn),q=(i.camelCase,i.uniqueId),G=function(){if(i.mergeWith){var t=Array.from(arguments),e=t[t.length-1],r=N(e)?e:H;return t.push(function(t,e){var i=r(t,e);return void 0!==i?i:Array.isArray(t)&&!Array.isArray(e)?e:void 0}),i.mergeWith.apply(this,t)}return i.merge.apply(this,arguments)},U=function(t){return!!t&&("object"==typeof t||"function"==typeof t)},W=function(t){var e=Object.prototype.toString;return"number"==typeof t||!!t&&"object"==typeof t&&"[object Number]"===e.call(t)},$=function(t){var e=Object.prototype.toString;return"string"==typeof t||!!t&&"object"==typeof t&&"[object String]"===e.call(t)},H=function(){};function K(o,s){return function(t,e){var i=u(t);t=parseFloat(t),i&&(t/=100);var r={};if(isFinite(t)){var n=i||0<=t&&t<=1?t*e[s]:Math.max(t+e[s],0);r[o]=n}return r}}function Z(s,a,l){return function(t,e){var i,r=u(t);if(t=parseFloat(t),r&&(t/=100),isFinite(t)){var n=e[l]();i=r||0<t&&t<1?n[s]+e[a]*t:n[s]+t}var o=M.Point();return o[s]=i||0,o}}function J(n,o,s){return function(t,e){var i;i="middle"===t?e[o]/2:t===s?e[o]:isFinite(t)?-1<t&&t<1?-e[o]*t:-t:u(t)?e[o]*parseFloat(t)/100:0;var r=M.Point();return r[n]=-(e[n]+i),r}}function Y(d,t){var p="joint-shape",g=t&&t.resetOffset;return function(t,e,i){var r=P(i),n=r.data(p);if(!n||n.value!==t){var o=d(t);n={value:t,shape:o,shapeBBox:o.bbox()},r.data(p,n)}var s=n.shape.clone(),a=n.shapeBBox.clone(),l=a.origin(),h=e.origin();a.x=h.x,a.y=h.y;var f=e.maxRectScaleToFit(a,h),u=0===a.width||0===e.width?1:f.sx,c=0===a.height||0===e.height?1:f.sy;return s.scale(u,c,l),g&&s.translate(-l.x,-l.y),s}}function X(t){var r=Y(function(t){return new M.Path(R.normalizePathData(t))},t);return function(t,e,i){return{d:r(t,e,i).serialize()}}}function Q(t){var r=Y(M.Polyline,t);return function(t,e,i){return{points:r(t,e,i).serialize()}}}function tt(n,o){var s=new M.Point(1,0);return function(t){var e,i,r=this[n](t);return r?(i=o.rotate?r.vector().vectorAngle(s):0,e=r.start):(e=this.path.start,i=0),0===i?{transform:"translate("+e.x+","+e.y+")"}:{transform:"translate("+e.x+","+e.y+") rotate("+i+")"}}}function et(t,e,i){return void 0!==i.text}function it(){return this.model.isLink()}function rt(t){var e={},i=t.stroke;"string"==typeof i&&(e.stroke=i,e.fill=i);var r=t.strokeOpacity;return void 0===r&&(r=t["stroke-opacity"]),void 0===r&&(r=t.opacity),void 0!==r&&(e["stroke-opacity"]=r,e["fill-opacity"]=r),e}var nt,ot,st={xlinkHref:{set:"xlink:href"},xlinkShow:{set:"xlink:show"},xlinkRole:{set:"xlink:role"},xlinkType:{set:"xlink:type"},xlinkArcrole:{set:"xlink:arcrole"},xlinkTitle:{set:"xlink:title"},xlinkActuate:{set:"xlink:actuate"},xmlSpace:{set:"xml:space"},xmlBase:{set:"xml:base"},xmlLang:{set:"xml:lang"},preserveAspectRatio:{set:"preserveAspectRatio"},requiredExtension:{set:"requiredExtension"},requiredFeatures:{set:"requiredFeatures"},systemLanguage:{set:"systemLanguage"},externalResourcesRequired:{set:"externalResourceRequired"},filter:{qualify:T,set:function(t){return"url(#"+this.paper.defineFilter(t)+")"}},fill:{qualify:T,set:function(t){return"url(#"+this.paper.defineGradient(t)+")"}},stroke:{qualify:T,set:function(t){return"url(#"+this.paper.defineGradient(t)+")"}},sourceMarker:{qualify:T,set:function(t,e,i,r){return t=C(rt(r),t),{"marker-start":"url(#"+this.paper.defineMarker(t)+")"}}},targetMarker:{qualify:T,set:function(t,e,i,r){return t=C(rt(r),{transform:"rotate(180)"},t),{"marker-end":"url(#"+this.paper.defineMarker(t)+")"}}},vertexMarker:{qualify:T,set:function(t,e,i,r){return t=C(rt(r),t),{"marker-mid":"url(#"+this.paper.defineMarker(t)+")"}}},text:{qualify:function(t,e,i){return!i.textWrap||!T(i.textWrap)},set:function(t,e,i,r){var n=P(i),o="joint-text",s=n.data(o),a=I(r,"lineHeight","annotations","textPath","x","textVerticalAnchor","eol"),l=a.fontSize=r["font-size"]||r.fontSize,h=JSON.stringify([t,a]);if(void 0===s||s!==h){l&&i.setAttribute("font-size",l);var f=a.textPath;if(U(f)){var u=f.selector;if("string"==typeof u){var c=this.findBySelector(u)[0];c instanceof SVGPathElement&&(a.textPath=C({"xlink:href":"#"+c.id},f))}}R(i).text(""+t,a),n.data(o,h)}}},textWrap:{qualify:T,set:function(t,e,i,r){var n=t.width||0;u(n)?e.width*=parseFloat(n)/100:n<=0?e.width+=n:e.width=n;var o,s=t.height||0;u(s)?e.height*=parseFloat(s)/100:s<=0?e.height+=s:e.height=s;var a=t.text;void 0===a&&(a=r.text),o=void 0!==a?c(""+a,e,{"font-weight":r["font-weight"]||r.fontWeight,"font-size":r["font-size"]||r.fontSize,"font-family":r["font-family"]||r.fontFamily,lineHeight:r.lineHeight},{svgDocument:this.paper.svg,ellipsis:t.ellipsis,hyphen:t.hyphen}):"",st.text.set.call(this,o,e,i,r)}},title:{qualify:function(t,e){return e instanceof SVGElement},set:function(t,e,i){var r=P(i),n="joint-title",o=r.data(n);if(void 0===o||o!==t){r.data(n,t);var s=i.firstChild;if(s&&"TITLE"===s.tagName.toUpperCase())s.textContent=t;else{var a=document.createElementNS(i.namespaceURI,"title");a.textContent=t,i.insertBefore(a,s)}}}},lineHeight:{qualify:et},textVerticalAnchor:{qualify:et},textPath:{qualify:et},annotations:{qualify:et},port:{set:function(t){return null===t||void 0===t.id?t:t.id}},style:{qualify:T,set:function(t,e,i){P(i).css(t)}},html:{set:function(t,e,i){P(i).html(t+"")}},ref:{},refX:{position:Z("x","width","origin")},refY:{position:Z("y","height","origin")},refDx:{position:Z("x","width","corner")},refDy:{position:Z("y","height","corner")},refWidth:{set:K("width","width")},refHeight:{set:K("height","height")},refRx:{set:K("rx","width")},refRy:{set:K("ry","height")},refRInscribed:{set:(nt=K("r","width"),ot=K("r","height"),function(t,e){return(e.height>e.width?nt:ot)(t,e)})},refRCircumscribed:{set:function(t,e){var i=u(t);t=parseFloat(t),i&&(t/=100);var r,n=Math.sqrt(e.height*e.height+e.width*e.width);return isFinite(t)&&(r=i||0<=t&&t<=1?t*n:Math.max(t+n,0)),{r:r}}},refCx:{set:K("cx","width")},refCy:{set:K("cy","height")},xAlignment:{offset:J("x","width","right")},yAlignment:{offset:J("y","height","bottom")},resetOffset:{offset:function(t,e){return t?{x:-e.x,y:-e.y}:{x:0,y:0}}},refDResetOffset:{set:X({resetOffset:!0})},refDKeepOffset:{set:X({resetOffset:!1})},refPointsResetOffset:{set:Q({resetOffset:!0})},refPointsKeepOffset:{set:Q({resetOffset:!1})},connection:{qualify:it,set:function(){return{d:this.getSerializedConnection()}}},atConnectionLengthKeepGradient:{qualify:it,set:tt("getTangentAtLength",{rotate:!0})},atConnectionLengthIgnoreGradient:{qualify:it,set:tt("getTangentAtLength",{rotate:!1})},atConnectionRatioKeepGradient:{qualify:it,set:tt("getTangentAtRatio",{rotate:!0})},atConnectionRatioIgnoreGradient:{qualify:it,set:tt("getTangentAtRatio",{rotate:!1})}};st.refR=st.refRInscribed,st.refD=st.refDResetOffset,st.refPoints=st.refPointsResetOffset,st.atConnectionLength=st.atConnectionLengthKeepGradient,st.atConnectionRatio=st.atConnectionRatioKeepGradient,st.refX2=st.refX,st.refY2=st.refY,st.refWidth2=st.refWidth,st.refHeight2=st.refHeight,st["ref-x"]=st.refX,st["ref-y"]=st.refY,st["ref-dy"]=st.refDy,st["ref-dx"]=st.refDx,st["ref-width"]=st.refWidth,st["ref-height"]=st.refHeight,st["x-alignment"]=st.xAlignment,st["y-alignment"]=st.yAlignment;var at=st,lt=n.Model.extend({constructor:function(t,e){var i,r=t||{};this.cid=q("c"),this.attributes={},e&&e.collection&&(this.collection=e.collection),e&&e.parse&&(r=this.parse(r,e)||{}),(i=O(this,"defaults"))&&(r=G({},i,r)),this.set(r,e),this.changed={},this.initialize.apply(this,arguments)},translate:function(t,e,i){throw new Error("Must define a translate() method.")},toJSON:function(){var e=this.constructor.prototype.defaults.attrs||{},t=this.attributes.attrs,o={};V(t,function(t,r){var n=e[r];V(t,function(t,i){U(t)&&!Array.isArray(t)?V(t,function(t,e){n&&n[i]&&z(n[i][e],t)||(o[r]=o[r]||{},(o[r][i]||(o[r][i]={}))[e]=t)}):n&&z(n[i],t)||(o[r]=o[r]||{},o[r][i]=t)})});var i=E(D(this.attributes,"attrs"));return i.attrs=o,i},initialize:function(t){t&&t.id||this.set("id",this.generateId(),{silent:!0}),this._transitionIds={},this.processPorts(),this.on("change:attrs",this.processPorts,this)},generateId:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)})},processPorts:function(){var t=this.ports,i={};V(this.get("attrs"),function(t,e){t&&t.port&&(void 0!==t.port.id?i[t.port.id]=t.port:i[t.port]={id:t.port})});var r={};(V(t,function(t,e){i[e]||(r[e]=!0)}),this.graph&&!L(r))&&(this.graph.getConnectedLinks(this,{inbound:!0}).forEach(function(t){r[t.get("target").port]&&t.remove()}),this.graph.getConnectedLinks(this,{outbound:!0}).forEach(function(t){r[t.get("source").port]&&t.remove()}));this.ports=i},remove:function(t){t=t||{};var e=this.graph;if(!e)return this.collection&&this.collection.remove(this,t),this;e.startBatch("remove");var i=this.getParentCell();i&&i.unembed(this);for(var r=this.getEmbeddedCells(),n=0,o=r.length;n<o;n++){var s=r[n];s&&s.remove(t)}return this.trigger("remove",this,e.attributes.cells,t),e.stopBatch("remove"),this},toFront:function(i){var t=this.graph;if(t){i=i||{};var e,r=t.maxZIndex();i.deep?(e=this.getEmbeddedCells({deep:!0,breadthFirst:!0})).unshift(this):e=[this],r=r-e.length+1;var n=t.get("cells"),o=n.indexOf(this)!==n.length-e.length;o||(o=e.some(function(t,e){return t.get("z")!==r+e})),o&&(this.startBatch("to-front"),r+=e.length,e.forEach(function(t,e){t.set("z",r+e,i)}),this.stopBatch("to-front"))}return this},toBack:function(i){var t=this.graph;if(t){i=i||{};var e,r=t.minZIndex();i.deep?(e=this.getEmbeddedCells({deep:!0,breadthFirst:!0})).unshift(this):e=[this];var n=0!==t.get("cells").indexOf(this);n||(n=e.some(function(t,e){return t.get("z")!==r+e})),n&&(this.startBatch("to-back"),r-=e.length,e.forEach(function(t,e){t.set("z",r+e,i)}),this.stopBatch("to-back"))}return this},parent:function(t,e){return void 0===t?this.get("parent"):this.set("parent",t,e)},embed:function(t,e){if(this===t||this.isEmbeddedIn(t))throw new Error("Recursive embedding not allowed.");this.startBatch("embed");var i=C([],this.get("embeds"));return i[t.isLink()?"unshift":"push"](t.id),t.parent(this.id,e),this.set("embeds",A(i),e),this.stopBatch("embed"),this},unembed:function(t,e){return this.startBatch("unembed"),t.unset("parent",e),this.set("embeds",B(this.get("embeds"),t.id),e),this.stopBatch("unembed"),this},getParentCell:function(){var t=this.parent(),e=this.graph;return t&&e&&e.getCell(t)||null},getAncestors:function(){var t=[];if(!this.graph)return t;for(var e=this.getParentCell();e;)t.push(e),e=e.getParentCell();return t},getEmbeddedCells:function(e){if(e=e||{},this.graph){var i;if(e.deep)if(e.breadthFirst){i=[];for(var t=this.getEmbeddedCells();0<t.length;){var r=t.shift();i.push(r),t.push.apply(t,r.getEmbeddedCells())}}else(i=this.getEmbeddedCells()).forEach(function(t){i.push.apply(i,t.getEmbeddedCells(e))});else i=_(this.get("embeds")).map(this.graph.getCell,this.graph);return i}return[]},isEmbeddedIn:function(t,e){var i=$(t)?t:t.id,r=this.parent();if(e=b({deep:!0},e),this.graph&&e.deep){for(;r;){if(r===i)return!0;r=this.graph.getCell(r).parent()}return!1}return r===i},isEmbedded:function(){return!!this.parent()},clone:function(t){if((t=t||{}).deep)return _(function(t){t=A(t);var s=_(t).reduce(function(t,e){return t[e.id]=e.clone(),t},{});return _(t).forEach(function(t){var e=s[t.id];if(e.isLink()){var i=e.source(),r=e.target();i.id&&s[i.id]&&e.prop("source/id",s[i.id].id),r.id&&s[r.id]&&e.prop("target/id",s[r.id].id)}var n=t.get("parent");n&&s[n]&&e.set("parent",s[n].id);var o=_(t.get("embeds")).reduce(function(t,e){return s[e]&&t.push(s[e].id),t},[]);L(o)||e.set("embeds",o)}),s}([this].concat(this.getEmbeddedCells({deep:!0}))));var e=n.Model.prototype.clone.apply(this,arguments);return e.set("id",this.generateId()),e.unset("embeds"),e.unset("parent"),e},prop:function(t,e,i){var r=$(t);if(r||Array.isArray(t)){if(1<arguments.length){var n,o,s=(o=r?(n=t).split("/"):(n=t.join("/"),t.slice()))[0],a=o.length;if((i=i||{}).propertyPath=n,i.propertyValue=e,i.propertyPathArray=o,1===a)return this.set(s,e,i);for(var l={},h=l,f=s,u=1;u<a;u++){var c=o[u],d=Number.isFinite(r?Number(c):c);h=h[f]=d?[]:{},f=c}l=v(l,o,e,"/");var p=G({},this.attributes);i.rewrite&&y(p,n,"/");var g=G(p,l);return this.set(s,g[s],i)}return m(this.attributes,t,"/")}return this.set(G({},this.attributes,t),e)},removeProp:function(t,e){e=e||{};var i=Array.isArray(t)?t:t.split("/"),r=i[0];if("attrs"===r&&(e.dirty=!0),1===i.length)return this.unset(t,e);var n=i.slice(1),o=E(this.get(r));return y(o,n,"/"),this.set(r,o,e)},attr:function(t,e,i){var r=Array.from(arguments);return 0===r.length?this.get("attrs"):(Array.isArray(t)?r[0]=["attrs"].concat(t):$(t)?r[0]="attrs/"+t:r[0]={attrs:t},this.prop.apply(this,r))},removeAttr:function(t,e){return Array.isArray(t)?this.removeProp(["attrs"].concat(t)):this.removeProp("attrs/"+t,e)},transition:function(n,e,o,i){i=i||"/",o=C({duration:100,delay:10,timingFunction:d.linear,valueFunction:p.number},o);var s,a=0,l=function(t){var e,i,r;(i=(t-=a=a||t)/o.duration)<1?this._transitionIds[n]=e=h(l):(i=1,delete this._transitionIds[n]),r=s(o.timingFunction(i)),o.transitionId=e,this.prop(n,r,o),e||this.trigger("transition:end",this,n)}.bind(this),t=function(t){this.stopTransitions(n),s=o.valueFunction(m(this.attributes,n,i),e),this._transitionIds[n]=h(t),this.trigger("transition:start",this,n)}.bind(this);return setTimeout(t,o.delay,l)},getTransitions:function(){return Object.keys(this._transitionIds)},stopTransitions:function(t,e){e=e||"/";var i=t&&t.split(e);return Object.keys(this._transitionIds).filter(i&&function(t){return z(i,t.split(e).slice(0,i.length))}).forEach(function(t){f(this._transitionIds[t]),delete this._transitionIds[t],this.trigger("transition:end",this,t)},this),this},addTo:function(t,e){return t.addCell(this,e),this},findView:function(t){return t.findViewByModel(this)},isElement:function(){return!1},isLink:function(){return!1},startBatch:function(t,e){return this.graph&&this.graph.startBatch(t,C({},e,{cell:this})),this},stopBatch:function(t,e){return this.graph&&this.graph.stopBatch(t,C({},e,{cell:this})),this},getChangeFlag:function(t){var e=0;if(!t)return e;for(var i in t)t.hasOwnProperty(i)&&this.hasChanged(i)&&(e|=t[i]);return e},angle:function(){return 0},position:function(){return new g.Point(0,0)},getPointFromConnectedLink:function(){return new g.Point},getBBox:function(){return new g.Rect(0,0,0,0)}},{getAttributeDefinition:function(t){var e=this.attributes,i=at;return e&&e[t]||i[t]},define:function(t,e,i,r){i=C({defaults:k({type:t},e,this.prototype.defaults)},i);var n=this.extend(i,r);return"undefined"!=typeof joint&&j(joint,"shapes")&&v(joint.shapes,t,n,"."),n}});function ht(t,e,i){var r=t.toJSON();return r.angle=e||0,b({},i,r)}function ft(t,e,i){return t.map(function(t,e,i){var r=this.pointAt((e+.5)/i.length);return(t.dx||t.dy)&&r.offset(t.dx||0,t.dy||0),ht(r.round(),0,t)},M.line(e,i))}function ut(t,e,s,a){var l=e.center(),h=e.width/e.height,f=e.topMiddle(),u=M.Ellipse.fromRect(e);return t.map(function(t,e,i){var r=s+a(e,i.length),n=f.clone().rotate(l,-r).scale(h,1,l),o=t.compensateRotation?-u.tangentTheta(n):0;return(t.dx||t.dy)&&n.offset(t.dx||0,t.dy||0),t.dr&&n.move(l,t.dr),ht(n.round(),o,t)})}function ct(t,e){var i=e.x;$(i)&&(i=parseFloat(i)/100*t.width);var r=e.y;return $(r)&&(r=parseFloat(r)/100*t.height),M.point(i||0,r||0)}var dt=Object.freeze({absolute:function(t,e,i){return t.map(ct.bind(null,e))},fn:function(t,e,i){return i.fn(t,e,i)},line:function(t,e,i){return ft(t,ct(e,i.start||e.origin()),ct(e,i.end||e.corner()))},left:function(t,e,i){return ft(t,e.origin(),e.bottomLeft())},right:function(t,e,i){return ft(t,e.topRight(),e.corner())},top:function(t,e,i){return ft(t,e.origin(),e.topRight())},bottom:function(t,e,i){return ft(t,e.bottomLeft(),e.corner())},ellipseSpread:function(t,e,i){var r=i.startAngle||0,n=i.step||360/t.length;return ut(t,e,r,function(t){return t*n})},ellipse:function(t,e,i){var r=i.startAngle||0,n=i.step||20;return ut(t,e,r,function(t,e){return(t+.5-e/2)*n})}});function pt(t,e){return k({},t,e,{x:0,y:0,angle:0,attrs:{".":{y:"0","text-anchor":"start"}}})}function gt(t,e,i,r){r=b({},r,{offset:15});var n,o,s,a,l=e.center().theta(t),h=mt(e),f=r.offset,u=0;a=l<h[1]||l>h[2]?(s=".3em",n=f,o=0,"start"):l<h[0]?(s="0",n=0,o=-f,i?(u=-90,"start"):"middle"):l<h[3]?(s=".3em",n=-f,o=0,"end"):(s=".6em",n=0,o=f,i?(u=90,"start"):"middle");var c=Math.round;return pt({x:c(n),y:c(o),angle:u,attrs:{".":{y:s,"text-anchor":a}}})}function mt(t){var e=t.center(),i=e.theta(t.origin()),r=e.theta(t.bottomLeft()),n=e.theta(t.corner());return[i,e.theta(t.topRight()),n,r]}function vt(t,e,i,r){var n,o,s,a,l=e.center().theta(t),h=(r=b({},r,{offset:15})).offset,f=0,u=mt(e);a=l<u[1]||l>u[2]?(s=".3em",n=-h,o=0,"end"):l<u[0]?(s=".6em",n=0,o=h,i?(f=90,"start"):"middle"):l<u[3]?(s=".3em",n=h,o=0,"start"):(s="0em",n=0,o=-h,i?(f=-90,"start"):"middle");var c=Math.round;return pt({x:c(n),y:c(o),angle:f,attrs:{".":{y:s,"text-anchor":a}}})}function yt(t,e,i){i=b({},i,{offset:20});var r,n=M.point(0,0),o=-t.theta(n),s=o,a=t.clone().move(n,i.offset).difference(t).round(),l=".3em";(o+90)%180==0?(r=e?"end":"middle",e||-270!==o||(l="0em")):-270<o&&o<-90?(r="start",s=o-180):r="end";var h=Math.round;return pt({x:h(a.x),y:h(a.y),angle:e?s:0,attrs:{".":{y:l,"text-anchor":r}}})}var bt=Object.freeze({manual:function(t,e,i){return pt(i,e)},left:function(t,e,i){return pt(i,{x:-15,attrs:{".":{y:".3em","text-anchor":"end"}}})},right:function(t,e,i){return pt(i,{x:15,attrs:{".":{y:".3em","text-anchor":"start"}}})},top:function(t,e,i){return pt(i,{y:-15,attrs:{".":{"text-anchor":"middle"}}})},bottom:function(t,e,i){return pt(i,{y:15,attrs:{".":{y:".6em","text-anchor":"middle"}}})},outsideOriented:function(t,e,i){return gt(t,e,!0,i)},outside:function(t,e,i){return gt(t,e,!1,i)},insideOriented:function(t,e,i){return vt(t,e,!0,i)},inside:function(t,e,i){return vt(t,e,!1,i)},radial:function(t,e,i){return yt(t.difference(e.center()),!1,i)},radialOriented:function(t,e,i){return yt(t.difference(e.center()),!0,i)}}),kt=function(t){var e=E(t)||{};this.ports=[],this.groups={},this.portLayoutNamespace=dt,this.portLabelLayoutNamespace=bt,this._init(e)};kt.prototype={getPorts:function(){return this.ports},getGroup:function(t){return this.groups[t]||{}},getPortsByGroup:function(e){return this.ports.filter(function(t){return t.group===e})},getGroupPortsMetrics:function(t,n){var e=this.getGroup(t),i=this.getPortsByGroup(t),r=e.position||{},o=r.name,s=this.portLayoutNamespace;s[o]||(o="left");var a=r.args||{},l=i.map(function(t){return t&&t.position&&t.position.args}),h=s[o](l,n,a),f={ports:i,result:[]};return _(h).reduce(function(t,e,i){var r=t.ports[i];return t.result.push({portId:r.id,portTransformation:e,labelTransformation:this._getPortLabelLayout(r,M.Point(e),n),portAttrs:r.attrs,portSize:r.size,labelSize:r.label.size}),t}.bind(this),f),f.result},_getPortLabelLayout:function(t,e,i){var r=this.portLabelLayoutNamespace,n=t.label.position.name||"left";return r[n]?r[n](e,i,t.label.position.args):null},_init:function(t){if(U(t.groups))for(var e=Object.keys(t.groups),i=0,r=e.length;i<r;i++){var n=e[i];this.groups[n]=this._evaluateGroup(t.groups[n])}for(var o=_(t.items),s=0,a=o.length;s<a;s++)this.ports.push(this._evaluatePort(o[s]))},_evaluateGroup:function(t){return G(t,{position:this._getPosition(t.position,!0),label:this._getLabel(t,!0)})},_evaluatePort:function(t){var e=C({},t),i=this.getGroup(t.group);return e.markup=e.markup||i.markup,e.attrs=G({},i.attrs,e.attrs),e.position=this._createPositionNode(i,e),e.label=G({},i.label,this._getLabel(e)),e.z=this._getZIndex(i,e),e.size=C({},i.size,e.size),e},_getZIndex:function(t,e){return W(e.z)?e.z:W(t.z)||"auto"===t.z?t.z:"auto"},_createPositionNode:function(t,e){return G({name:"left",args:{}},t.position,{args:e.args})},_getPosition:function(t,e){var i,r={};N(t)?(i="fn",r.fn=t):$(t)?i=t:void 0===t?i=e?"left":null:Array.isArray(t)?(i="absolute",r.x=t[0],r.y=t[1]):U(t)&&(i=t.name,C(r,t.args));var n={args:r};return i&&(n.name=i),n},_getLabel:function(t,e){var i=t.label||{},r=i;return r.position=this._getPosition(i.position,e),r}};var xt={_initializePorts:function(){this._createPortData(),this.on("change:ports",function(){this._processRemovedPort(),this._createPortData()},this)},_processRemovedPort:function(){var t=this.get("ports")||{},e={};_(t.items).forEach(function(t){e[t.id]=!0});var i=this.previous("ports")||{},r={};_(i.items).forEach(function(t){e[t.id]||(r[t.id]=!0)});var n=this.graph;n&&!L(r)&&(n.getConnectedLinks(this,{inbound:!0}).forEach(function(t){r[t.get("target").port]&&t.remove()}),n.getConnectedLinks(this,{outbound:!0}).forEach(function(t){r[t.get("source").port]&&t.remove()}))},hasPorts:function(){var t=this.prop("ports/items");return Array.isArray(t)&&0<t.length},hasPort:function(t){return-1!==this.getPortIndex(t)},getPorts:function(){return E(this.prop("ports/items"))||[]},getPort:function(e){return E(_(this.prop("ports/items")).find(function(t){return t.id&&t.id===e}))},getPortsPositions:function(t){return this._portSettingsData.getGroupPortsMetrics(t,M.Rect(this.size())).reduce(function(t,e){var i=e.portTransformation;return t[e.portId]={x:i.x,y:i.y,angle:i.angle},t},{})},getPortIndex:function(t){var e=U(t)?t.id:t;return this._isValidPortId(e)?_(this.prop("ports/items")).findIndex(function(t){return t.id===e}):-1},addPort:function(t,e){if(!U(t)||Array.isArray(t))throw new Error("Element: addPort requires an object.");var i=C([],this.prop("ports/items"));return i.push(t),this.prop("ports/items",i,e),this},portProp:function(t,e,i,r){var n=this.getPortIndex(t);if(-1===n)throw new Error("Element: unable to find port with id "+t);var o=Array.prototype.slice.call(arguments,1);return Array.isArray(e)?o[0]=["ports","items",n].concat(e):$(e)?o[0]=["ports/items/",n,"/",e].join(""):(o=["ports/items/"+n],T(e)&&(o.push(e),o.push(i))),this.prop.apply(this,o)},_validatePorts:function(){var t=this.get("ports")||{},e=[],i=_((t=t||{}).items);return i.forEach(function(t){"object"!=typeof t&&e.push("Element: invalid port ",t),this._isValidPortId(t.id)||(t.id=this.generatePortId())},this),A(i,"id").length!==i.length&&e.push("Element: found id duplicities in ports."),e},generatePortId:function(){return this.generateId()},_isValidPortId:function(t){return null!=t&&!U(t)},addPorts:function(t,e){return t.length&&this.prop("ports/items",C([],this.prop("ports/items")).concat(t),e),this},removePort:function(t,e){var i=e||{},r=C([],this.prop("ports/items")),n=this.getPortIndex(t);return-1!==n&&(r.splice(n,1),i.rewrite=!0,this.prop("ports/items",r,i)),this},removePorts:function(t,e){var i;if(Array.isArray(t)){if(i=e||{},t.length){i.rewrite=!0;var r=C([],this.prop("ports/items")).filter(function(i){return!t.some(function(t){var e=U(t)?t.id:t;return i.id===e})});this.prop("ports/items",r,i)}}else(i=t||{}).rewrite=!0,this.prop("ports/items",[],i);return this},_createPortData:function(){var t,e=this._validatePorts();if(0<e.length)throw this.set("ports",this.previous("ports")),new Error(e.join(" "));this._portSettingsData&&(t=this._portSettingsData.getPorts()),this._portSettingsData=new kt(this.get("ports"));var i=this._portSettingsData.getPorts();if(t){var r=i.filter(function(e){if(!t.find(function(t){return t.id===e.id}))return e}),n=t.filter(function(e){if(!i.find(function(t){return t.id===e.id}))return e});0<n.length&&this.trigger("ports:remove",this,n),0<r.length&&this.trigger("ports:add",this,r)}}},wt={portContainerMarkup:"g",portMarkup:[{tagName:"circle",selector:"circle",attributes:{r:10,fill:"#FFFFFF",stroke:"#000000"}}],portLabelMarkup:[{tagName:"text",selector:"text",attributes:{fill:"#000000"}}],_portElementsCache:null,_initializePorts:function(){this._portElementsCache={}},_refreshPorts:function(){this._removePorts(),this._portElementsCache={},this._renderPorts()},_renderPorts:function(){for(var i=[],r=this._getContainerElement(),t=0,e=r.node.childNodes.length;t<e;t++)i.push(r.node.childNodes[t]);var n=S(this.model._portSettingsData.getPorts(),"z");_(n.auto).forEach(function(t){var e=this._getPortElement(t);r.append(e),i.push(e)},this);for(var o=Object.keys(n),s=0;s<o.length;s++){var a=o[s];if("auto"!==a){var l=parseInt(a,10);this._appendPorts(n[a],l,i)}}this._updatePorts()},_getContainerElement:function(){return this.rotatableNode||this.vel},_appendPorts:function(t,e,i){var r=this._getContainerElement(),n=_(t).map(this._getPortElement,this);i[e]||e<0?R(i[Math.max(e,0)]).before(n):r.append(n)},_getPortElement:function(t){return this._portElementsCache[t.id]?this._portElementsCache[t.id].portElement:this._createPortElement(t)},findPortNode:function(t,e){var i=this._portElementsCache[t];if(!i)return null;var r=i.portContentElement.node,n=i.portContentSelectors;return this.findBySelector(e,r,n)[0]},_updatePorts:function(){this._updatePortGroup(void 0),Object.keys(this.model._portSettingsData.groups).forEach(this._updatePortGroup,this)},_removePorts:function(){x(this._portElementsCache,"portElement.remove")},_createPortElement:function(t){var e,i,r,n=R(this.portContainerMarkup).addClass("joint-port"),o=this._getPortMarkup(t);if(Array.isArray(o)){var s=this.parseDOMJSON(o,n.node),a=s.fragment;e=1<a.childNodes.length?R("g").append(a):R(a.firstChild),r=s.selectors}else e=R(o),Array.isArray(e)&&(e=R("g").append(e));if(!e)throw new Error("ElementView: Invalid port markup.");e.attr({port:t.id,"port-group":t.group});var l,h,f=this._getPortLabelMarkup(t.label);if(Array.isArray(f)){var u=this.parseDOMJSON(f,n.node),c=u.fragment;i=1<c.childNodes.length?R("g").append(c):R(c.firstChild),l=u.selectors}else i=R(f),Array.isArray(i)&&(i=R("g").append(i));if(!i)throw new Error("ElementView: Invalid port label markup.");if(r&&l){for(var d in l)if(r[d]&&d!==this.selector)throw new Error("ElementView: selectors within port must be unique.");h=C({},r,l)}else h=r||l;return n.append([e.addClass("joint-port-body"),i.addClass("joint-port-label")]),this._portElementsCache[t.id]={portElement:n,portLabelElement:i,portSelectors:h,portLabelSelectors:l,portContentElement:e,portContentSelectors:r},n},_updatePortGroup:function(t){for(var e=M.Rect(this.model.size()),i=this.model._portSettingsData.getGroupPortsMetrics(t,e),r=0,n=i.length;r<n;r++){var o=i[r],s=o.portId,a=this._portElementsCache[s]||{},l=o.portTransformation;this.applyPortTransform(a.portElement,l),this.updateDOMSubtreeAttributes(a.portElement.node,o.portAttrs,{rootBBox:new M.Rect(o.portSize),selectors:a.portSelectors});var h=o.labelTransformation;h&&(this.applyPortTransform(a.portLabelElement,h,-l.angle||0),this.updateDOMSubtreeAttributes(a.portLabelElement.node,h.attrs,{rootBBox:new M.Rect(o.labelSize),selectors:a.portLabelSelectors}))}},applyPortTransform:function(t,e,i){var r=R.createSVGMatrix().rotate(i||0).translate(e.x||0,e.y||0).rotate(e.angle||0);t.transform(r,{absolute:!0})},_getPortMarkup:function(t){return t.markup||this.model.get("portMarkup")||this.model.portMarkup||this.portMarkup},_getPortLabelMarkup:function(t){return t.markup||this.model.get("portLabelMarkup")||this.model.portLabelMarkup||this.portLabelMarkup}},Ct=lt.extend({defaults:{position:{x:0,y:0},size:{width:1,height:1},angle:0},initialize:function(){this._initializePorts(),lt.prototype.initialize.apply(this,arguments)},_initializePorts:function(){},_refreshPorts:function(){},isElement:function(){return!0},position:function(t,e,i){var r=W(e);if((i=(r?i:t)||{}).parentRelative){if(!this.graph)throw new Error("Element must be part of a graph.");var n=this.getParentCell(),o=n&&!n.isLink()?n.get("position"):{x:0,y:0}}if(r){if(i.parentRelative&&(t+=o.x,e+=o.y),i.deep){var s=this.get("position");this.translate(t-s.x,e-s.y,i)}else this.set("position",{x:t,y:e},i);return this}var a=M.Point(this.get("position"));return i.parentRelative?a.difference(o):a},translate:function(t,e,i){if(e=e||0,0===(t=t||0)&&0===e)return this;(i=i||{}).translateBy=i.translateBy||this.id;var r=this.get("position")||{x:0,y:0};if(i.restrictedArea&&i.translateBy===this.id){var n=this.getBBox({deep:!0}),o=i.restrictedArea,s=r.x-n.x,a=r.y-n.y,l=Math.max(o.x+s,Math.min(o.x+o.width+s-n.width,r.x+t)),h=Math.max(o.y+a,Math.min(o.y+o.height+a-n.height,r.y+e));t=l-r.x,e=h-r.y}var f={x:r.x+t,y:r.y+e};return i.tx=t,i.ty=e,i.transition?(U(i.transition)||(i.transition={}),this.transition("position",f,C({},i.transition,{valueFunction:p.object})),x(this.getEmbeddedCells(),"translate",t,e,i)):(this.startBatch("translate",i),this.set("position",f,i),x(this.getEmbeddedCells(),"translate",t,e,i),this.stopBatch("translate",i)),this},size:function(t,e,i){var r=this.get("size");return void 0===t?{width:r.width,height:r.height}:(U(t)&&(i=e,e=W(t.height)?t.height:r.height,t=W(t.width)?t.width:r.width),this.resize(t,e,i))},resize:function(t,e,i){if(i=i||{},this.startBatch("resize",i),i.direction){var r=this.get("size");switch(i.direction){case"left":case"right":e=r.height;break;case"top":case"bottom":t=r.width}var n=M.normalizeAngle(this.get("angle")||0),o={"top-right":0,right:0,"top-left":1,top:1,"bottom-left":2,left:2,"bottom-right":3,bottom:3}[i.direction];i.absolute&&(o+=Math.floor((n+45)/90),o%=4);var s=this.getBBox(),a=s[["bottomLeft","corner","topRight","origin"][o]](),l=M.Point(a).rotate(s.center(),-n),h=Math.sqrt(t*t+e*e)/2,f=o*Math.PI/2;f+=Math.atan(o%2==0?e/t:t/e),f-=M.toRad(n);var u=M.Point.fromPolar(h,f,l),c=M.Point(u).offset(t/-2,e/-2);this.set("size",{width:t,height:e},i),this.position(c.x,c.y,i)}else this.set("size",{width:t,height:e},i);return this.stopBatch("resize",i),this},scale:function(t,e,i,r){var n=this.getBBox().scale(t,e,i);return this.startBatch("scale",r),this.position(n.x,n.y,r),this.resize(n.width,n.height,r),this.stopBatch("scale"),this},fitEmbeds:function(t){if(t=t||{},!this.graph)throw new Error("Element must be part of a graph.");var e=this.getEmbeddedCells();if(0<e.length){this.startBatch("fit-embeds",t),t.deep&&x(e,"fitEmbeds",t);var i=this.graph.getCellsBBox(e),r=function(t){if(Object(t)===t)return e=i=r=n=0,isFinite(t.vertical)&&(e=r=+t.vertical),isFinite(t.horizontal)&&(i=n=+t.horizontal),isFinite(t.top)&&(e=+t.top),isFinite(t.right)&&(i=+t.right),isFinite(t.bottom)&&(r=+t.bottom),isFinite(t.left)&&(n=+t.left),{top:e,right:i,bottom:r,left:n};var e,i,r,n,o=0;return isFinite(t)&&(o=+t),{top:o,right:o,bottom:o,left:o}}(t.padding);i.moveAndExpand({x:-r.left,y:-r.top,width:r.right+r.left,height:r.bottom+r.top}),this.set({position:{x:i.x,y:i.y},size:{width:i.width,height:i.height}},t),this.stopBatch("fit-embeds")}return this},rotate:function(t,e,i,r){if(i){var n=this.getBBox().center(),o=this.get("size"),s=this.get("position");n.rotate(i,this.get("angle")-t);var a=n.x-o.width/2-s.x,l=n.y-o.height/2-s.y;this.startBatch("rotate",{angle:t,absolute:e,origin:i}),this.position(s.x+a,s.y+l,r),this.rotate(t,e,null,r),this.stopBatch("rotate")}else this.set("angle",e?t:(this.get("angle")+t)%360,r);return this},angle:function(){return M.normalizeAngle(this.get("angle")||0)},getBBox:function(t){if((t=t||{}).deep&&this.graph){var e=this.getEmbeddedCells({deep:!0,breadthFirst:!0});return e.push(this),this.graph.getCellsBBox(e)}var i=this.get("position"),r=this.get("size");return new M.Rect(i.x,i.y,r.width,r.height)},getPointFromConnectedLink:function(t,e){var i=this.getBBox(),r=i.center(),n=t.get(e);if(!n)return r;var o=n.port;if(!o)return r;var s=this.portProp(o,["group"]),a=this.getPortsPositions(s),l=new M.Point(a[o]).offset(i.origin()),h=this.angle();return h&&l.rotate(r,-h),l}});C(Ct.prototype,xt);var At={},Et=n.View.extend({options:{},theme:null,themeClassNamePrefix:s("theme-"),requireSetThemeOverride:!1,defaultTheme:"default",children:null,childNodes:null,UPDATE_PRIORITY:2,constructor:function(t){this.requireSetThemeOverride=t&&!!t.theme,this.options=C({},this.options,t),n.View.call(this,t)},initialize:function(){(At[this.cid]=this).setTheme(this.options.theme||this.defaultTheme),this.init()},unmount:function(){this.svgElement?this.vel.remove():this.$el.remove()},renderChildren:function(t){if(t||(t=O(this,"children")),t){var e=this.svgElement,i=R.namespace[e?"svg":"xhtml"],r=a(t,i);(e?this.vel:this.$el).empty().append(r.fragment),this.childNodes=r.selectors}return this},findAttribute:function(t,e){for(var i=e;i&&1===i.nodeType;){var r=i.getAttribute(t);if(r)return r;if(i===this.el)return null;i=i.parentNode}return null},_ensureElement:function(){if(this.el)this.setElement(O(this,"el"));else{var t=O(this,"tagName"),e=C({},O(this,"attributes")),i=C({},O(this,"style"));this.id&&(e.id=O(this,"id")),this.setElement(this._createElement(t)),this._setAttributes(e),this._setStyle(i)}this._ensureElClassName()},_setAttributes:function(t){this.svgElement?this.vel.attr(t):this.$el.attr(t)},_setStyle:function(t){this.$el.css(t)},_createElement:function(t){return this.svgElement?document.createElementNS(R.namespace.svg,t):document.createElement(t)},_setElement:function(t){this.$el=t instanceof n.$?t:n.$(t),this.el=this.$el[0],this.svgElement&&(this.vel=R(this.el))},_ensureElClassName:function(){var t=O(this,"className");if(t){var e=s(t);this.svgElement?this.vel.removeClass(t).addClass(e):this.$el.removeClass(t).addClass(e)}},init:function(){},onRender:function(){},confirmUpdate:function(){return 0},setTheme:function(t,e){return e=e||{},this.theme&&this.requireSetThemeOverride&&!e.override||(this.removeThemeClassName(),this.addThemeClassName(t),this.onSetTheme(this.theme,t),this.theme=t),this},addThemeClassName:function(t){t=t||this.theme;var e=this.themeClassNamePrefix+t;return this.svgElement?this.vel.addClass(e):this.$el.addClass(e),this},removeThemeClassName:function(t){t=t||this.theme;var e=this.themeClassNamePrefix+t;return this.svgElement?this.vel.removeClass(e):this.$el.removeClass(e),this},onSetTheme:function(t,e){},remove:function(){return this.onRemove(),this.undelegateDocumentEvents(),At[this.cid]=null,n.View.prototype.remove.apply(this,arguments),this},onRemove:function(){},getEventNamespace:function(){return".joint-event-ns-"+this.cid},delegateElementEvents:function(t,e,i){if(!e)return this;i||(i={});var r=this.getEventNamespace();for(var n in e){var o=e[n];"function"!=typeof o&&(o=this[o]),o&&P(t).on(n+r,i,o.bind(this))}return this},undelegateElementEvents:function(t){return P(t).off(this.getEventNamespace()),this},delegateDocumentEvents:function(t,e){return t||(t=O(this,"documentEvents")),this.delegateElementEvents(document,t,e)},undelegateDocumentEvents:function(){return this.undelegateElementEvents(document)},eventData:function(t,e){if(!t)throw new Error("eventData(): event object required.");var i=t.data,r="__"+this.cid+"__";return void 0===e?i&&i[r]||{}:(i||(i=t.data={}),i[r]||(i[r]={}),C(i[r],e),this)},stopPropagation:function(t){return this.eventData(t,{propagationStopped:!0}),this},isPropagationStopped:function(t){return!!this.eventData(t).propagationStopped}},{extend:function(){var t=Array.from(arguments),e=t[0]&&C({},t[0])||{},i=t[1]&&C({},t[1])||{},r=e.render||this.prototype&&this.prototype.render||null;return e.render=function(){return"function"==typeof r&&r.apply(this,arguments),this.render.__render__===r&&this.onRender(),this},e.render.__render__=r,n.View.extend.call(this,e,i)}}),Lt=Et.extend({tagName:"g",svgElement:!0,selector:"root",metrics:null,className:function(){var r=["cell"],t=this.model.get("type");return t&&t.toLowerCase().split(".").forEach(function(t,e,i){r.push("type-"+i.slice(0,e+1).join("-"))}),r.join(" ")},_presentationAttributes:null,_flags:null,setFlags:function(){var t,e,i,r={},n={},o=0,s=this.presentationAttributes;for(var a in s)if(s.hasOwnProperty(a)){var l=s[a];for(Array.isArray(l)||(l=[l]),t=0,e=l.length;t<e;t++){var h=r[i=l[t]];h||(h=r[i]=1<<o++),n[a]|=h}}var f=this.initFlag;for(Array.isArray(f)||(f=[f]),t=0,e=f.length;t<e;t++)r[i=f[t]]||(r[i]=1<<o++);if(25<o)throw new Error("dia.CellView: Maximum number of flags exceeded.");this._flags=r,this._presentationAttributes=n},hasFlag:function(t,e){return t&this.getFlag(e)},removeFlag:function(t,e){return t^t&this.getFlag(e)},getFlag:function(t){var e=this._flags;if(!e)return 0;var i=0;if(Array.isArray(t))for(var r=0,n=t.length;r<n;r++)i|=e[t[r]];else i|=e[t];return i},attributes:function(){var t=this.model;return{"model-id":t.id,"data-type":t.attributes.type}},constructor:function(t){t.id=t.id||l(this),Et.call(this,t)},initialize:function(){this.setFlags(),Et.prototype.initialize.apply(this,arguments),this.cleanNodesCache(),this.$el.data("view",this),this.startListening()},startListening:function(){this.listenTo(this.model,"change",this.onAttributesChange)},onAttributesChange:function(t,e){var i=t.getChangeFlag(this._presentationAttributes);if(!e.updateHandled&&i){e.dirty&&this.hasFlag(i,"UPDATE")&&(i|=this.getFlag("RENDER")),e.tool&&(e.async=!1);var r=this.paper;r&&r.requestViewUpdate(this,i,this.UPDATE_PRIORITY,e)}},parseDOMJSON:function(t,e){var i=a(t),r=i.selectors,n=i.groupSelectors;for(var o in n){if(r[o])throw new Error("dia.CellView: ambiguous group selector");r[o]=n[o]}if(e){var s=this.selector;if(r[s])throw new Error("dia.CellView: ambiguous root selector.");r[s]=e}return{fragment:i.fragment,selectors:r}},can:function(t){var e,i,r=N(this.options.interactive)?this.options.interactive(this):this.options.interactive;return U(r)&&!1!==r[t]||(e=r,i=Object.prototype.toString,(!0===e||!1===e||!!e&&"object"==typeof e&&"[object Boolean]"===i.call(e))&&!1!==r)},findBySelector:function(t,e,i){if(e||(e=this.el),i||(i=this.selectors),!t||"."===t)return[e];if(i){var r=i[t];if(r)return Array.isArray(r)?r:[r]}return P(e).find(t).toArray()},notify:function(t){if(this.paper){var e=Array.prototype.slice.call(arguments,1);this.trigger.apply(this,[t].concat(e)),this.paper.trigger.apply(this.paper,[t,this].concat(e))}},getBBox:function(t){var e;if(t&&t.useModelGeometry){var i=this.model;e=i.getBBox().bbox(i.angle())}else e=this.getNodeBBox(this.el);return this.paper.localToPaperRect(e)},getNodeBBox:function(t){var e=this.getNodeBoundingRect(t),i=this.getNodeMatrix(t),r=this.getRootTranslateMatrix(),n=this.getRootRotateMatrix();return R.transformRect(e,r.multiply(n).multiply(i))},getNodeUnrotatedBBox:function(t){var e=this.getNodeBoundingRect(t),i=this.getNodeMatrix(t),r=this.getRootTranslateMatrix();return R.transformRect(e,r.multiply(i))},getRootTranslateMatrix:function(){var t=this.model.position();return R.createSVGMatrix().translate(t.x,t.y)},getRootRotateMatrix:function(){var t=R.createSVGMatrix(),e=this.model,i=e.angle();if(i){var r=e.getBBox(),n=r.width/2,o=r.height/2;t=t.translate(n,o).rotate(i).translate(-n,-o)}return t},highlight:function(t,e){return t=t&&this.$(t)[0]||this.el,(e=e||{}).partial=t!==this.el,this.notify("cell:highlight",t,e),this},unhighlight:function(t,e){return t=t&&this.$(t)[0]||this.el,(e=e||{}).partial=t!=this.el,this.notify("cell:unhighlight",t,e),this},findMagnet:function(t){var e=this.$(t),i=this.$el;0===e.length&&(e=i);do{var r=e.attr("magnet");if((r||e.is(i))&&"false"!==r)return e[0];e=e.parent()}while(0<e.length)},getSelector:function(t,e){var i;if(t===this.el)return"string"==typeof e&&(i="> "+e),i;if(t){var r=R(t).index()+1;i=t.tagName+":nth-child("+r+")",e&&(i+=" > "+e),i=this.getSelector(t.parentNode,i)}return i},getLinkEnd:function(t,e,i,r,n){var o=this.model,s=o.id,a=this.findAttribute("port",t),l=t.getAttribute("joint-selector"),h={id:s};null!=l&&(h.magnet=l),null!=a?(h.port=a,o.hasPort(a)||l||(h.selector=this.getSelector(t))):null==l&&this.el!==t&&(h.selector=this.getSelector(t));var f=this.paper,u=f.options.connectionStrategy;if("function"==typeof u){var c=u.call(f,h,this,t,new M.Point(e,i),r,n,f);c&&(h=c)}return h},getMagnetFromLinkEnd:function(t){var e=this.el,i=t.port,r=t.magnet,n=this.model;return null!=i&&n.isElement()&&n.hasPort(i)?this.findPortNode(i,r)||e:(r||(r=t.selector),r||null==i||(r='[port="'+i+'"]'),this.findBySelector(r,e,this.selectors)[0])},getAttributeDefinition:function(t){return this.model.constructor.getAttributeDefinition(t)},setNodeAttributes:function(t,e){L(e)||(t instanceof SVGElement?R(t).attr(e):P(t).attr(e))},processNodeAttributes:function(t,e){var i,r,n,o,s,a,l,h,f,u,c=[];for(i in e)e.hasOwnProperty(i)&&(r=e[i],!(n=this.getAttributeDefinition(i))||N(n.qualify)&&!n.qualify.call(this,r,t,e)?(a||(a={}),a[(u=i,u.replace(/[A-Z]/g,"-$&").toLowerCase())]=r):($(n.set)&&(a||(a={}),a[n.set]=r),null!==r&&c.push(i,n)));for(o=0,s=c.length;o<s;o+=2)i=c[o],n=c[o+1],r=e[i],N(n.set)&&(l||(l={}),l[i]=r),N(n.position)&&(h||(h={}),h[i]=r),N(n.offset)&&(f||(f={}),f[i]=r);return{raw:e,normal:a,set:l,position:h,offset:f}},updateRelativeAttributes:function(t,e,i,r){var n,o;r||(r={});var s=e.raw||{},a=e.normal||{},l=e.set,h=e.position,f=e.offset;for(n in l){o=l[n];var u=this.getAttributeDefinition(n).set.call(this,o,i.clone(),t,s);U(u)?C(a,u):void 0!==u&&(a[n]=u)}if(t instanceof HTMLElement)this.setNodeAttributes(t,a);else{var c,d,p,g=a.transform,m=R.transformStringToMatrix(g),v=M.Point(m.e,m.f);if(g&&(a=D(a,"transform"),m.e=m.f=0),h||f){var y=this.getNodeScale(t,r.scalableNode);c=y.sx,d=y.sy}var b=!1;for(n in h)o=h[n],(p=this.getAttributeDefinition(n).position.call(this,o,i.clone(),t,s))&&(v.offset(M.Point(p).scale(c,d)),b||(b=!0));this.setNodeAttributes(t,a);var k=!1;if(f){var x=this.getNodeBoundingRect(t);if(0<x.width&&0<x.height){var w=R.transformRect(x,m).scale(1/c,1/d);for(n in f)o=f[n],(p=this.getAttributeDefinition(n).offset.call(this,o,w,t,s))&&(v.offset(M.Point(p).scale(c,d)),k||(k=!0))}}(void 0!==g||b||k)&&(v.round(1),m.e=v.x,m.f=v.y,t.setAttribute("transform",R.matrixToTransformString(m)))}},getNodeScale:function(t,e){var i,r;if(e&&e.contains(t)){var n=e.scale();i=1/n.sx,r=1/n.sy}else r=i=1;return{sx:i,sy:r}},cleanNodesCache:function(){this.metrics={}},nodeCache:function(t){var e=this.metrics;if(!e)return{};var i=R.ensureId(t),r=e[i];return r||(r=e[i]={}),r},getNodeData:function(t){var e=this.nodeCache(t);return e.data||(e.data={}),e.data},getNodeBoundingRect:function(t){var e=this.nodeCache(t);return void 0===e.boundingRect&&(e.boundingRect=R(t).getBBox()),new M.Rect(e.boundingRect)},getNodeMatrix:function(t){var e=this.nodeCache(t);if(void 0===e.magnetMatrix){var i=this.rotatableNode||this.el;e.magnetMatrix=R(t).getTransformToElement(i)}return R.createSVGMatrix(e.magnetMatrix)},getNodeShape:function(t){var e=this.nodeCache(t);return void 0===e.geometryShape&&(e.geometryShape=R(t).toGeometryShape()),e.geometryShape.clone()},isNodeConnection:function(t){return this.model.isLink()&&(!t||t===this.el)},findNodesAttributes:function(t,e,i,r){var n,o,s,a,l={},h=[];for(var f in t)if(t.hasOwnProperty(f)){var u=i[f]=this.findBySelector(f,e,r);for(n=0,o=u.length;n<o;n++){var c=u[n];a=R.ensureId(c),s=t[f];var d=r&&r[f]===c,p=l[a];if(p){p.array||(h.push(a),p.array=!0,p.attributes=[p.attributes],p.selectedLength=[p.selectedLength]);var g=p.attributes,m=p.selectedLength;if(d)g.unshift(s),m.unshift(-1);else{var v=w(m,o);g.splice(v,0,s),m.splice(v,0,o)}}else l[a]={attributes:s,selectedLength:d?-1:o,node:c,array:!1}}}for(n=0,o=h.length;n<o;n++)(s=l[a=h[n]]).attributes=G.apply(void 0,[{}].concat(s.attributes.reverse()));return l},getEventTarget:function(t,e){void 0===e&&(e={});var i=t.target,r=t.type,n=t.clientX;void 0===n&&(n=0);var o=t.clientY;return void 0===o&&(o=0),e.fromPoint||"touchmove"===r||"touchend"===r?document.elementFromPoint(n,o):i},updateDOMSubtreeAttributes:function(t,e,i){i||(i={}),i.rootBBox||(i.rootBBox=M.Rect()),i.selectors||(i.selectors=this.selectors);var r,n,o,s,a,l,h={},f={},u=[],c=i.roAttributes,d=this.findNodesAttributes(c||e,t,h,i.selectors),p=c?this.findNodesAttributes(e,t,h,i.selectors):d;for(var g in d)if(o=(s=d[g]).attributes,n=s.node,(a=this.processNodeAttributes(n,o)).set||a.position||a.offset){var m,v=p[g]&&p[g].attributes,y=v&&void 0===o.ref?v.ref:o.ref;if(y){if(!(m=(h[y]||this.findBySelector(y,t,i.selectors))[0]))throw new Error('dia.ElementView: "'+y+'" reference does not exist.')}else m=null;r={node:n,refNode:m,processedAttributes:a,allAttributes:v};var b=u.findIndex(function(t){return t.refNode===n});-1<b?u.splice(b,0,r):u.push(r)}else this.setNodeAttributes(n,a.normal);for(var k=0,x=u.length;k<x;k++){r=u[k],n=r.node,m=r.refNode;var w=R(i.rotatableNode),C=m?R.ensureId(m):"",A=!!w&&!!m&&w.contains(m),E=f[C];if(!E){var L=A?w:t;E=f[C]=m?R(m).getBBox({target:L}):i.rootBBox}c?(a=this.processNodeAttributes(n,r.allAttributes),this.mergeProcessedAttributes(a,r.processedAttributes)):a=r.processedAttributes;var P=E;A&&!w.contains(n)&&(l||(l=R.transformStringToMatrix(w.attr("transform"))),P=R.transformRect(E,l)),this.updateRelativeAttributes(n,a,P,i)}},mergeProcessedAttributes:function(t,e){t.set||(t.set={}),t.position||(t.position={}),t.offset||(t.offset={}),C(t.set,e.set),C(t.position,e.position),C(t.offset,e.offset);var i=t.normal&&t.normal.transform;void 0!==i&&e.normal&&(e.normal.transform=i),t.normal=e.normal},onRemove:function(){this.removeTools()},_toolsView:null,hasTools:function(t){var e=this._toolsView;return!!e&&(!t||e.getName()===t)},addTools:function(t){return this.removeTools(),t&&((this._toolsView=t).configure({relatedView:this}),t.listenTo(this.paper,"tools:event",this.onToolEvent.bind(this)),t.mount()),this},updateTools:function(t){var e=this._toolsView;return e&&e.update(t),this},removeTools:function(){var t=this._toolsView;return t&&(t.remove(),this._toolsView=null),this},hideTools:function(){var t=this._toolsView;return t&&t.hide(),this},showTools:function(){var t=this._toolsView;return t&&t.show(),this},onToolEvent:function(t){switch(t){case"remove":this.removeTools();break;case"hide":this.hideTools();break;case"show":this.showTools()}},pointerdblclick:function(t,e,i){this.notify("cell:pointerdblclick",t,e,i)},pointerclick:function(t,e,i){this.notify("cell:pointerclick",t,e,i)},contextmenu:function(t,e,i){this.notify("cell:contextmenu",t,e,i)},pointerdown:function(t,e,i){this.model.graph&&(this.model.startBatch("pointer"),this._graph=this.model.graph),this.notify("cell:pointerdown",t,e,i)},pointermove:function(t,e,i){this.notify("cell:pointermove",t,e,i)},pointerup:function(t,e,i){this.notify("cell:pointerup",t,e,i),this._graph&&(this._graph.stopBatch("pointer",{cell:this.model}),delete this._graph)},mouseover:function(t){this.notify("cell:mouseover",t)},mouseout:function(t){this.notify("cell:mouseout",t)},mouseenter:function(t){this.notify("cell:mouseenter",t)},mouseleave:function(t){this.notify("cell:mouseleave",t)},mousewheel:function(t,e,i,r){this.notify("cell:mousewheel",t,e,i,r)},onevent:function(t,e,i,r){this.notify(e,t,i,r)},onmagnet:function(){},magnetpointerdblclick:function(){},magnetcontextmenu:function(){},checkMouseleave:function(t){var e=this.getEventTarget(t,{fromPoint:!0}),i=this.paper.findView(e);i!==this&&(this.mouseleave(t),i&&i.mouseenter(t))},setInteractivity:function(t){this.options.interactive=t}},{addPresentationAttributes:function(t){return G({},this.prototype.presentationAttributes,t,function(t,e){if(t&&e)return"string"==typeof t&&(t=[t]),"string"==typeof e&&(e=[e]),Array.isArray(t)&&Array.isArray(e)?A(t.concat(e)):void 0})}}),Pt=Lt.extend({_removePorts:function(){},_renderPorts:function(){},className:function(){var t=Lt.prototype.className.apply(this).split(" ");return t.push("element"),t.join(" ")},initialize:function(){Lt.prototype.initialize.apply(this,arguments),this._initializePorts()},presentationAttributes:{attrs:["UPDATE"],position:["TRANSLATE"],size:["RESIZE","PORTS"],angle:["ROTATE"],markup:["RENDER"],ports:["PORTS"]},initFlag:["RENDER"],UPDATE_PRIORITY:0,confirmUpdate:function(t,e){return this.hasFlag(t,"RENDER")?(this.render(),t=this.removeFlag(t,["RENDER","UPDATE","RESIZE","TRANSLATE","ROTATE","PORTS"])):(this.hasFlag(t,"RESIZE")&&(this.resize(e),t=this.removeFlag(t,["RESIZE","UPDATE"])),this.hasFlag(t,"UPDATE")&&(this.update(this.model,null,e),t=this.removeFlag(t,"UPDATE")),this.hasFlag(t,"TRANSLATE")&&(this.translate(),t=this.removeFlag(t,"TRANSLATE")),this.hasFlag(t,"ROTATE")&&(this.rotate(),t=this.removeFlag(t,"ROTATE")),this.hasFlag(t,"PORTS")&&(this._refreshPorts(),t=this.removeFlag(t,"PORTS")),t)},_initializePorts:function(){},update:function(t,e){this.cleanNodesCache();var i=this.model,r=i.attr();this.updateDOMSubtreeAttributes(this.el,r,{rootBBox:new M.Rect(i.size()),selectors:this.selectors,scalableNode:this.scalableNode,rotatableNode:this.rotatableNode,roAttributes:e===r?null:e})},rotatableSelector:"rotatable",scalableSelector:"scalable",scalableNode:null,rotatableNode:null,renderMarkup:function(){var t=this.model,e=t.get("markup")||t.markup;if(!e)throw new Error("dia.ElementView: markup required");if(Array.isArray(e))return this.renderJSONMarkup(e);if("string"==typeof e)return this.renderStringMarkup(e);throw new Error("dia.ElementView: invalid markup")},renderJSONMarkup:function(t){var e=this.parseDOMJSON(t,this.el),i=this.selectors=e.selectors;this.rotatableNode=R(i[this.rotatableSelector])||null,this.scalableNode=R(i[this.scalableSelector])||null,this.vel.append(e.fragment)},renderStringMarkup:function(t){var e=this.vel;e.append(R(t)),this.rotatableNode=e.findOne(".rotatable"),this.scalableNode=e.findOne(".scalable"),(this.selectors={})[this.selector]=this.el},render:function(){return this.vel.empty(),this.renderMarkup(),this.scalableNode&&this.update(),this.resize(),this.rotatableNode?(this.rotate(),this.translate()):this.updateTransformation(),this._refreshPorts(),this},resize:function(t){if(this.scalableNode)return this.sgResize(t);this.model.attributes.angle&&this.rotate(),this.update()},translate:function(){if(this.rotatableNode)return this.rgTranslate();this.updateTransformation()},rotate:function(){if(this.rotatableNode)return this.rgRotate(),void this.update();this.updateTransformation()},updateTransformation:function(){var t=this.getTranslateString(),e=this.getRotateString();e&&(t+=" "+e),this.vel.attr("transform",t)},getTranslateString:function(){var t=this.model.attributes.position;return"translate("+t.x+","+t.y+")"},getRotateString:function(){var t=this.model.attributes,e=t.angle;if(!e)return null;var i=t.size;return"rotate("+e+","+i.width/2+","+i.height/2+")"},rgRotate:function(){this.rotatableNode.attr("transform",this.getRotateString())},rgTranslate:function(){this.vel.attr("transform",this.getTranslateString())},sgResize:function(t){var e=this.model,i=e.angle(),r=e.size(),n=this.scalableNode,o=!1;0<n.node.getElementsByTagName("path").length&&(o=!0);var s=n.getBBox({recursive:o}),a=r.width/(s.width||1),l=r.height/(s.height||1);n.attr("transform","scale("+a+","+l+")");var h=this.rotatableNode,f=h&&h.attr("transform");if(f){h.attr("transform",f+" rotate("+-i+","+r.width/2+","+r.height/2+")");var u=n.getBBox({target:this.paper.cells});e.set("position",{x:u.x,y:u.y},C({updateHandled:!0},t)),this.translate(),this.rotate()}this.update()},prepareEmbedding:function(t){t||(t={});var e=t.model||this.model,i=(t.paper||this.paper).model;e.startBatch("to-front"),e.toFront({deep:!0,ui:!0});var r=i.getElements().reduce(function(t,e){return Math.max(t,e.attributes.z||0)},0);i.getConnectedLinks(e,{deep:!0,includeEnclosed:!0}).forEach(function(t){t.attributes.z<=r&&t.set("z",r+1,{ui:!0})}),e.stopBatch("to-front");var n=e.parent();n&&i.getCell(n).unembed(e,{ui:!0})},processEmbedding:function(t){t||(t={});var e=t.model||this.model,i=t.paper||this.paper,r=i.options,n=[];N(r.findParentBy)?n=_(r.findParentBy.call(i.model,this)).filter(function(t){return t instanceof lt&&this.model.id!==t.id&&!t.isEmbeddedIn(this.model)}.bind(this)):n=i.model.findModelsUnderElement(e,{searchBy:r.findParentBy});r.frontParentOnly&&(n=n.slice(-1));for(var o=null,s=t.candidateEmbedView,a=n.length-1;0<=a;a--){var l=n[a];if(s&&s.model.id==l.id){o=s;break}var h=l.findView(i);if(r.validateEmbedding.call(i,this,h)){o=h;break}}o&&o!=s&&(this.clearEmbedding(t),t.candidateEmbedView=o.highlight(null,{embedding:!0})),!o&&s&&this.clearEmbedding(t)},clearEmbedding:function(t){t||(t={});var e=t.candidateEmbedView;e&&(e.unhighlight(null,{embedding:!0}),t.candidateEmbedView=null)},finalizeEmbedding:function(t){t||(t={});var e=t.candidateEmbedView,i=t.model||this.model,r=t.paper||this.paper;e&&(e.model.embed(i,{ui:!0}),e.unhighlight(null,{embedding:!0}),t.candidateEmbedView=null),x(r.model.getConnectedLinks(i,{deep:!0}),"reparent",{ui:!0})},getDelegatedView:function(){for(var t=this,e=t.model,i=t.paper;t&&!e.isLink();){if(!e.isEmbedded()||t.can("stopDelegation"))return t;e=e.getParentCell(),t=i.findViewByModel(e)}return null},notifyPointerdown:function(t,e,i){Lt.prototype.pointerdown.call(this,t,e,i),this.notify("element:pointerdown",t,e,i)},notifyPointermove:function(t,e,i){Lt.prototype.pointermove.call(this,t,e,i),this.notify("element:pointermove",t,e,i)},notifyPointerup:function(t,e,i){this.notify("element:pointerup",t,e,i),Lt.prototype.pointerup.call(this,t,e,i)},pointerdblclick:function(t,e,i){Lt.prototype.pointerdblclick.apply(this,arguments),this.notify("element:pointerdblclick",t,e,i)},pointerclick:function(t,e,i){Lt.prototype.pointerclick.apply(this,arguments),this.notify("element:pointerclick",t,e,i)},contextmenu:function(t,e,i){Lt.prototype.contextmenu.apply(this,arguments),this.notify("element:contextmenu",t,e,i)},pointerdown:function(t,e,i){this.isPropagationStopped(t)||(this.notifyPointerdown(t,e,i),this.dragStart(t,e,i))},pointermove:function(t,e,i){var r=this.eventData(t);switch(r.action){case"magnet":this.dragMagnet(t,e,i);break;case"move":(r.delegatedView||this).drag(t,e,i);default:this.notifyPointermove(t,e,i)}this.eventData(t,r)},pointerup:function(t,e,i){var r=this.eventData(t);switch(r.action){case"magnet":this.dragMagnetEnd(t,e,i);break;case"move":(r.delegatedView||this).dragEnd(t,e,i);default:this.notifyPointerup(t,e,i)}var n=r.targetMagnet;n&&this.magnetpointerclick(t,n,e,i),this.checkMouseleave(t)},mouseover:function(t){Lt.prototype.mouseover.apply(this,arguments),this.notify("element:mouseover",t)},mouseout:function(t){Lt.prototype.mouseout.apply(this,arguments),this.notify("element:mouseout",t)},mouseenter:function(t){Lt.prototype.mouseenter.apply(this,arguments),this.notify("element:mouseenter",t)},mouseleave:function(t){Lt.prototype.mouseleave.apply(this,arguments),this.notify("element:mouseleave",t)},mousewheel:function(t,e,i,r){Lt.prototype.mousewheel.apply(this,arguments),this.notify("element:mousewheel",t,e,i,r)},onmagnet:function(t,e,i){this.dragMagnetStart(t,e,i)},magnetpointerdblclick:function(t,e,i,r){this.notify("element:magnet:pointerdblclick",t,e,i,r)},magnetcontextmenu:function(t,e,i,r){this.notify("element:magnet:contextmenu",t,e,i,r)},dragStart:function(t,e,i){var r=this.getDelegatedView();r&&r.can("elementMove")&&(this.eventData(t,{action:"move",delegatedView:r}),r.eventData(t,{pointerOffset:r.model.position().difference(e,i),restrictedArea:this.paper.getRestrictedArea(r)}))},dragMagnetStart:function(t,e,i){if(this.can("addLinkFromMagnet")){var r=t.currentTarget,n=this.paper;this.eventData(t,{targetMagnet:r}),t.stopPropagation(),n.options.validateMagnet(this,r)?(n.options.magnetThreshold<=0&&this.dragLinkStart(t,r,e,i),this.eventData(t,{action:"magnet"}),this.stopPropagation(t)):this.pointerdown(t,e,i),n.delegateDragEvents(this,t.data)}},dragLinkStart:function(t,e,i,r){this.model.startBatch("add-link");var n=this.addLinkFromMagnet(e,i,r);n.notifyPointerdown(t,i,r),n.eventData(t,n.startArrowheadMove("target",{whenNotAllowed:"remove"})),this.eventData(t,{linkView:n})},addLinkFromMagnet:function(t,e,i){var r=this.paper,n=r.model,o=r.getDefaultLink(this,t);return o.set({source:this.getLinkEnd(t,e,i,o,"source"),target:{x:e,y:i}}).addTo(n,{async:!1,ui:!0}),o.findView(r)},drag:function(t,e,i){var r=this.paper,n=r.options.gridSize,o=this.model,s=this.eventData(t),a=s.pointerOffset,l=s.restrictedArea,h=s.embedding,f=M.snapToGrid(e+a.x,n),u=M.snapToGrid(i+a.y,n);o.position(f,u,{restrictedArea:l,deep:!0,ui:!0}),r.options.embeddingMode&&(h||(this.prepareEmbedding(s),h=!0),this.processEmbedding(s)),this.eventData(t,{embedding:h})},dragMagnet:function(t,e,i){var r=this.eventData(t),n=r.linkView;if(n)n.pointermove(t,e,i);else{var o=this.paper,s=o.options.magnetThreshold,a=this.getEventTarget(t),l=r.targetMagnet;if("onleave"===s){if(l===a||R(l).contains(a))return}else if(o.eventData(t).mousemoved<=s)return;this.dragLinkStart(t,l,e,i)}},dragEnd:function(t,e,i){var r=this.eventData(t);r.embedding&&this.finalizeEmbedding(r)},dragMagnetEnd:function(t,e,i){var r=this.eventData(t).linkView;r&&(r.pointerup(t,e,i),this.model.stopBatch("add-link"))},magnetpointerclick:function(t,e,i,r){var n=this.paper;n.eventData(t).mousemoved>n.options.clickThreshold||this.notify("element:magnet:pointerclick",t,e,i,r)}});C(Pt.prototype,wt);var Mt={_results:{},_tests:{svgforeignobject:function(){return!!document.createElementNS&&/SVGForeignObject/.test({}.toString.call(document.createElementNS("http://www.w3.org/2000/svg","foreignObject")))}},addTest:function(t,e){return this._tests[t]=e},test:function(t){var e=this._tests[t];if(!e)throw new Error('Test not defined ("'+t+'"). Use `joint.env.addTest(name, fn) to add a new test.`');var i=this._results[t];if(void 0!==i)return i;try{i=e()}catch(t){i=!1}return this._results[t]=i}},zt=Ct.define("basic.Generic",{attrs:{".":{fill:"#ffffff",stroke:"none"}}}),Nt=(zt.define("basic.Rect",{attrs:{rect:{fill:"#ffffff",stroke:"#000000",width:100,height:60},text:{fill:"#000000",text:"","font-size":14,"ref-x":.5,"ref-y":.5,"text-anchor":"middle","y-alignment":"middle","font-family":"Arial, helvetica, sans-serif"}}},{markup:'<g class="rotatable"><g class="scalable"><rect/></g><text/></g>'}),Pt.extend({presentationAttributes:Pt.addPresentationAttributes({attrs:["SCALE"]}),confirmUpdate:function(){var t=Pt.prototype.confirmUpdate.apply(this,arguments);return this.hasFlag(t,"SCALE")&&(this.resize(),this.removeFlag(t,"SCALE")),t}}),zt.define("basic.Text",{attrs:{text:{"font-size":18,fill:"#000000"}}},{markup:'<g class="rotatable"><g class="scalable"><text/></g></g>'}),zt.define("basic.Circle",{size:{width:60,height:60},attrs:{circle:{fill:"#ffffff",stroke:"#000000",r:30,cx:30,cy:30},text:{"font-size":14,text:"","text-anchor":"middle","ref-x":.5,"ref-y":.5,"y-alignment":"middle",fill:"#000000","font-family":"Arial, helvetica, sans-serif"}}},{markup:'<g class="rotatable"><g class="scalable"><circle/></g><text/></g>'}),zt.define("basic.Ellipse",{size:{width:60,height:40},attrs:{ellipse:{fill:"#ffffff",stroke:"#000000",rx:30,ry:20,cx:30,cy:20},text:{"font-size":14,text:"","text-anchor":"middle","ref-x":.5,"ref-y":.5,"y-alignment":"middle",fill:"#000000","font-family":"Arial, helvetica, sans-serif"}}},{markup:'<g class="rotatable"><g class="scalable"><ellipse/></g><text/></g>'}),zt.define("basic.Polygon",{size:{width:60,height:40},attrs:{polygon:{fill:"#ffffff",stroke:"#000000"},text:{"font-size":14,text:"","text-anchor":"middle","ref-x":.5,"ref-dy":20,"y-alignment":"middle",fill:"#000000","font-family":"Arial, helvetica, sans-serif"}}},{markup:'<g class="rotatable"><g class="scalable"><polygon/></g><text/></g>'}),zt.define("basic.Polyline",{size:{width:60,height:40},attrs:{polyline:{fill:"#ffffff",stroke:"#000000"},text:{"font-size":14,text:"","text-anchor":"middle","ref-x":.5,"ref-dy":20,"y-alignment":"middle",fill:"#000000","font-family":"Arial, helvetica, sans-serif"}}},{markup:'<g class="rotatable"><g class="scalable"><polyline/></g><text/></g>'}),zt.define("basic.Image",{attrs:{text:{"font-size":14,text:"","text-anchor":"middle","ref-x":.5,"ref-dy":20,"y-alignment":"middle",fill:"#000000","font-family":"Arial, helvetica, sans-serif"}}},{markup:'<g class="rotatable"><g class="scalable"><image/></g><text/></g>'}),zt.define("basic.Path",{size:{width:60,height:60},attrs:{path:{fill:"#ffffff",stroke:"#000000"},text:{"font-size":14,text:"","text-anchor":"middle",ref:"path","ref-x":.5,"ref-dy":10,fill:"#000000","font-family":"Arial, helvetica, sans-serif"}}},{markup:'<g class="rotatable"><g class="scalable"><path/></g><text/></g>'}).define("basic.Rhombus",{attrs:{path:{d:"M 30 0 L 60 30 30 60 0 30 z"},text:{"ref-y":.5,"ref-dy":null,"y-alignment":"middle"}}}),Mt.test("svgforeignobject")),Tt=(zt.define("basic.TextBlock",{attrs:{rect:{fill:"#ffffff",stroke:"#000000",width:80,height:100},text:{fill:"#000000","font-size":14,"font-family":"Arial, helvetica, sans-serif"},".content":{text:"","ref-x":.5,"ref-y":.5,"y-alignment":"middle","x-alignment":"middle"}},content:""},{markup:['<g class="rotatable">','<g class="scalable"><rect/></g>',Nt?'<foreignObject class="fobj"><body xmlns="http://www.w3.org/1999/xhtml"><div class="content"/></body></foreignObject>':'<text class="content"/>',"</g>"].join(""),initialize:function(){this.listenTo(this,"change:size",this.updateSize),this.listenTo(this,"change:content",this.updateContent),this.updateSize(this,this.get("size")),this.updateContent(this,this.get("content")),zt.prototype.initialize.apply(this,arguments)},updateSize:function(t,e){this.attr({".fobj":C({},e),div:{style:C({},e)}})},updateContent:function(t,e){var i,r;Nt?this.attr({".content":{html:(i=e,r=P(P.parseHTML("<div>"+i+"</div>",null,!1)),r.find("*").each(function(){var i=this;P.each(i.attributes,function(){var t=this.name,e=this.value;0!==t.indexOf("on")&&0!==e.indexOf("javascript:")||P(i).removeAttr(t)})}),r.html())}}):this.attr({".content":{text:e}})},setForeignObjectSize:function(){this.updateSize.apply(this,arguments)},setDivContent:function(){this.updateContent.apply(this,arguments)}}),Pt.extend({presentationAttributes:Nt?Pt.prototype.presentationAttributes:Pt.addPresentationAttributes({content:["CONTENT"],size:["CONTENT"]}),initFlag:["RENDER","CONTENT"],confirmUpdate:function(){var t=Pt.prototype.confirmUpdate.apply(this,arguments);return this.hasFlag(t,"CONTENT")&&(this.updateContent(this.model),t=this.removeFlag(t,"CONTENT")),t},update:function(t,e){var i=this.model;if(Nt)Pt.prototype.update.call(this,i,e);else{var r=D(e||i.get("attrs"),".content");Pt.prototype.update.call(this,i,r),e&&!j(e,".content")||this.updateContent(i,e)}},updateContent:function(t,e){var i=G({},(e||t.get("attrs"))[".content"]);i=D(i,"text");var r=c(t.get("content"),t.get("size"),i,{svgDocument:this.paper.svg}),n=v({},".content",i,"/");n[".content"].text=r,Pt.prototype.update.call(this,t,n)}}),zt.define("chess.KingWhite",{size:{width:42,height:38}},{markup:'<g class="rotatable"><g class="scalable"><g style="fill:none; fill-opacity:1; fill-rule:evenodd; stroke:#000000; stroke-width:1.5; stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4; stroke-dasharray:none; stroke-opacity:1;"><path      d="M 22.5,11.63 L 22.5,6"      style="fill:none; stroke:#000000; stroke-linejoin:miter;" />    <path      d="M 20,8 L 25,8"      style="fill:none; stroke:#000000; stroke-linejoin:miter;" />    <path      d="M 22.5,25 C 22.5,25 27,17.5 25.5,14.5 C 25.5,14.5 24.5,12 22.5,12 C 20.5,12 19.5,14.5 19.5,14.5 C 18,17.5 22.5,25 22.5,25"      style="fill:#ffffff; stroke:#000000; stroke-linecap:butt; stroke-linejoin:miter;" />    <path      d="M 11.5,37 C 17,40.5 27,40.5 32.5,37 L 32.5,30 C 32.5,30 41.5,25.5 38.5,19.5 C 34.5,13 25,16 22.5,23.5 L 22.5,27 L 22.5,23.5 C 19,16 9.5,13 6.5,19.5 C 3.5,25.5 11.5,29.5 11.5,29.5 L 11.5,37 z "      style="fill:#ffffff; stroke:#000000;" />    <path      d="M 11.5,30 C 17,27 27,27 32.5,30"      style="fill:none; stroke:#000000;" />    <path      d="M 11.5,33.5 C 17,30.5 27,30.5 32.5,33.5"      style="fill:none; stroke:#000000;" />    <path      d="M 11.5,37 C 17,34 27,34 32.5,37"      style="fill:none; stroke:#000000;" />  </g></g></g>'})),_t=zt.define("chess.KingBlack",{size:{width:42,height:38}},{markup:'<g class="rotatable"><g class="scalable"><g style="fill:none; fill-opacity:1; fill-rule:evenodd; stroke:#000000; stroke-width:1.5; stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4; stroke-dasharray:none; stroke-opacity:1;">    <path       d="M 22.5,11.63 L 22.5,6"       style="fill:none; stroke:#000000; stroke-linejoin:miter;"       id="path6570" />    <path       d="M 22.5,25 C 22.5,25 27,17.5 25.5,14.5 C 25.5,14.5 24.5,12 22.5,12 C 20.5,12 19.5,14.5 19.5,14.5 C 18,17.5 22.5,25 22.5,25"       style="fill:#000000;fill-opacity:1; stroke-linecap:butt; stroke-linejoin:miter;" />    <path       d="M 11.5,37 C 17,40.5 27,40.5 32.5,37 L 32.5,30 C 32.5,30 41.5,25.5 38.5,19.5 C 34.5,13 25,16 22.5,23.5 L 22.5,27 L 22.5,23.5 C 19,16 9.5,13 6.5,19.5 C 3.5,25.5 11.5,29.5 11.5,29.5 L 11.5,37 z "       style="fill:#000000; stroke:#000000;" />    <path       d="M 20,8 L 25,8"       style="fill:none; stroke:#000000; stroke-linejoin:miter;" />    <path       d="M 32,29.5 C 32,29.5 40.5,25.5 38.03,19.85 C 34.15,14 25,18 22.5,24.5 L 22.51,26.6 L 22.5,24.5 C 20,18 9.906,14 6.997,19.85 C 4.5,25.5 11.85,28.85 11.85,28.85"       style="fill:none; stroke:#ffffff;" />    <path       d="M 11.5,30 C 17,27 27,27 32.5,30 M 11.5,33.5 C 17,30.5 27,30.5 32.5,33.5 M 11.5,37 C 17,34 27,34 32.5,37"       style="fill:none; stroke:#ffffff;" />  </g></g></g>'}),St=zt.define("chess.QueenWhite",{size:{width:42,height:38}},{markup:'<g class="rotatable"><g class="scalable"><g style="opacity:1; fill:#ffffff; fill-opacity:1; fill-rule:evenodd; stroke:#000000; stroke-width:1.5; stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4; stroke-dasharray:none; stroke-opacity:1;">    <path      d="M 9 13 A 2 2 0 1 1  5,13 A 2 2 0 1 1  9 13 z"      transform="translate(-1,-1)" />    <path      d="M 9 13 A 2 2 0 1 1  5,13 A 2 2 0 1 1  9 13 z"      transform="translate(15.5,-5.5)" />    <path      d="M 9 13 A 2 2 0 1 1  5,13 A 2 2 0 1 1  9 13 z"      transform="translate(32,-1)" />    <path      d="M 9 13 A 2 2 0 1 1  5,13 A 2 2 0 1 1  9 13 z"      transform="translate(7,-4.5)" />    <path      d="M 9 13 A 2 2 0 1 1  5,13 A 2 2 0 1 1  9 13 z"      transform="translate(24,-4)" />    <path      d="M 9,26 C 17.5,24.5 30,24.5 36,26 L 38,14 L 31,25 L 31,11 L 25.5,24.5 L 22.5,9.5 L 19.5,24.5 L 14,10.5 L 14,25 L 7,14 L 9,26 z "      style="stroke-linecap:butt;" />    <path      d="M 9,26 C 9,28 10.5,28 11.5,30 C 12.5,31.5 12.5,31 12,33.5 C 10.5,34.5 10.5,36 10.5,36 C 9,37.5 11,38.5 11,38.5 C 17.5,39.5 27.5,39.5 34,38.5 C 34,38.5 35.5,37.5 34,36 C 34,36 34.5,34.5 33,33.5 C 32.5,31 32.5,31.5 33.5,30 C 34.5,28 36,28 36,26 C 27.5,24.5 17.5,24.5 9,26 z "      style="stroke-linecap:butt;" />    <path      d="M 11.5,30 C 15,29 30,29 33.5,30"      style="fill:none;" />    <path      d="M 12,33.5 C 18,32.5 27,32.5 33,33.5"      style="fill:none;" />  </g></g></g>'}),Bt=zt.define("chess.QueenBlack",{size:{width:42,height:38}},{markup:'<g class="rotatable"><g class="scalable"><g style="opacity:1; fill:#000000; fill-opacity:1; fill-rule:evenodd; stroke:#000000; stroke-width:1.5; stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4; stroke-dasharray:none; stroke-opacity:1;">    <g style="fill:#000000; stroke:none;">      <circle cx="6"    cy="12" r="2.75" />      <circle cx="14"   cy="9"  r="2.75" />      <circle cx="22.5" cy="8"  r="2.75" />      <circle cx="31"   cy="9"  r="2.75" />      <circle cx="39"   cy="12" r="2.75" />    </g>    <path       d="M 9,26 C 17.5,24.5 30,24.5 36,26 L 38.5,13.5 L 31,25 L 30.7,10.9 L 25.5,24.5 L 22.5,10 L 19.5,24.5 L 14.3,10.9 L 14,25 L 6.5,13.5 L 9,26 z"       style="stroke-linecap:butt; stroke:#000000;" />    <path       d="M 9,26 C 9,28 10.5,28 11.5,30 C 12.5,31.5 12.5,31 12,33.5 C 10.5,34.5 10.5,36 10.5,36 C 9,37.5 11,38.5 11,38.5 C 17.5,39.5 27.5,39.5 34,38.5 C 34,38.5 35.5,37.5 34,36 C 34,36 34.5,34.5 33,33.5 C 32.5,31 32.5,31.5 33.5,30 C 34.5,28 36,28 36,26 C 27.5,24.5 17.5,24.5 9,26 z"       style="stroke-linecap:butt;" />    <path       d="M 11,38.5 A 35,35 1 0 0 34,38.5"       style="fill:none; stroke:#000000; stroke-linecap:butt;" />    <path       d="M 11,29 A 35,35 1 0 1 34,29"       style="fill:none; stroke:#ffffff;" />    <path       d="M 12.5,31.5 L 32.5,31.5"       style="fill:none; stroke:#ffffff;" />    <path       d="M 11.5,34.5 A 35,35 1 0 0 33.5,34.5"       style="fill:none; stroke:#ffffff;" />    <path       d="M 10.5,37.5 A 35,35 1 0 0 34.5,37.5"       style="fill:none; stroke:#ffffff;" />  </g></g></g>'}),Rt=zt.define("chess.RookWhite",{size:{width:32,height:34}},{markup:'<g class="rotatable"><g class="scalable"><g style="opacity:1; fill:#ffffff; fill-opacity:1; fill-rule:evenodd; stroke:#000000; stroke-width:1.5; stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4; stroke-dasharray:none; stroke-opacity:1;">    <path      d="M 9,39 L 36,39 L 36,36 L 9,36 L 9,39 z "      style="stroke-linecap:butt;" />    <path      d="M 12,36 L 12,32 L 33,32 L 33,36 L 12,36 z "      style="stroke-linecap:butt;" />    <path      d="M 11,14 L 11,9 L 15,9 L 15,11 L 20,11 L 20,9 L 25,9 L 25,11 L 30,11 L 30,9 L 34,9 L 34,14"      style="stroke-linecap:butt;" />    <path      d="M 34,14 L 31,17 L 14,17 L 11,14" />    <path      d="M 31,17 L 31,29.5 L 14,29.5 L 14,17"      style="stroke-linecap:butt; stroke-linejoin:miter;" />    <path      d="M 31,29.5 L 32.5,32 L 12.5,32 L 14,29.5" />    <path      d="M 11,14 L 34,14"      style="fill:none; stroke:#000000; stroke-linejoin:miter;" />  </g></g></g>'}),Ft=zt.define("chess.RookBlack",{size:{width:32,height:34}},{markup:'<g class="rotatable"><g class="scalable"><g style="opacity:1; fill:#000000; fill-opacity:1; fill-rule:evenodd; stroke:#000000; stroke-width:1.5; stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4; stroke-dasharray:none; stroke-opacity:1;">    <path      d="M 9,39 L 36,39 L 36,36 L 9,36 L 9,39 z "      style="stroke-linecap:butt;" />    <path      d="M 12.5,32 L 14,29.5 L 31,29.5 L 32.5,32 L 12.5,32 z "      style="stroke-linecap:butt;" />    <path      d="M 12,36 L 12,32 L 33,32 L 33,36 L 12,36 z "      style="stroke-linecap:butt;" />    <path      d="M 14,29.5 L 14,16.5 L 31,16.5 L 31,29.5 L 14,29.5 z "      style="stroke-linecap:butt;stroke-linejoin:miter;" />    <path      d="M 14,16.5 L 11,14 L 34,14 L 31,16.5 L 14,16.5 z "      style="stroke-linecap:butt;" />    <path      d="M 11,14 L 11,9 L 15,9 L 15,11 L 20,11 L 20,9 L 25,9 L 25,11 L 30,11 L 30,9 L 34,9 L 34,14 L 11,14 z "      style="stroke-linecap:butt;" />    <path      d="M 12,35.5 L 33,35.5 L 33,35.5"      style="fill:none; stroke:#ffffff; stroke-width:1; stroke-linejoin:miter;" />    <path      d="M 13,31.5 L 32,31.5"      style="fill:none; stroke:#ffffff; stroke-width:1; stroke-linejoin:miter;" />    <path      d="M 14,29.5 L 31,29.5"      style="fill:none; stroke:#ffffff; stroke-width:1; stroke-linejoin:miter;" />    <path      d="M 14,16.5 L 31,16.5"      style="fill:none; stroke:#ffffff; stroke-width:1; stroke-linejoin:miter;" />    <path      d="M 11,14 L 34,14"      style="fill:none; stroke:#ffffff; stroke-width:1; stroke-linejoin:miter;" />  </g></g></g>'}),jt=zt.define("chess.BishopWhite",{size:{width:38,height:38}},{markup:'<g class="rotatable"><g class="scalable"><g style="opacity:1; fill:none; fill-rule:evenodd; fill-opacity:1; stroke:#000000; stroke-width:1.5; stroke-linecap:round; stroke-linejoin:round; stroke-miterlimit:4; stroke-dasharray:none; stroke-opacity:1;">    <g style="fill:#ffffff; stroke:#000000; stroke-linecap:butt;">       <path        d="M 9,36 C 12.39,35.03 19.11,36.43 22.5,34 C 25.89,36.43 32.61,35.03 36,36 C 36,36 37.65,36.54 39,38 C 38.32,38.97 37.35,38.99 36,38.5 C 32.61,37.53 25.89,38.96 22.5,37.5 C 19.11,38.96 12.39,37.53 9,38.5 C 7.646,38.99 6.677,38.97 6,38 C 7.354,36.06 9,36 9,36 z" />      <path        d="M 15,32 C 17.5,34.5 27.5,34.5 30,32 C 30.5,30.5 30,30 30,30 C 30,27.5 27.5,26 27.5,26 C 33,24.5 33.5,14.5 22.5,10.5 C 11.5,14.5 12,24.5 17.5,26 C 17.5,26 15,27.5 15,30 C 15,30 14.5,30.5 15,32 z" />      <path        d="M 25 8 A 2.5 2.5 0 1 1  20,8 A 2.5 2.5 0 1 1  25 8 z" />    </g>    <path      d="M 17.5,26 L 27.5,26 M 15,30 L 30,30 M 22.5,15.5 L 22.5,20.5 M 20,18 L 25,18"      style="fill:none; stroke:#000000; stroke-linejoin:miter;" />  </g></g></g>'}),Ot=zt.define("chess.BishopBlack",{size:{width:38,height:38}},{markup:'<g class="rotatable"><g class="scalable"><g style="opacity:1; fill:none; fill-rule:evenodd; fill-opacity:1; stroke:#000000; stroke-width:1.5; stroke-linecap:round; stroke-linejoin:round; stroke-miterlimit:4; stroke-dasharray:none; stroke-opacity:1;">    <g style="fill:#000000; stroke:#000000; stroke-linecap:butt;">       <path        d="M 9,36 C 12.39,35.03 19.11,36.43 22.5,34 C 25.89,36.43 32.61,35.03 36,36 C 36,36 37.65,36.54 39,38 C 38.32,38.97 37.35,38.99 36,38.5 C 32.61,37.53 25.89,38.96 22.5,37.5 C 19.11,38.96 12.39,37.53 9,38.5 C 7.646,38.99 6.677,38.97 6,38 C 7.354,36.06 9,36 9,36 z" />      <path        d="M 15,32 C 17.5,34.5 27.5,34.5 30,32 C 30.5,30.5 30,30 30,30 C 30,27.5 27.5,26 27.5,26 C 33,24.5 33.5,14.5 22.5,10.5 C 11.5,14.5 12,24.5 17.5,26 C 17.5,26 15,27.5 15,30 C 15,30 14.5,30.5 15,32 z" />      <path        d="M 25 8 A 2.5 2.5 0 1 1  20,8 A 2.5 2.5 0 1 1  25 8 z" />    </g>    <path       d="M 17.5,26 L 27.5,26 M 15,30 L 30,30 M 22.5,15.5 L 22.5,20.5 M 20,18 L 25,18"       style="fill:none; stroke:#ffffff; stroke-linejoin:miter;" />  </g></g></g>'}),Dt=zt.define("chess.KnightWhite",{size:{width:38,height:37}},{markup:'<g class="rotatable"><g class="scalable"><g style="opacity:1; fill:none; fill-opacity:1; fill-rule:evenodd; stroke:#000000; stroke-width:1.5; stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4; stroke-dasharray:none; stroke-opacity:1;">    <path      d="M 22,10 C 32.5,11 38.5,18 38,39 L 15,39 C 15,30 25,32.5 23,18"      style="fill:#ffffff; stroke:#000000;" />    <path      d="M 24,18 C 24.38,20.91 18.45,25.37 16,27 C 13,29 13.18,31.34 11,31 C 9.958,30.06 12.41,27.96 11,28 C 10,28 11.19,29.23 10,30 C 9,30 5.997,31 6,26 C 6,24 12,14 12,14 C 12,14 13.89,12.1 14,10.5 C 13.27,9.506 13.5,8.5 13.5,7.5 C 14.5,6.5 16.5,10 16.5,10 L 18.5,10 C 18.5,10 19.28,8.008 21,7 C 22,7 22,10 22,10"      style="fill:#ffffff; stroke:#000000;" />    <path      d="M 9.5 25.5 A 0.5 0.5 0 1 1 8.5,25.5 A 0.5 0.5 0 1 1 9.5 25.5 z"      style="fill:#000000; stroke:#000000;" />    <path      d="M 15 15.5 A 0.5 1.5 0 1 1  14,15.5 A 0.5 1.5 0 1 1  15 15.5 z"      transform="matrix(0.866,0.5,-0.5,0.866,9.693,-5.173)"      style="fill:#000000; stroke:#000000;" />  </g></g></g>'}),It=zt.define("chess.KnightBlack",{size:{width:38,height:37}},{markup:'<g class="rotatable"><g class="scalable"><g style="opacity:1; fill:none; fill-opacity:1; fill-rule:evenodd; stroke:#000000; stroke-width:1.5; stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4; stroke-dasharray:none; stroke-opacity:1;">    <path      d="M 22,10 C 32.5,11 38.5,18 38,39 L 15,39 C 15,30 25,32.5 23,18"      style="fill:#000000; stroke:#000000;" />    <path      d="M 24,18 C 24.38,20.91 18.45,25.37 16,27 C 13,29 13.18,31.34 11,31 C 9.958,30.06 12.41,27.96 11,28 C 10,28 11.19,29.23 10,30 C 9,30 5.997,31 6,26 C 6,24 12,14 12,14 C 12,14 13.89,12.1 14,10.5 C 13.27,9.506 13.5,8.5 13.5,7.5 C 14.5,6.5 16.5,10 16.5,10 L 18.5,10 C 18.5,10 19.28,8.008 21,7 C 22,7 22,10 22,10"      style="fill:#000000; stroke:#000000;" />    <path      d="M 9.5 25.5 A 0.5 0.5 0 1 1 8.5,25.5 A 0.5 0.5 0 1 1 9.5 25.5 z"      style="fill:#ffffff; stroke:#ffffff;" />    <path      d="M 15 15.5 A 0.5 1.5 0 1 1  14,15.5 A 0.5 1.5 0 1 1  15 15.5 z"      transform="matrix(0.866,0.5,-0.5,0.866,9.693,-5.173)"      style="fill:#ffffff; stroke:#ffffff;" />    <path      d="M 24.55,10.4 L 24.1,11.85 L 24.6,12 C 27.75,13 30.25,14.49 32.5,18.75 C 34.75,23.01 35.75,29.06 35.25,39 L 35.2,39.5 L 37.45,39.5 L 37.5,39 C 38,28.94 36.62,22.15 34.25,17.66 C 31.88,13.17 28.46,11.02 25.06,10.5 L 24.55,10.4 z "      style="fill:#ffffff; stroke:none;" />  </g></g></g>'}),Vt=zt.define("chess.PawnWhite",{size:{width:28,height:33}},{markup:'<g class="rotatable"><g class="scalable"><path d="M 22,9 C 19.79,9 18,10.79 18,13 C 18,13.89 18.29,14.71 18.78,15.38 C 16.83,16.5 15.5,18.59 15.5,21 C 15.5,23.03 16.44,24.84 17.91,26.03 C 14.91,27.09 10.5,31.58 10.5,39.5 L 33.5,39.5 C 33.5,31.58 29.09,27.09 26.09,26.03 C 27.56,24.84 28.5,23.03 28.5,21 C 28.5,18.59 27.17,16.5 25.22,15.38 C 25.71,14.71 26,13.89 26,13 C 26,10.79 24.21,9 22,9 z "  style="opacity:1; fill:#ffffff; fill-opacity:1; fill-rule:nonzero; stroke:#000000; stroke-width:1.5; stroke-linecap:round; stroke-linejoin:miter; stroke-miterlimit:4; stroke-dasharray:none; stroke-opacity:1;" /></g></g>'}),qt=zt.define("chess.PawnBlack",{size:{width:28,height:33}},{markup:'<g class="rotatable"><g class="scalable"><path d="M 22,9 C 19.79,9 18,10.79 18,13 C 18,13.89 18.29,14.71 18.78,15.38 C 16.83,16.5 15.5,18.59 15.5,21 C 15.5,23.03 16.44,24.84 17.91,26.03 C 14.91,27.09 10.5,31.58 10.5,39.5 L 33.5,39.5 C 33.5,31.58 29.09,27.09 26.09,26.03 C 27.56,24.84 28.5,23.03 28.5,21 C 28.5,18.59 27.17,16.5 25.22,15.38 C 25.71,14.71 26,13.89 26,13 C 26,10.79 24.21,9 22,9 z "  style="opacity:1; fill:#000000; fill-opacity:1; fill-rule:nonzero; stroke:#000000; stroke-width:1.5; stroke-linecap:round; stroke-linejoin:miter; stroke-miterlimit:4; stroke-dasharray:none; stroke-opacity:1;" /></g></g>'});t.KingWhite=Tt,t.KingBlack=_t,t.QueenWhite=St,t.QueenBlack=Bt,t.RookWhite=Rt,t.RookBlack=Ft,t.BishopWhite=jt,t.BishopBlack=Ot,t.KnightWhite=Dt,t.KnightBlack=It,t.PawnWhite=Vt,t.PawnBlack=qt}(this.joint.shapes.chess=this.joint.shapes.chess||{},Backbone,_,$,V,g);