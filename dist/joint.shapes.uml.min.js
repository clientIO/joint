/*! JointJS v3.0.0-beta (2019-06-06) - JavaScript diagramming library


This Source Code Form is subject to the terms of the Mozilla Public
License, v. 2.0. If a copy of the MPL was not distributed with this
file, You can obtain one at http://mozilla.org/MPL/2.0/.
*/
this.joint=this.joint||{},this.joint.shapes=this.joint.shapes||{},function(t,n,i,T,L,S){"use strict";n=n&&n.hasOwnProperty("default")?n.default:n,i=i&&i.hasOwnProperty("default")?i.default:i,T=T&&T.hasOwnProperty("default")?T.default:T,L=L&&L.hasOwnProperty("default")?L.default:L;var e,r,s="joint-",o=function(t){return t?t.toString().split(" ").map(function(t){return t.substr(0,s.length)!==s&&(t=s+t),t}).join(" "):t},a=function(t,e){for(var i={},r={},n=L.namespace.svg,s=e||n,o=document.createDocumentFragment(),a=[t,o,s];0<a.length;){s=a.pop();for(var l=a.pop(),h=a.pop(),u=0,c=h.length;u<c;u++){var f=h[u];if(!f.hasOwnProperty("tagName"))throw new Error("json-dom-parser: missing tagName");var d=f.tagName;f.hasOwnProperty("namespaceURI")&&(s=f.namespaceURI);var p=document.createElementNS(s,d),g=s===n,m=g?L:T,v=f.attributes;v&&m(p).attr(v);var y=f.style;if(y&&T(p).css(y),f.hasOwnProperty("className")){var b=f.className;g?p.className.baseVal=b:p.className=b}if(f.hasOwnProperty("textContent")&&(p.textContent=f.textContent),f.hasOwnProperty("selector")){var x=f.selector;if(i[x])throw new Error("json-dom-parser: selector must be unique");m(i[x]=p).attr("joint-selector",x)}if(f.hasOwnProperty("groupSelector")){var w=f.groupSelector;Array.isArray(w)||(w=[w]);for(var E=0,k=w.length;E<k;E++){var A=w[E],P=r[A];P||(P=r[A]=[]),P.push(p)}}l.appendChild(p);var C=f.children;Array.isArray(C)&&a.push(C,p,s)}}return{fragment:o,selectors:i,groupSelectors:r}},m=function(t,e,i){for(var r,n=Array.isArray(e)?e.slice():e.split(i||"/");n.length;){if(r=n.shift(),!(Object(t)===t&&r in t))return;t=t[r]}return t},v=function(t,e,i,r){for(var n=Array.isArray(e)?e:e.split(r||"/"),s=t,o=0,a=n.length;o<a-1;o++)s=s[n[o]]||(s[n[o]]={});return s[n[a-1]]=i,t},y=function(t,e,i){i=i||"/";var r=Array.isArray(e)?e.slice():e.split(i),n=r.pop();if(0<r.length){var s=m(t,r,i);s&&delete s[n]}else delete t[n];return t},l=function(t){return l.id=l.id||1,t.id=void 0===t.id?"j_"+l.id++:t.id,t.id},h=function(){var n;if("undefined"!=typeof window&&(n=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame),!n){var s=0;n=function(t){var e=(new Date).getTime(),i=Math.max(0,16-(e-s)),r=setTimeout(function(){t(e+i)},i);return s=e+i,r}}return function(t,e){for(var i=[],r=arguments.length-2;0<r--;)i[r]=arguments[r+2];return n(void 0!==e?t.bind.apply(t,[e].concat(i)):t)}}(),u=((r="undefined"!=typeof window)&&(e=window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.webkitCancelRequestAnimationFrame||window.msCancelAnimationFrame||window.msCancelRequestAnimationFrame||window.oCancelAnimationFrame||window.oCancelRequestAnimationFrame||window.mozCancelAnimationFrame||window.mozCancelRequestAnimationFrame),e=e||clearTimeout,r?e.bind(window):e),c=function(t){return W(t)&&"%"===t.slice(-1)},F=function(t,e){var i=parseFloat(t);if(Number.isNaN(i))return null;var r,n={};if(n.value=i,null==e)r="[A-Za-z]*";else if(Array.isArray(e)){if(0===e.length)return null;r=e.join("|")}else W(e)&&(r=e);var s,o=(s=new RegExp("(?:\\d+(?:\\.\\d+)*)("+r+")$").exec(t))?s[1]:null;return null===o?null:(n.unit=o,n)},f=function(t,e,i,r){r=r||{},i=i||{};var n=e.width,s=e.height,o=r.svgDocument||L("svg").node,a=L("tspan").node,l=L("text").attr(i).append(a).node,h=document.createTextNode("");l.style.opacity=0,l.style.display="block",a.style.display="block",a.appendChild(h),o.appendChild(l),r.svgDocument||document.body.appendChild(o);for(var u,c,f,d=r.separator||" ",p=r.eol||"\n",g=r.hyphen?new RegExp(r.hyphen):/[^\w\d]/,m=t.split(d),v=[],y=[],b=0,x=0,w=m.length;b<w;b++){var E=m[b];if(E)if(p&&0<=E.indexOf(p))if(1<E.length){for(var k=E.split(p),A=0,P=k.length-1;A<P;A++)k.splice(2*A+1,0,p);Array.prototype.splice.apply(m,[b,1].concat(k)),b--,w+=k.length-1}else x++;else{if(h.data=y[x]?y[x]+" "+E:E,a.getComputedTextLength()<=n)y[x]=h.data,(u||c)&&(v[x++]=!0,c=u=0);else{if(!y[x]||u){var C=!!u;if(u=E.length-1,C||!u){if(!u){if(!y[x]){y=[];break}m.splice(b,2,E+m[b+1]),w--,v[x++]=!0,b--;continue}m[b]=E.substring(0,u),m[b+1]=E.substring(u)+m[b+1]}else{if(c)m.splice(b,2,m[b]+m[b+1]),c=0;else{var T=E.search(g);-1<T&&T!==E.length-1&&0!==T&&(c=T+1,u=0),m.splice(b,1,E.substring(0,c||u),E.substring(c||u)),w++}x&&!v[x-1]&&x--}b--;continue}x++,b--}if(void 0!==s){var S;if(void 0===f)f=(S="auto"===i.lineHeight?{value:1.5,unit:"em"}:F(i.lineHeight,["em"])||{value:1,unit:"em"}).value,"em"===S.unit&&(f*=l.getBBox().height);if(f*y.length>s){var N=Math.floor(s/f)-1;y.splice(N+1);var z=r.ellipsis;if(!z||N<0)break;"string"!=typeof z&&(z="â€¦");var _,R,M=y[N],B=M.length;do{if(R=M[B],_=M.substring(0,B),R?R.match(d)&&(_+=R):_+="string"==typeof d?d:" ",_+=z,h.data=_,a.getComputedTextLength()<=n){y[N]=_;break}B--}while(0<=B);break}}}}return r.svgDocument?o.removeChild(l):document.body.removeChild(o),y.join(p)},d={linear:function(t){return t},quad:function(t){return t*t},cubic:function(t){return t*t*t},inout:function(t){if(t<=0)return 0;if(1<=t)return 1;var e=t*t,i=e*t;return 4*(t<.5?i:3*(t-e)+i-.75)},exponential:function(t){return Math.pow(2,10*(t-1))},bounce:function(t){for(var e=0,i=1;;e+=i,i/=2)if((7-4*e)/11<=t){var r=(11-6*e-11*t)/4;return-r*r+i*i}},reverse:function(e){return function(t){return 1-e(1-t)}},reflect:function(e){return function(t){return.5*(t<.5?e(2*t):2-e(2-2*t))}},clamp:function(i,r,n){return r=r||0,n=n||1,function(t){var e=i(t);return e<r?r:n<e?n:e}},back:function(e){return e||(e=1.70158),function(t){return t*t*((e+1)*t-e)}},elastic:function(e){return e||(e=1.5),function(t){return Math.pow(2,10*(t-1))*Math.cos(20*Math.PI*e/3*t)}}},p={number:function(e,t){var i=t-e;return function(t){return e+i*t}},object:function(n,s){var o=Object.keys(n);return function(t){var e,i,r={};for(e=o.length-1;-1!=e;e--)r[i=o[e]]=n[i]+(s[i]-n[i])*t;return r}},hexColor:function(t,e){var i=parseInt(t.slice(1),16),r=parseInt(e.slice(1),16),n=255&i,s=(255&r)-n,o=65280&i,a=(65280&r)-o,l=16711680&i,h=(16711680&r)-l;return function(t){return"#"+(1<<24|n+s*t&255|o+a*t&65280|l+h*t&16711680).toString(16).slice(1)}},unit:function(e,t){var i=/(-?[0-9]*.[0-9]*)(px|em|cm|mm|in|pt|pc|%)/,r=i.exec(e),n=i.exec(t),s=n[1].indexOf("."),o=0<s?n[1].length-s-1:0;e=+r[1];var a=+n[1]-e,l=r[2];return function(t){return(e+a*t).toFixed(o)+l}}},k=(i.assign,i.defaults,i.defaultsDeep,i.assign),b=i.defaults,x=i.defaultsDeep,w=i.invokeMap||i.invoke,E=i.sortedIndexBy||i.sortedIndex,A=i.uniqBy||i.uniq,P=i.clone,C=i.cloneDeep,N=i.isEmpty,z=i.isEqual,_=i.isFunction,R=i.isPlainObject,M=i.toArray,B=(i.debounce,i.groupBy),O=(i.sortBy,i.flattenDeep,i.without),D=(i.difference,i.intersection,i.union,i.has),j=i.result,I=i.omit,V=i.pick,q=(i.bindAll,i.forIn),G=(i.camelCase,i.uniqueId),U=function(){if(i.mergeWith){var t=Array.from(arguments),e=t[t.length-1],r=_(e)?e:J;return t.push(function(t,e){var i=r(t,e);return void 0!==i?i:Array.isArray(t)&&!Array.isArray(e)?e:void 0}),i.mergeWith.apply(this,t)}return i.merge.apply(this,arguments)},$=function(t){return!!t&&("object"==typeof t||"function"==typeof t)},H=function(t){var e=Object.prototype.toString;return"number"==typeof t||!!t&&"object"==typeof t&&"[object Number]"===e.call(t)},W=function(t){var e=Object.prototype.toString;return"string"==typeof t||!!t&&"object"==typeof t&&"[object String]"===e.call(t)},J=function(){};function Z(s,o){return function(t,e){var i=c(t);t=parseFloat(t),i&&(t/=100);var r={};if(isFinite(t)){var n=i||0<=t&&t<=1?t*e[o]:Math.max(t+e[o],0);r[s]=n}return r}}function Y(o,a,l){return function(t,e){var i,r=c(t);if(t=parseFloat(t),r&&(t/=100),isFinite(t)){var n=e[l]();i=r||0<t&&t<1?n[o]+e[a]*t:n[o]+t}var s=S.Point();return s[o]=i||0,s}}function K(n,s,o){return function(t,e){var i;i="middle"===t?e[s]/2:t===o?e[s]:isFinite(t)?-1<t&&t<1?-e[s]*t:-t:c(t)?e[s]*parseFloat(t)/100:0;var r=S.Point();return r[n]=-(e[n]+i),r}}function X(d,t){var p="joint-shape",g=t&&t.resetOffset;return function(t,e,i){var r=T(i),n=r.data(p);if(!n||n.value!==t){var s=d(t);n={value:t,shape:s,shapeBBox:s.bbox()},r.data(p,n)}var o=n.shape.clone(),a=n.shapeBBox.clone(),l=a.origin(),h=e.origin();a.x=h.x,a.y=h.y;var u=e.maxRectScaleToFit(a,h),c=0===a.width||0===e.width?1:u.sx,f=0===a.height||0===e.height?1:u.sy;return o.scale(c,f,l),g&&o.translate(-l.x,-l.y),o}}function Q(t){var r=X(function(t){return new S.Path(L.normalizePathData(t))},t);return function(t,e,i){return{d:r(t,e,i).serialize()}}}function tt(t){var r=X(S.Polyline,t);return function(t,e,i){return{points:r(t,e,i).serialize()}}}function et(n,s){var o=new S.Point(1,0);return function(t){var e,i,r=this[n](t);return r?(i=s.rotate?r.vector().vectorAngle(o):0,e=r.start):(e=this.path.start,i=0),0===i?{transform:"translate("+e.x+","+e.y+")"}:{transform:"translate("+e.x+","+e.y+") rotate("+i+")"}}}function it(t,e,i){return void 0!==i.text}function rt(){return this.model.isLink()}function nt(t){var e={},i=t.stroke;"string"==typeof i&&(e.stroke=i,e.fill=i);var r=t.strokeOpacity;return void 0===r&&(r=t["stroke-opacity"]),void 0===r&&(r=t.opacity),void 0!==r&&(e["stroke-opacity"]=r,e["fill-opacity"]=r),e}var st,ot,at={xlinkHref:{set:"xlink:href"},xlinkShow:{set:"xlink:show"},xlinkRole:{set:"xlink:role"},xlinkType:{set:"xlink:type"},xlinkArcrole:{set:"xlink:arcrole"},xlinkTitle:{set:"xlink:title"},xlinkActuate:{set:"xlink:actuate"},xmlSpace:{set:"xml:space"},xmlBase:{set:"xml:base"},xmlLang:{set:"xml:lang"},preserveAspectRatio:{set:"preserveAspectRatio"},requiredExtension:{set:"requiredExtension"},requiredFeatures:{set:"requiredFeatures"},systemLanguage:{set:"systemLanguage"},externalResourcesRequired:{set:"externalResourceRequired"},filter:{qualify:R,set:function(t){return"url(#"+this.paper.defineFilter(t)+")"}},fill:{qualify:R,set:function(t){return"url(#"+this.paper.defineGradient(t)+")"}},stroke:{qualify:R,set:function(t){return"url(#"+this.paper.defineGradient(t)+")"}},sourceMarker:{qualify:R,set:function(t,e,i,r){return t=k(nt(r),t),{"marker-start":"url(#"+this.paper.defineMarker(t)+")"}}},targetMarker:{qualify:R,set:function(t,e,i,r){return t=k(nt(r),{transform:"rotate(180)"},t),{"marker-end":"url(#"+this.paper.defineMarker(t)+")"}}},vertexMarker:{qualify:R,set:function(t,e,i,r){return t=k(nt(r),t),{"marker-mid":"url(#"+this.paper.defineMarker(t)+")"}}},text:{qualify:function(t,e,i){return!i.textWrap||!R(i.textWrap)},set:function(t,e,i,r){var n=T(i),s="joint-text",o=n.data(s),a=V(r,"lineHeight","annotations","textPath","x","textVerticalAnchor","eol"),l=a.fontSize=r["font-size"]||r.fontSize,h=JSON.stringify([t,a]);if(void 0===o||o!==h){l&&i.setAttribute("font-size",l);var u=a.textPath;if($(u)){var c=u.selector;if("string"==typeof c){var f=this.findBySelector(c)[0];f instanceof SVGPathElement&&(a.textPath=k({"xlink:href":"#"+f.id},u))}}L(i).text(""+t,a),n.data(s,h)}}},textWrap:{qualify:R,set:function(t,e,i,r){var n=t.width||0;c(n)?e.width*=parseFloat(n)/100:n<=0?e.width+=n:e.width=n;var s,o=t.height||0;c(o)?e.height*=parseFloat(o)/100:o<=0?e.height+=o:e.height=o;var a=t.text;void 0===a&&(a=r.text),s=void 0!==a?f(""+a,e,{"font-weight":r["font-weight"]||r.fontWeight,"font-size":r["font-size"]||r.fontSize,"font-family":r["font-family"]||r.fontFamily,lineHeight:r.lineHeight},{svgDocument:this.paper.svg,ellipsis:t.ellipsis,hyphen:t.hyphen}):"",at.text.set.call(this,s,e,i,r)}},title:{qualify:function(t,e){return e instanceof SVGElement},set:function(t,e,i){var r=T(i),n="joint-title",s=r.data(n);if(void 0===s||s!==t){r.data(n,t);var o=i.firstChild;if(o&&"TITLE"===o.tagName.toUpperCase())o.textContent=t;else{var a=document.createElementNS(i.namespaceURI,"title");a.textContent=t,i.insertBefore(a,o)}}}},lineHeight:{qualify:it},textVerticalAnchor:{qualify:it},textPath:{qualify:it},annotations:{qualify:it},port:{set:function(t){return null===t||void 0===t.id?t:t.id}},style:{qualify:R,set:function(t,e,i){T(i).css(t)}},html:{set:function(t,e,i){T(i).html(t+"")}},ref:{},refX:{position:Y("x","width","origin")},refY:{position:Y("y","height","origin")},refDx:{position:Y("x","width","corner")},refDy:{position:Y("y","height","corner")},refWidth:{set:Z("width","width")},refHeight:{set:Z("height","height")},refRx:{set:Z("rx","width")},refRy:{set:Z("ry","height")},refRInscribed:{set:(st=Z("r","width"),ot=Z("r","height"),function(t,e){return(e.height>e.width?st:ot)(t,e)})},refRCircumscribed:{set:function(t,e){var i=c(t);t=parseFloat(t),i&&(t/=100);var r,n=Math.sqrt(e.height*e.height+e.width*e.width);return isFinite(t)&&(r=i||0<=t&&t<=1?t*n:Math.max(t+n,0)),{r:r}}},refCx:{set:Z("cx","width")},refCy:{set:Z("cy","height")},xAlignment:{offset:K("x","width","right")},yAlignment:{offset:K("y","height","bottom")},resetOffset:{offset:function(t,e){return t?{x:-e.x,y:-e.y}:{x:0,y:0}}},refDResetOffset:{set:Q({resetOffset:!0})},refDKeepOffset:{set:Q({resetOffset:!1})},refPointsResetOffset:{set:tt({resetOffset:!0})},refPointsKeepOffset:{set:tt({resetOffset:!1})},connection:{qualify:rt,set:function(){return{d:this.getSerializedConnection()}}},atConnectionLengthKeepGradient:{qualify:rt,set:et("getTangentAtLength",{rotate:!0})},atConnectionLengthIgnoreGradient:{qualify:rt,set:et("getTangentAtLength",{rotate:!1})},atConnectionRatioKeepGradient:{qualify:rt,set:et("getTangentAtRatio",{rotate:!0})},atConnectionRatioIgnoreGradient:{qualify:rt,set:et("getTangentAtRatio",{rotate:!1})}};at.refR=at.refRInscribed,at.refD=at.refDResetOffset,at.refPoints=at.refPointsResetOffset,at.atConnectionLength=at.atConnectionLengthKeepGradient,at.atConnectionRatio=at.atConnectionRatioKeepGradient,at.refX2=at.refX,at.refY2=at.refY,at.refWidth2=at.refWidth,at.refHeight2=at.refHeight,at["ref-x"]=at.refX,at["ref-y"]=at.refY,at["ref-dy"]=at.refDy,at["ref-dx"]=at.refDx,at["ref-width"]=at.refWidth,at["ref-height"]=at.refHeight,at["x-alignment"]=at.xAlignment,at["y-alignment"]=at.yAlignment;var lt=at,ht=n.Model.extend({constructor:function(t,e){var i,r=t||{};this.cid=G("c"),this.attributes={},e&&e.collection&&(this.collection=e.collection),e&&e.parse&&(r=this.parse(r,e)||{}),(i=j(this,"defaults"))&&(r=U({},i,r)),this.set(r,e),this.changed={},this.initialize.apply(this,arguments)},translate:function(t,e,i){throw new Error("Must define a translate() method.")},toJSON:function(){var e=this.constructor.prototype.defaults.attrs||{},t=this.attributes.attrs,s={};q(t,function(t,r){var n=e[r];q(t,function(t,i){$(t)&&!Array.isArray(t)?q(t,function(t,e){n&&n[i]&&z(n[i][e],t)||(s[r]=s[r]||{},(s[r][i]||(s[r][i]={}))[e]=t)}):n&&z(n[i],t)||(s[r]=s[r]||{},s[r][i]=t)})});var i=C(I(this.attributes,"attrs"));return i.attrs=s,i},initialize:function(t){t&&t.id||this.set("id",this.generateId(),{silent:!0}),this._transitionIds={},this.processPorts(),this.on("change:attrs",this.processPorts,this)},generateId:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)})},processPorts:function(){var t=this.ports,i={};q(this.get("attrs"),function(t,e){t&&t.port&&(void 0!==t.port.id?i[t.port.id]=t.port:i[t.port]={id:t.port})});var r={};(q(t,function(t,e){i[e]||(r[e]=!0)}),this.graph&&!N(r))&&(this.graph.getConnectedLinks(this,{inbound:!0}).forEach(function(t){r[t.get("target").port]&&t.remove()}),this.graph.getConnectedLinks(this,{outbound:!0}).forEach(function(t){r[t.get("source").port]&&t.remove()}));this.ports=i},remove:function(t){t=t||{};var e=this.graph;if(!e)return this.collection&&this.collection.remove(this,t),this;e.startBatch("remove");var i=this.getParentCell();i&&i.unembed(this);for(var r=this.getEmbeddedCells(),n=0,s=r.length;n<s;n++){var o=r[n];o&&o.remove(t)}return this.trigger("remove",this,e.attributes.cells,t),e.stopBatch("remove"),this},toFront:function(i){var t=this.graph;if(t){i=i||{};var e,r=t.maxZIndex();i.deep?(e=this.getEmbeddedCells({deep:!0,breadthFirst:!0})).unshift(this):e=[this],r=r-e.length+1;var n=t.get("cells"),s=n.indexOf(this)!==n.length-e.length;s||(s=e.some(function(t,e){return t.get("z")!==r+e})),s&&(this.startBatch("to-front"),r+=e.length,e.forEach(function(t,e){t.set("z",r+e,i)}),this.stopBatch("to-front"))}return this},toBack:function(i){var t=this.graph;if(t){i=i||{};var e,r=t.minZIndex();i.deep?(e=this.getEmbeddedCells({deep:!0,breadthFirst:!0})).unshift(this):e=[this];var n=0!==t.get("cells").indexOf(this);n||(n=e.some(function(t,e){return t.get("z")!==r+e})),n&&(this.startBatch("to-back"),r-=e.length,e.forEach(function(t,e){t.set("z",r+e,i)}),this.stopBatch("to-back"))}return this},parent:function(t,e){return void 0===t?this.get("parent"):this.set("parent",t,e)},embed:function(t,e){if(this===t||this.isEmbeddedIn(t))throw new Error("Recursive embedding not allowed.");this.startBatch("embed");var i=k([],this.get("embeds"));return i[t.isLink()?"unshift":"push"](t.id),t.parent(this.id,e),this.set("embeds",A(i),e),this.stopBatch("embed"),this},unembed:function(t,e){return this.startBatch("unembed"),t.unset("parent",e),this.set("embeds",O(this.get("embeds"),t.id),e),this.stopBatch("unembed"),this},getParentCell:function(){var t=this.parent(),e=this.graph;return t&&e&&e.getCell(t)||null},getAncestors:function(){var t=[];if(!this.graph)return t;for(var e=this.getParentCell();e;)t.push(e),e=e.getParentCell();return t},getEmbeddedCells:function(e){if(e=e||{},this.graph){var i;if(e.deep)if(e.breadthFirst){i=[];for(var t=this.getEmbeddedCells();0<t.length;){var r=t.shift();i.push(r),t.push.apply(t,r.getEmbeddedCells())}}else(i=this.getEmbeddedCells()).forEach(function(t){i.push.apply(i,t.getEmbeddedCells(e))});else i=M(this.get("embeds")).map(this.graph.getCell,this.graph);return i}return[]},isEmbeddedIn:function(t,e){var i=W(t)?t:t.id,r=this.parent();if(e=b({deep:!0},e),this.graph&&e.deep){for(;r;){if(r===i)return!0;r=this.graph.getCell(r).parent()}return!1}return r===i},isEmbedded:function(){return!!this.parent()},clone:function(t){if((t=t||{}).deep)return M(function(t){t=A(t);var o=M(t).reduce(function(t,e){return t[e.id]=e.clone(),t},{});return M(t).forEach(function(t){var e=o[t.id];if(e.isLink()){var i=e.source(),r=e.target();i.id&&o[i.id]&&e.prop("source/id",o[i.id].id),r.id&&o[r.id]&&e.prop("target/id",o[r.id].id)}var n=t.get("parent");n&&o[n]&&e.set("parent",o[n].id);var s=M(t.get("embeds")).reduce(function(t,e){return o[e]&&t.push(o[e].id),t},[]);N(s)||e.set("embeds",s)}),o}([this].concat(this.getEmbeddedCells({deep:!0}))));var e=n.Model.prototype.clone.apply(this,arguments);return e.set("id",this.generateId()),e.unset("embeds"),e.unset("parent"),e},prop:function(t,e,i){var r=W(t);if(r||Array.isArray(t)){if(1<arguments.length){var n,s,o=(s=r?(n=t).split("/"):(n=t.join("/"),t.slice()))[0],a=s.length;if((i=i||{}).propertyPath=n,i.propertyValue=e,i.propertyPathArray=s,1===a)return this.set(o,e,i);for(var l={},h=l,u=o,c=1;c<a;c++){var f=s[c],d=Number.isFinite(r?Number(f):f);h=h[u]=d?[]:{},u=f}l=v(l,s,e,"/");var p=U({},this.attributes);i.rewrite&&y(p,n,"/");var g=U(p,l);return this.set(o,g[o],i)}return m(this.attributes,t,"/")}return this.set(U({},this.attributes,t),e)},removeProp:function(t,e){e=e||{};var i=Array.isArray(t)?t:t.split("/"),r=i[0];if("attrs"===r&&(e.dirty=!0),1===i.length)return this.unset(t,e);var n=i.slice(1),s=C(this.get(r));return y(s,n,"/"),this.set(r,s,e)},attr:function(t,e,i){var r=Array.from(arguments);return 0===r.length?this.get("attrs"):(Array.isArray(t)?r[0]=["attrs"].concat(t):W(t)?r[0]="attrs/"+t:r[0]={attrs:t},this.prop.apply(this,r))},removeAttr:function(t,e){return Array.isArray(t)?this.removeProp(["attrs"].concat(t)):this.removeProp("attrs/"+t,e)},transition:function(n,e,s,i){i=i||"/",s=k({duration:100,delay:10,timingFunction:d.linear,valueFunction:p.number},s);var o,a=0,l=function(t){var e,i,r;(i=(t-=a=a||t)/s.duration)<1?this._transitionIds[n]=e=h(l):(i=1,delete this._transitionIds[n]),r=o(s.timingFunction(i)),s.transitionId=e,this.prop(n,r,s),e||this.trigger("transition:end",this,n)}.bind(this),t=function(t){this.stopTransitions(n),o=s.valueFunction(m(this.attributes,n,i),e),this._transitionIds[n]=h(t),this.trigger("transition:start",this,n)}.bind(this);return setTimeout(t,s.delay,l)},getTransitions:function(){return Object.keys(this._transitionIds)},stopTransitions:function(t,e){e=e||"/";var i=t&&t.split(e);return Object.keys(this._transitionIds).filter(i&&function(t){return z(i,t.split(e).slice(0,i.length))}).forEach(function(t){u(this._transitionIds[t]),delete this._transitionIds[t],this.trigger("transition:end",this,t)},this),this},addTo:function(t,e){return t.addCell(this,e),this},findView:function(t){return t.findViewByModel(this)},isElement:function(){return!1},isLink:function(){return!1},startBatch:function(t,e){return this.graph&&this.graph.startBatch(t,k({},e,{cell:this})),this},stopBatch:function(t,e){return this.graph&&this.graph.stopBatch(t,k({},e,{cell:this})),this},getChangeFlag:function(t){var e=0;if(!t)return e;for(var i in t)t.hasOwnProperty(i)&&this.hasChanged(i)&&(e|=t[i]);return e},angle:function(){return 0},position:function(){return new g.Point(0,0)},getPointFromConnectedLink:function(){return new g.Point},getBBox:function(){return new g.Rect(0,0,0,0)}},{getAttributeDefinition:function(t){var e=this.attributes,i=lt;return e&&e[t]||i[t]},define:function(t,e,i,r){i=k({defaults:x({type:t},e,this.prototype.defaults)},i);var n=this.extend(i,r);return"undefined"!=typeof joint&&D(joint,"shapes")&&v(joint.shapes,t,n,"."),n}}),ut={},ct=n.View.extend({options:{},theme:null,themeClassNamePrefix:o("theme-"),requireSetThemeOverride:!1,defaultTheme:"default",children:null,childNodes:null,UPDATE_PRIORITY:2,constructor:function(t){this.requireSetThemeOverride=t&&!!t.theme,this.options=k({},this.options,t),n.View.call(this,t)},initialize:function(){(ut[this.cid]=this).setTheme(this.options.theme||this.defaultTheme),this.init()},unmount:function(){this.svgElement?this.vel.remove():this.$el.remove()},renderChildren:function(t){if(t||(t=j(this,"children")),t){var e=this.svgElement,i=L.namespace[e?"svg":"xhtml"],r=a(t,i);(e?this.vel:this.$el).empty().append(r.fragment),this.childNodes=r.selectors}return this},findAttribute:function(t,e){for(var i=e;i&&1===i.nodeType;){var r=i.getAttribute(t);if(r)return r;if(i===this.el)return null;i=i.parentNode}return null},_ensureElement:function(){if(this.el)this.setElement(j(this,"el"));else{var t=j(this,"tagName"),e=k({},j(this,"attributes")),i=k({},j(this,"style"));this.id&&(e.id=j(this,"id")),this.setElement(this._createElement(t)),this._setAttributes(e),this._setStyle(i)}this._ensureElClassName()},_setAttributes:function(t){this.svgElement?this.vel.attr(t):this.$el.attr(t)},_setStyle:function(t){this.$el.css(t)},_createElement:function(t){return this.svgElement?document.createElementNS(L.namespace.svg,t):document.createElement(t)},_setElement:function(t){this.$el=t instanceof n.$?t:n.$(t),this.el=this.$el[0],this.svgElement&&(this.vel=L(this.el))},_ensureElClassName:function(){var t=j(this,"className");if(t){var e=o(t);this.svgElement?this.vel.removeClass(t).addClass(e):this.$el.removeClass(t).addClass(e)}},init:function(){},onRender:function(){},confirmUpdate:function(){return 0},setTheme:function(t,e){return e=e||{},this.theme&&this.requireSetThemeOverride&&!e.override||(this.removeThemeClassName(),this.addThemeClassName(t),this.onSetTheme(this.theme,t),this.theme=t),this},addThemeClassName:function(t){t=t||this.theme;var e=this.themeClassNamePrefix+t;return this.svgElement?this.vel.addClass(e):this.$el.addClass(e),this},removeThemeClassName:function(t){t=t||this.theme;var e=this.themeClassNamePrefix+t;return this.svgElement?this.vel.removeClass(e):this.$el.removeClass(e),this},onSetTheme:function(t,e){},remove:function(){return this.onRemove(),this.undelegateDocumentEvents(),ut[this.cid]=null,n.View.prototype.remove.apply(this,arguments),this},onRemove:function(){},getEventNamespace:function(){return".joint-event-ns-"+this.cid},delegateElementEvents:function(t,e,i){if(!e)return this;i||(i={});var r=this.getEventNamespace();for(var n in e){var s=e[n];"function"!=typeof s&&(s=this[s]),s&&T(t).on(n+r,i,s.bind(this))}return this},undelegateElementEvents:function(t){return T(t).off(this.getEventNamespace()),this},delegateDocumentEvents:function(t,e){return t||(t=j(this,"documentEvents")),this.delegateElementEvents(document,t,e)},undelegateDocumentEvents:function(){return this.undelegateElementEvents(document)},eventData:function(t,e){if(!t)throw new Error("eventData(): event object required.");var i=t.data,r="__"+this.cid+"__";return void 0===e?i&&i[r]||{}:(i||(i=t.data={}),i[r]||(i[r]={}),k(i[r],e),this)},stopPropagation:function(t){return this.eventData(t,{propagationStopped:!0}),this},isPropagationStopped:function(t){return!!this.eventData(t).propagationStopped}},{extend:function(){var t=Array.from(arguments),e=t[0]&&k({},t[0])||{},i=t[1]&&k({},t[1])||{},r=e.render||this.prototype&&this.prototype.render||null;return e.render=function(){return"function"==typeof r&&r.apply(this,arguments),this.render.__render__===r&&this.onRender(),this},e.render.__render__=r,n.View.extend.call(this,e,i)}}),ft=ct.extend({tagName:"g",svgElement:!0,selector:"root",metrics:null,className:function(){var r=["cell"],t=this.model.get("type");return t&&t.toLowerCase().split(".").forEach(function(t,e,i){r.push("type-"+i.slice(0,e+1).join("-"))}),r.join(" ")},_presentationAttributes:null,_flags:null,setFlags:function(){var t,e,i,r={},n={},s=0,o=this.presentationAttributes;for(var a in o)if(o.hasOwnProperty(a)){var l=o[a];for(Array.isArray(l)||(l=[l]),t=0,e=l.length;t<e;t++){var h=r[i=l[t]];h||(h=r[i]=1<<s++),n[a]|=h}}var u=this.initFlag;for(Array.isArray(u)||(u=[u]),t=0,e=u.length;t<e;t++)r[i=u[t]]||(r[i]=1<<s++);if(25<s)throw new Error("dia.CellView: Maximum number of flags exceeded.");this._flags=r,this._presentationAttributes=n},hasFlag:function(t,e){return t&this.getFlag(e)},removeFlag:function(t,e){return t^t&this.getFlag(e)},getFlag:function(t){var e=this._flags;if(!e)return 0;var i=0;if(Array.isArray(t))for(var r=0,n=t.length;r<n;r++)i|=e[t[r]];else i|=e[t];return i},attributes:function(){var t=this.model;return{"model-id":t.id,"data-type":t.attributes.type}},constructor:function(t){t.id=t.id||l(this),ct.call(this,t)},initialize:function(){this.setFlags(),ct.prototype.initialize.apply(this,arguments),this.cleanNodesCache(),this.$el.data("view",this),this.startListening()},startListening:function(){this.listenTo(this.model,"change",this.onAttributesChange)},onAttributesChange:function(t,e){var i=t.getChangeFlag(this._presentationAttributes);if(!e.updateHandled&&i){e.dirty&&this.hasFlag(i,"UPDATE")&&(i|=this.getFlag("RENDER")),e.tool&&(e.async=!1);var r=this.paper;r&&r.requestViewUpdate(this,i,this.UPDATE_PRIORITY,e)}},parseDOMJSON:function(t,e){var i=a(t),r=i.selectors,n=i.groupSelectors;for(var s in n){if(r[s])throw new Error("dia.CellView: ambiguous group selector");r[s]=n[s]}if(e){var o=this.selector;if(r[o])throw new Error("dia.CellView: ambiguous root selector.");r[o]=e}return{fragment:i.fragment,selectors:r}},can:function(t){var e,i,r=_(this.options.interactive)?this.options.interactive(this):this.options.interactive;return $(r)&&!1!==r[t]||(e=r,i=Object.prototype.toString,(!0===e||!1===e||!!e&&"object"==typeof e&&"[object Boolean]"===i.call(e))&&!1!==r)},findBySelector:function(t,e,i){if(e||(e=this.el),i||(i=this.selectors),!t||"."===t)return[e];if(i){var r=i[t];if(r)return Array.isArray(r)?r:[r]}return T(e).find(t).toArray()},notify:function(t){if(this.paper){var e=Array.prototype.slice.call(arguments,1);this.trigger.apply(this,[t].concat(e)),this.paper.trigger.apply(this.paper,[t,this].concat(e))}},getBBox:function(t){var e;if(t&&t.useModelGeometry){var i=this.model;e=i.getBBox().bbox(i.angle())}else e=this.getNodeBBox(this.el);return this.paper.localToPaperRect(e)},getNodeBBox:function(t){var e=this.getNodeBoundingRect(t),i=this.getNodeMatrix(t),r=this.getRootTranslateMatrix(),n=this.getRootRotateMatrix();return L.transformRect(e,r.multiply(n).multiply(i))},getNodeUnrotatedBBox:function(t){var e=this.getNodeBoundingRect(t),i=this.getNodeMatrix(t),r=this.getRootTranslateMatrix();return L.transformRect(e,r.multiply(i))},getRootTranslateMatrix:function(){var t=this.model.position();return L.createSVGMatrix().translate(t.x,t.y)},getRootRotateMatrix:function(){var t=L.createSVGMatrix(),e=this.model,i=e.angle();if(i){var r=e.getBBox(),n=r.width/2,s=r.height/2;t=t.translate(n,s).rotate(i).translate(-n,-s)}return t},highlight:function(t,e){return t=t&&this.$(t)[0]||this.el,(e=e||{}).partial=t!==this.el,this.notify("cell:highlight",t,e),this},unhighlight:function(t,e){return t=t&&this.$(t)[0]||this.el,(e=e||{}).partial=t!=this.el,this.notify("cell:unhighlight",t,e),this},findMagnet:function(t){var e=this.$(t),i=this.$el;0===e.length&&(e=i);do{var r=e.attr("magnet");if((r||e.is(i))&&"false"!==r)return e[0];e=e.parent()}while(0<e.length)},getSelector:function(t,e){var i;if(t===this.el)return"string"==typeof e&&(i="> "+e),i;if(t){var r=L(t).index()+1;i=t.tagName+":nth-child("+r+")",e&&(i+=" > "+e),i=this.getSelector(t.parentNode,i)}return i},getLinkEnd:function(t,e,i,r,n){var s=this.model,o=s.id,a=this.findAttribute("port",t),l=t.getAttribute("joint-selector"),h={id:o};null!=l&&(h.magnet=l),null!=a?(h.port=a,s.hasPort(a)||l||(h.selector=this.getSelector(t))):null==l&&this.el!==t&&(h.selector=this.getSelector(t));var u=this.paper,c=u.options.connectionStrategy;if("function"==typeof c){var f=c.call(u,h,this,t,new S.Point(e,i),r,n,u);f&&(h=f)}return h},getMagnetFromLinkEnd:function(t){var e=this.el,i=t.port,r=t.magnet,n=this.model;return null!=i&&n.isElement()&&n.hasPort(i)?this.findPortNode(i,r)||e:(r||(r=t.selector),r||null==i||(r='[port="'+i+'"]'),this.findBySelector(r,e,this.selectors)[0])},getAttributeDefinition:function(t){return this.model.constructor.getAttributeDefinition(t)},setNodeAttributes:function(t,e){N(e)||(t instanceof SVGElement?L(t).attr(e):T(t).attr(e))},processNodeAttributes:function(t,e){var i,r,n,s,o,a,l,h,u,c,f=[];for(i in e)e.hasOwnProperty(i)&&(r=e[i],!(n=this.getAttributeDefinition(i))||_(n.qualify)&&!n.qualify.call(this,r,t,e)?(a||(a={}),a[(c=i,c.replace(/[A-Z]/g,"-$&").toLowerCase())]=r):(W(n.set)&&(a||(a={}),a[n.set]=r),null!==r&&f.push(i,n)));for(s=0,o=f.length;s<o;s+=2)i=f[s],n=f[s+1],r=e[i],_(n.set)&&(l||(l={}),l[i]=r),_(n.position)&&(h||(h={}),h[i]=r),_(n.offset)&&(u||(u={}),u[i]=r);return{raw:e,normal:a,set:l,position:h,offset:u}},updateRelativeAttributes:function(t,e,i,r){var n,s;r||(r={});var o=e.raw||{},a=e.normal||{},l=e.set,h=e.position,u=e.offset;for(n in l){s=l[n];var c=this.getAttributeDefinition(n).set.call(this,s,i.clone(),t,o);$(c)?k(a,c):void 0!==c&&(a[n]=c)}if(t instanceof HTMLElement)this.setNodeAttributes(t,a);else{var f,d,p,g=a.transform,m=L.transformStringToMatrix(g),v=S.Point(m.e,m.f);if(g&&(a=I(a,"transform"),m.e=m.f=0),h||u){var y=this.getNodeScale(t,r.scalableNode);f=y.sx,d=y.sy}var b=!1;for(n in h)s=h[n],(p=this.getAttributeDefinition(n).position.call(this,s,i.clone(),t,o))&&(v.offset(S.Point(p).scale(f,d)),b||(b=!0));this.setNodeAttributes(t,a);var x=!1;if(u){var w=this.getNodeBoundingRect(t);if(0<w.width&&0<w.height){var E=L.transformRect(w,m).scale(1/f,1/d);for(n in u)s=u[n],(p=this.getAttributeDefinition(n).offset.call(this,s,E,t,o))&&(v.offset(S.Point(p).scale(f,d)),x||(x=!0))}}(void 0!==g||b||x)&&(v.round(1),m.e=v.x,m.f=v.y,t.setAttribute("transform",L.matrixToTransformString(m)))}},getNodeScale:function(t,e){var i,r;if(e&&e.contains(t)){var n=e.scale();i=1/n.sx,r=1/n.sy}else r=i=1;return{sx:i,sy:r}},cleanNodesCache:function(){this.metrics={}},nodeCache:function(t){var e=this.metrics;if(!e)return{};var i=L.ensureId(t),r=e[i];return r||(r=e[i]={}),r},getNodeData:function(t){var e=this.nodeCache(t);return e.data||(e.data={}),e.data},getNodeBoundingRect:function(t){var e=this.nodeCache(t);return void 0===e.boundingRect&&(e.boundingRect=L(t).getBBox()),new S.Rect(e.boundingRect)},getNodeMatrix:function(t){var e=this.nodeCache(t);if(void 0===e.magnetMatrix){var i=this.rotatableNode||this.el;e.magnetMatrix=L(t).getTransformToElement(i)}return L.createSVGMatrix(e.magnetMatrix)},getNodeShape:function(t){var e=this.nodeCache(t);return void 0===e.geometryShape&&(e.geometryShape=L(t).toGeometryShape()),e.geometryShape.clone()},isNodeConnection:function(t){return this.model.isLink()&&(!t||t===this.el)},findNodesAttributes:function(t,e,i,r){var n,s,o,a,l={},h=[];for(var u in t)if(t.hasOwnProperty(u)){var c=i[u]=this.findBySelector(u,e,r);for(n=0,s=c.length;n<s;n++){var f=c[n];a=L.ensureId(f),o=t[u];var d=r&&r[u]===f,p=l[a];if(p){p.array||(h.push(a),p.array=!0,p.attributes=[p.attributes],p.selectedLength=[p.selectedLength]);var g=p.attributes,m=p.selectedLength;if(d)g.unshift(o),m.unshift(-1);else{var v=E(m,s);g.splice(v,0,o),m.splice(v,0,s)}}else l[a]={attributes:o,selectedLength:d?-1:s,node:f,array:!1}}}for(n=0,s=h.length;n<s;n++)(o=l[a=h[n]]).attributes=U.apply(void 0,[{}].concat(o.attributes.reverse()));return l},getEventTarget:function(t,e){void 0===e&&(e={});var i=t.target,r=t.type,n=t.clientX;void 0===n&&(n=0);var s=t.clientY;return void 0===s&&(s=0),e.fromPoint||"touchmove"===r||"touchend"===r?document.elementFromPoint(n,s):i},updateDOMSubtreeAttributes:function(t,e,i){i||(i={}),i.rootBBox||(i.rootBBox=S.Rect()),i.selectors||(i.selectors=this.selectors);var r,n,s,o,a,l,h={},u={},c=[],f=i.roAttributes,d=this.findNodesAttributes(f||e,t,h,i.selectors),p=f?this.findNodesAttributes(e,t,h,i.selectors):d;for(var g in d)if(s=(o=d[g]).attributes,n=o.node,(a=this.processNodeAttributes(n,s)).set||a.position||a.offset){var m,v=p[g]&&p[g].attributes,y=v&&void 0===s.ref?v.ref:s.ref;if(y){if(!(m=(h[y]||this.findBySelector(y,t,i.selectors))[0]))throw new Error('dia.ElementView: "'+y+'" reference does not exist.')}else m=null;r={node:n,refNode:m,processedAttributes:a,allAttributes:v};var b=c.findIndex(function(t){return t.refNode===n});-1<b?c.splice(b,0,r):c.push(r)}else this.setNodeAttributes(n,a.normal);for(var x=0,w=c.length;x<w;x++){r=c[x],n=r.node,m=r.refNode;var E=L(i.rotatableNode),k=m?L.ensureId(m):"",A=!!E&&!!m&&E.contains(m),P=u[k];if(!P){var C=A?E:t;P=u[k]=m?L(m).getBBox({target:C}):i.rootBBox}f?(a=this.processNodeAttributes(n,r.allAttributes),this.mergeProcessedAttributes(a,r.processedAttributes)):a=r.processedAttributes;var T=P;A&&!E.contains(n)&&(l||(l=L.transformStringToMatrix(E.attr("transform"))),T=L.transformRect(P,l)),this.updateRelativeAttributes(n,a,T,i)}},mergeProcessedAttributes:function(t,e){t.set||(t.set={}),t.position||(t.position={}),t.offset||(t.offset={}),k(t.set,e.set),k(t.position,e.position),k(t.offset,e.offset);var i=t.normal&&t.normal.transform;void 0!==i&&e.normal&&(e.normal.transform=i),t.normal=e.normal},onRemove:function(){this.removeTools()},_toolsView:null,hasTools:function(t){var e=this._toolsView;return!!e&&(!t||e.getName()===t)},addTools:function(t){return this.removeTools(),t&&((this._toolsView=t).configure({relatedView:this}),t.listenTo(this.paper,"tools:event",this.onToolEvent.bind(this)),t.mount()),this},updateTools:function(t){var e=this._toolsView;return e&&e.update(t),this},removeTools:function(){var t=this._toolsView;return t&&(t.remove(),this._toolsView=null),this},hideTools:function(){var t=this._toolsView;return t&&t.hide(),this},showTools:function(){var t=this._toolsView;return t&&t.show(),this},onToolEvent:function(t){switch(t){case"remove":this.removeTools();break;case"hide":this.hideTools();break;case"show":this.showTools()}},pointerdblclick:function(t,e,i){this.notify("cell:pointerdblclick",t,e,i)},pointerclick:function(t,e,i){this.notify("cell:pointerclick",t,e,i)},contextmenu:function(t,e,i){this.notify("cell:contextmenu",t,e,i)},pointerdown:function(t,e,i){this.model.graph&&(this.model.startBatch("pointer"),this._graph=this.model.graph),this.notify("cell:pointerdown",t,e,i)},pointermove:function(t,e,i){this.notify("cell:pointermove",t,e,i)},pointerup:function(t,e,i){this.notify("cell:pointerup",t,e,i),this._graph&&(this._graph.stopBatch("pointer",{cell:this.model}),delete this._graph)},mouseover:function(t){this.notify("cell:mouseover",t)},mouseout:function(t){this.notify("cell:mouseout",t)},mouseenter:function(t){this.notify("cell:mouseenter",t)},mouseleave:function(t){this.notify("cell:mouseleave",t)},mousewheel:function(t,e,i,r){this.notify("cell:mousewheel",t,e,i,r)},onevent:function(t,e,i,r){this.notify(e,t,i,r)},onmagnet:function(){},magnetpointerdblclick:function(){},magnetcontextmenu:function(){},checkMouseleave:function(t){var e=this.getEventTarget(t,{fromPoint:!0}),i=this.paper.findView(e);i!==this&&(this.mouseleave(t),i&&i.mouseenter(t))},setInteractivity:function(t){this.options.interactive=t}},{addPresentationAttributes:function(t){return U({},this.prototype.presentationAttributes,t,function(t,e){if(t&&e)return"string"==typeof t&&(t=[t]),"string"==typeof e&&(e=[e]),Array.isArray(t)&&Array.isArray(e)?A(t.concat(e)):void 0})}});function dt(t,e,i){var r=t.toJSON();return r.angle=e||0,b({},i,r)}function pt(t,e,i){return t.map(function(t,e,i){var r=this.pointAt((e+.5)/i.length);return(t.dx||t.dy)&&r.offset(t.dx||0,t.dy||0),dt(r.round(),0,t)},S.line(e,i))}function gt(t,e,o,a){var l=e.center(),h=e.width/e.height,u=e.topMiddle(),c=S.Ellipse.fromRect(e);return t.map(function(t,e,i){var r=o+a(e,i.length),n=u.clone().rotate(l,-r).scale(h,1,l),s=t.compensateRotation?-c.tangentTheta(n):0;return(t.dx||t.dy)&&n.offset(t.dx||0,t.dy||0),t.dr&&n.move(l,t.dr),dt(n.round(),s,t)})}function mt(t,e){var i=e.x;W(i)&&(i=parseFloat(i)/100*t.width);var r=e.y;return W(r)&&(r=parseFloat(r)/100*t.height),S.point(i||0,r||0)}var vt=Object.freeze({absolute:function(t,e,i){return t.map(mt.bind(null,e))},fn:function(t,e,i){return i.fn(t,e,i)},line:function(t,e,i){return pt(t,mt(e,i.start||e.origin()),mt(e,i.end||e.corner()))},left:function(t,e,i){return pt(t,e.origin(),e.bottomLeft())},right:function(t,e,i){return pt(t,e.topRight(),e.corner())},top:function(t,e,i){return pt(t,e.origin(),e.topRight())},bottom:function(t,e,i){return pt(t,e.bottomLeft(),e.corner())},ellipseSpread:function(t,e,i){var r=i.startAngle||0,n=i.step||360/t.length;return gt(t,e,r,function(t){return t*n})},ellipse:function(t,e,i){var r=i.startAngle||0,n=i.step||20;return gt(t,e,r,function(t,e){return(t+.5-e/2)*n})}});function yt(t,e){return x({},t,e,{x:0,y:0,angle:0,attrs:{".":{y:"0","text-anchor":"start"}}})}function bt(t,e,i,r){r=b({},r,{offset:15});var n,s,o,a,l=e.center().theta(t),h=xt(e),u=r.offset,c=0;a=l<h[1]||l>h[2]?(o=".3em",n=u,s=0,"start"):l<h[0]?(o="0",n=0,s=-u,i?(c=-90,"start"):"middle"):l<h[3]?(o=".3em",n=-u,s=0,"end"):(o=".6em",n=0,s=u,i?(c=90,"start"):"middle");var f=Math.round;return yt({x:f(n),y:f(s),angle:c,attrs:{".":{y:o,"text-anchor":a}}})}function xt(t){var e=t.center(),i=e.theta(t.origin()),r=e.theta(t.bottomLeft()),n=e.theta(t.corner());return[i,e.theta(t.topRight()),n,r]}function wt(t,e,i,r){var n,s,o,a,l=e.center().theta(t),h=(r=b({},r,{offset:15})).offset,u=0,c=xt(e);a=l<c[1]||l>c[2]?(o=".3em",n=-h,s=0,"end"):l<c[0]?(o=".6em",n=0,s=h,i?(u=90,"start"):"middle"):l<c[3]?(o=".3em",n=h,s=0,"start"):(o="0em",n=0,s=-h,i?(u=-90,"start"):"middle");var f=Math.round;return yt({x:f(n),y:f(s),angle:u,attrs:{".":{y:o,"text-anchor":a}}})}function Et(t,e,i){i=b({},i,{offset:20});var r,n=S.point(0,0),s=-t.theta(n),o=s,a=t.clone().move(n,i.offset).difference(t).round(),l=".3em";(s+90)%180==0?(r=e?"end":"middle",e||-270!==s||(l="0em")):-270<s&&s<-90?(r="start",o=s-180):r="end";var h=Math.round;return yt({x:h(a.x),y:h(a.y),angle:e?o:0,attrs:{".":{y:l,"text-anchor":r}}})}var kt=Object.freeze({manual:function(t,e,i){return yt(i,e)},left:function(t,e,i){return yt(i,{x:-15,attrs:{".":{y:".3em","text-anchor":"end"}}})},right:function(t,e,i){return yt(i,{x:15,attrs:{".":{y:".3em","text-anchor":"start"}}})},top:function(t,e,i){return yt(i,{y:-15,attrs:{".":{"text-anchor":"middle"}}})},bottom:function(t,e,i){return yt(i,{y:15,attrs:{".":{y:".6em","text-anchor":"middle"}}})},outsideOriented:function(t,e,i){return bt(t,e,!0,i)},outside:function(t,e,i){return bt(t,e,!1,i)},insideOriented:function(t,e,i){return wt(t,e,!0,i)},inside:function(t,e,i){return wt(t,e,!1,i)},radial:function(t,e,i){return Et(t.difference(e.center()),!1,i)},radialOriented:function(t,e,i){return Et(t.difference(e.center()),!0,i)}}),At=function(t){var e=C(t)||{};this.ports=[],this.groups={},this.portLayoutNamespace=vt,this.portLabelLayoutNamespace=kt,this._init(e)};At.prototype={getPorts:function(){return this.ports},getGroup:function(t){return this.groups[t]||{}},getPortsByGroup:function(e){return this.ports.filter(function(t){return t.group===e})},getGroupPortsMetrics:function(t,n){var e=this.getGroup(t),i=this.getPortsByGroup(t),r=e.position||{},s=r.name,o=this.portLayoutNamespace;o[s]||(s="left");var a=r.args||{},l=i.map(function(t){return t&&t.position&&t.position.args}),h=o[s](l,n,a),u={ports:i,result:[]};return M(h).reduce(function(t,e,i){var r=t.ports[i];return t.result.push({portId:r.id,portTransformation:e,labelTransformation:this._getPortLabelLayout(r,S.Point(e),n),portAttrs:r.attrs,portSize:r.size,labelSize:r.label.size}),t}.bind(this),u),u.result},_getPortLabelLayout:function(t,e,i){var r=this.portLabelLayoutNamespace,n=t.label.position.name||"left";return r[n]?r[n](e,i,t.label.position.args):null},_init:function(t){if($(t.groups))for(var e=Object.keys(t.groups),i=0,r=e.length;i<r;i++){var n=e[i];this.groups[n]=this._evaluateGroup(t.groups[n])}for(var s=M(t.items),o=0,a=s.length;o<a;o++)this.ports.push(this._evaluatePort(s[o]))},_evaluateGroup:function(t){return U(t,{position:this._getPosition(t.position,!0),label:this._getLabel(t,!0)})},_evaluatePort:function(t){var e=k({},t),i=this.getGroup(t.group);return e.markup=e.markup||i.markup,e.attrs=U({},i.attrs,e.attrs),e.position=this._createPositionNode(i,e),e.label=U({},i.label,this._getLabel(e)),e.z=this._getZIndex(i,e),e.size=k({},i.size,e.size),e},_getZIndex:function(t,e){return H(e.z)?e.z:H(t.z)||"auto"===t.z?t.z:"auto"},_createPositionNode:function(t,e){return U({name:"left",args:{}},t.position,{args:e.args})},_getPosition:function(t,e){var i,r={};_(t)?(i="fn",r.fn=t):W(t)?i=t:void 0===t?i=e?"left":null:Array.isArray(t)?(i="absolute",r.x=t[0],r.y=t[1]):$(t)&&(i=t.name,k(r,t.args));var n={args:r};return i&&(n.name=i),n},_getLabel:function(t,e){var i=t.label||{},r=i;return r.position=this._getPosition(i.position,e),r}};var Pt={_initializePorts:function(){this._createPortData(),this.on("change:ports",function(){this._processRemovedPort(),this._createPortData()},this)},_processRemovedPort:function(){var t=this.get("ports")||{},e={};M(t.items).forEach(function(t){e[t.id]=!0});var i=this.previous("ports")||{},r={};M(i.items).forEach(function(t){e[t.id]||(r[t.id]=!0)});var n=this.graph;n&&!N(r)&&(n.getConnectedLinks(this,{inbound:!0}).forEach(function(t){r[t.get("target").port]&&t.remove()}),n.getConnectedLinks(this,{outbound:!0}).forEach(function(t){r[t.get("source").port]&&t.remove()}))},hasPorts:function(){var t=this.prop("ports/items");return Array.isArray(t)&&0<t.length},hasPort:function(t){return-1!==this.getPortIndex(t)},getPorts:function(){return C(this.prop("ports/items"))||[]},getPort:function(e){return C(M(this.prop("ports/items")).find(function(t){return t.id&&t.id===e}))},getPortsPositions:function(t){return this._portSettingsData.getGroupPortsMetrics(t,S.Rect(this.size())).reduce(function(t,e){var i=e.portTransformation;return t[e.portId]={x:i.x,y:i.y,angle:i.angle},t},{})},getPortIndex:function(t){var e=$(t)?t.id:t;return this._isValidPortId(e)?M(this.prop("ports/items")).findIndex(function(t){return t.id===e}):-1},addPort:function(t,e){if(!$(t)||Array.isArray(t))throw new Error("Element: addPort requires an object.");var i=k([],this.prop("ports/items"));return i.push(t),this.prop("ports/items",i,e),this},portProp:function(t,e,i,r){var n=this.getPortIndex(t);if(-1===n)throw new Error("Element: unable to find port with id "+t);var s=Array.prototype.slice.call(arguments,1);return Array.isArray(e)?s[0]=["ports","items",n].concat(e):W(e)?s[0]=["ports/items/",n,"/",e].join(""):(s=["ports/items/"+n],R(e)&&(s.push(e),s.push(i))),this.prop.apply(this,s)},_validatePorts:function(){var t=this.get("ports")||{},e=[],i=M((t=t||{}).items);return i.forEach(function(t){"object"!=typeof t&&e.push("Element: invalid port ",t),this._isValidPortId(t.id)||(t.id=this.generatePortId())},this),A(i,"id").length!==i.length&&e.push("Element: found id duplicities in ports."),e},generatePortId:function(){return this.generateId()},_isValidPortId:function(t){return null!=t&&!$(t)},addPorts:function(t,e){return t.length&&this.prop("ports/items",k([],this.prop("ports/items")).concat(t),e),this},removePort:function(t,e){var i=e||{},r=k([],this.prop("ports/items")),n=this.getPortIndex(t);return-1!==n&&(r.splice(n,1),i.rewrite=!0,this.prop("ports/items",r,i)),this},removePorts:function(t,e){var i;if(Array.isArray(t)){if(i=e||{},t.length){i.rewrite=!0;var r=k([],this.prop("ports/items")).filter(function(i){return!t.some(function(t){var e=$(t)?t.id:t;return i.id===e})});this.prop("ports/items",r,i)}}else(i=t||{}).rewrite=!0,this.prop("ports/items",[],i);return this},_createPortData:function(){var t,e=this._validatePorts();if(0<e.length)throw this.set("ports",this.previous("ports")),new Error(e.join(" "));this._portSettingsData&&(t=this._portSettingsData.getPorts()),this._portSettingsData=new At(this.get("ports"));var i=this._portSettingsData.getPorts();if(t){var r=i.filter(function(e){if(!t.find(function(t){return t.id===e.id}))return e}),n=t.filter(function(e){if(!i.find(function(t){return t.id===e.id}))return e});0<n.length&&this.trigger("ports:remove",this,n),0<r.length&&this.trigger("ports:add",this,r)}}},Ct={portContainerMarkup:"g",portMarkup:[{tagName:"circle",selector:"circle",attributes:{r:10,fill:"#FFFFFF",stroke:"#000000"}}],portLabelMarkup:[{tagName:"text",selector:"text",attributes:{fill:"#000000"}}],_portElementsCache:null,_initializePorts:function(){this._portElementsCache={}},_refreshPorts:function(){this._removePorts(),this._portElementsCache={},this._renderPorts()},_renderPorts:function(){for(var i=[],r=this._getContainerElement(),t=0,e=r.node.childNodes.length;t<e;t++)i.push(r.node.childNodes[t]);var n=B(this.model._portSettingsData.getPorts(),"z");M(n.auto).forEach(function(t){var e=this._getPortElement(t);r.append(e),i.push(e)},this);for(var s=Object.keys(n),o=0;o<s.length;o++){var a=s[o];if("auto"!==a){var l=parseInt(a,10);this._appendPorts(n[a],l,i)}}this._updatePorts()},_getContainerElement:function(){return this.rotatableNode||this.vel},_appendPorts:function(t,e,i){var r=this._getContainerElement(),n=M(t).map(this._getPortElement,this);i[e]||e<0?L(i[Math.max(e,0)]).before(n):r.append(n)},_getPortElement:function(t){return this._portElementsCache[t.id]?this._portElementsCache[t.id].portElement:this._createPortElement(t)},findPortNode:function(t,e){var i=this._portElementsCache[t];if(!i)return null;var r=i.portContentElement.node,n=i.portContentSelectors;return this.findBySelector(e,r,n)[0]},_updatePorts:function(){this._updatePortGroup(void 0),Object.keys(this.model._portSettingsData.groups).forEach(this._updatePortGroup,this)},_removePorts:function(){w(this._portElementsCache,"portElement.remove")},_createPortElement:function(t){var e,i,r,n=L(this.portContainerMarkup).addClass("joint-port"),s=this._getPortMarkup(t);if(Array.isArray(s)){var o=this.parseDOMJSON(s,n.node),a=o.fragment;e=1<a.childNodes.length?L("g").append(a):L(a.firstChild),r=o.selectors}else e=L(s),Array.isArray(e)&&(e=L("g").append(e));if(!e)throw new Error("ElementView: Invalid port markup.");e.attr({port:t.id,"port-group":t.group});var l,h,u=this._getPortLabelMarkup(t.label);if(Array.isArray(u)){var c=this.parseDOMJSON(u,n.node),f=c.fragment;i=1<f.childNodes.length?L("g").append(f):L(f.firstChild),l=c.selectors}else i=L(u),Array.isArray(i)&&(i=L("g").append(i));if(!i)throw new Error("ElementView: Invalid port label markup.");if(r&&l){for(var d in l)if(r[d]&&d!==this.selector)throw new Error("ElementView: selectors within port must be unique.");h=k({},r,l)}else h=r||l;return n.append([e.addClass("joint-port-body"),i.addClass("joint-port-label")]),this._portElementsCache[t.id]={portElement:n,portLabelElement:i,portSelectors:h,portLabelSelectors:l,portContentElement:e,portContentSelectors:r},n},_updatePortGroup:function(t){for(var e=S.Rect(this.model.size()),i=this.model._portSettingsData.getGroupPortsMetrics(t,e),r=0,n=i.length;r<n;r++){var s=i[r],o=s.portId,a=this._portElementsCache[o]||{},l=s.portTransformation;this.applyPortTransform(a.portElement,l),this.updateDOMSubtreeAttributes(a.portElement.node,s.portAttrs,{rootBBox:new S.Rect(s.portSize),selectors:a.portSelectors});var h=s.labelTransformation;h&&(this.applyPortTransform(a.portLabelElement,h,-l.angle||0),this.updateDOMSubtreeAttributes(a.portLabelElement.node,h.attrs,{rootBBox:new S.Rect(s.labelSize),selectors:a.portLabelSelectors}))}},applyPortTransform:function(t,e,i){var r=L.createSVGMatrix().rotate(i||0).translate(e.x||0,e.y||0).rotate(e.angle||0);t.transform(r,{absolute:!0})},_getPortMarkup:function(t){return t.markup||this.model.get("portMarkup")||this.model.portMarkup||this.portMarkup},_getPortLabelMarkup:function(t){return t.markup||this.model.get("portLabelMarkup")||this.model.portLabelMarkup||this.portLabelMarkup}},Tt=ft.extend({_removePorts:function(){},_renderPorts:function(){},className:function(){var t=ft.prototype.className.apply(this).split(" ");return t.push("element"),t.join(" ")},initialize:function(){ft.prototype.initialize.apply(this,arguments),this._initializePorts()},presentationAttributes:{attrs:["UPDATE"],position:["TRANSLATE"],size:["RESIZE","PORTS"],angle:["ROTATE"],markup:["RENDER"],ports:["PORTS"]},initFlag:["RENDER"],UPDATE_PRIORITY:0,confirmUpdate:function(t,e){return this.hasFlag(t,"RENDER")?(this.render(),t=this.removeFlag(t,["RENDER","UPDATE","RESIZE","TRANSLATE","ROTATE","PORTS"])):(this.hasFlag(t,"RESIZE")&&(this.resize(e),t=this.removeFlag(t,["RESIZE","UPDATE"])),this.hasFlag(t,"UPDATE")&&(this.update(this.model,null,e),t=this.removeFlag(t,"UPDATE")),this.hasFlag(t,"TRANSLATE")&&(this.translate(),t=this.removeFlag(t,"TRANSLATE")),this.hasFlag(t,"ROTATE")&&(this.rotate(),t=this.removeFlag(t,"ROTATE")),this.hasFlag(t,"PORTS")&&(this._refreshPorts(),t=this.removeFlag(t,"PORTS")),t)},_initializePorts:function(){},update:function(t,e){this.cleanNodesCache();var i=this.model,r=i.attr();this.updateDOMSubtreeAttributes(this.el,r,{rootBBox:new S.Rect(i.size()),selectors:this.selectors,scalableNode:this.scalableNode,rotatableNode:this.rotatableNode,roAttributes:e===r?null:e})},rotatableSelector:"rotatable",scalableSelector:"scalable",scalableNode:null,rotatableNode:null,renderMarkup:function(){var t=this.model,e=t.get("markup")||t.markup;if(!e)throw new Error("dia.ElementView: markup required");if(Array.isArray(e))return this.renderJSONMarkup(e);if("string"==typeof e)return this.renderStringMarkup(e);throw new Error("dia.ElementView: invalid markup")},renderJSONMarkup:function(t){var e=this.parseDOMJSON(t,this.el),i=this.selectors=e.selectors;this.rotatableNode=L(i[this.rotatableSelector])||null,this.scalableNode=L(i[this.scalableSelector])||null,this.vel.append(e.fragment)},renderStringMarkup:function(t){var e=this.vel;e.append(L(t)),this.rotatableNode=e.findOne(".rotatable"),this.scalableNode=e.findOne(".scalable"),(this.selectors={})[this.selector]=this.el},render:function(){return this.vel.empty(),this.renderMarkup(),this.scalableNode&&this.update(),this.resize(),this.rotatableNode?(this.rotate(),this.translate()):this.updateTransformation(),this._refreshPorts(),this},resize:function(t){if(this.scalableNode)return this.sgResize(t);this.model.attributes.angle&&this.rotate(),this.update()},translate:function(){if(this.rotatableNode)return this.rgTranslate();this.updateTransformation()},rotate:function(){if(this.rotatableNode)return this.rgRotate(),void this.update();this.updateTransformation()},updateTransformation:function(){var t=this.getTranslateString(),e=this.getRotateString();e&&(t+=" "+e),this.vel.attr("transform",t)},getTranslateString:function(){var t=this.model.attributes.position;return"translate("+t.x+","+t.y+")"},getRotateString:function(){var t=this.model.attributes,e=t.angle;if(!e)return null;var i=t.size;return"rotate("+e+","+i.width/2+","+i.height/2+")"},rgRotate:function(){this.rotatableNode.attr("transform",this.getRotateString())},rgTranslate:function(){this.vel.attr("transform",this.getTranslateString())},sgResize:function(t){var e=this.model,i=e.angle(),r=e.size(),n=this.scalableNode,s=!1;0<n.node.getElementsByTagName("path").length&&(s=!0);var o=n.getBBox({recursive:s}),a=r.width/(o.width||1),l=r.height/(o.height||1);n.attr("transform","scale("+a+","+l+")");var h=this.rotatableNode,u=h&&h.attr("transform");if(u){h.attr("transform",u+" rotate("+-i+","+r.width/2+","+r.height/2+")");var c=n.getBBox({target:this.paper.cells});e.set("position",{x:c.x,y:c.y},k({updateHandled:!0},t)),this.translate(),this.rotate()}this.update()},prepareEmbedding:function(t){t||(t={});var e=t.model||this.model,i=(t.paper||this.paper).model;e.startBatch("to-front"),e.toFront({deep:!0,ui:!0});var r=i.getElements().reduce(function(t,e){return Math.max(t,e.attributes.z||0)},0);i.getConnectedLinks(e,{deep:!0,includeEnclosed:!0}).forEach(function(t){t.attributes.z<=r&&t.set("z",r+1,{ui:!0})}),e.stopBatch("to-front");var n=e.parent();n&&i.getCell(n).unembed(e,{ui:!0})},processEmbedding:function(t){t||(t={});var e=t.model||this.model,i=t.paper||this.paper,r=i.options,n=[];_(r.findParentBy)?n=M(r.findParentBy.call(i.model,this)).filter(function(t){return t instanceof ht&&this.model.id!==t.id&&!t.isEmbeddedIn(this.model)}.bind(this)):n=i.model.findModelsUnderElement(e,{searchBy:r.findParentBy});r.frontParentOnly&&(n=n.slice(-1));for(var s=null,o=t.candidateEmbedView,a=n.length-1;0<=a;a--){var l=n[a];if(o&&o.model.id==l.id){s=o;break}var h=l.findView(i);if(r.validateEmbedding.call(i,this,h)){s=h;break}}s&&s!=o&&(this.clearEmbedding(t),t.candidateEmbedView=s.highlight(null,{embedding:!0})),!s&&o&&this.clearEmbedding(t)},clearEmbedding:function(t){t||(t={});var e=t.candidateEmbedView;e&&(e.unhighlight(null,{embedding:!0}),t.candidateEmbedView=null)},finalizeEmbedding:function(t){t||(t={});var e=t.candidateEmbedView,i=t.model||this.model,r=t.paper||this.paper;e&&(e.model.embed(i,{ui:!0}),e.unhighlight(null,{embedding:!0}),t.candidateEmbedView=null),w(r.model.getConnectedLinks(i,{deep:!0}),"reparent",{ui:!0})},getDelegatedView:function(){for(var t=this,e=t.model,i=t.paper;t&&!e.isLink();){if(!e.isEmbedded()||t.can("stopDelegation"))return t;e=e.getParentCell(),t=i.findViewByModel(e)}return null},notifyPointerdown:function(t,e,i){ft.prototype.pointerdown.call(this,t,e,i),this.notify("element:pointerdown",t,e,i)},notifyPointermove:function(t,e,i){ft.prototype.pointermove.call(this,t,e,i),this.notify("element:pointermove",t,e,i)},notifyPointerup:function(t,e,i){this.notify("element:pointerup",t,e,i),ft.prototype.pointerup.call(this,t,e,i)},pointerdblclick:function(t,e,i){ft.prototype.pointerdblclick.apply(this,arguments),this.notify("element:pointerdblclick",t,e,i)},pointerclick:function(t,e,i){ft.prototype.pointerclick.apply(this,arguments),this.notify("element:pointerclick",t,e,i)},contextmenu:function(t,e,i){ft.prototype.contextmenu.apply(this,arguments),this.notify("element:contextmenu",t,e,i)},pointerdown:function(t,e,i){this.isPropagationStopped(t)||(this.notifyPointerdown(t,e,i),this.dragStart(t,e,i))},pointermove:function(t,e,i){var r=this.eventData(t);switch(r.action){case"magnet":this.dragMagnet(t,e,i);break;case"move":(r.delegatedView||this).drag(t,e,i);default:this.notifyPointermove(t,e,i)}this.eventData(t,r)},pointerup:function(t,e,i){var r=this.eventData(t);switch(r.action){case"magnet":this.dragMagnetEnd(t,e,i);break;case"move":(r.delegatedView||this).dragEnd(t,e,i);default:this.notifyPointerup(t,e,i)}var n=r.targetMagnet;n&&this.magnetpointerclick(t,n,e,i),this.checkMouseleave(t)},mouseover:function(t){ft.prototype.mouseover.apply(this,arguments),this.notify("element:mouseover",t)},mouseout:function(t){ft.prototype.mouseout.apply(this,arguments),this.notify("element:mouseout",t)},mouseenter:function(t){ft.prototype.mouseenter.apply(this,arguments),this.notify("element:mouseenter",t)},mouseleave:function(t){ft.prototype.mouseleave.apply(this,arguments),this.notify("element:mouseleave",t)},mousewheel:function(t,e,i,r){ft.prototype.mousewheel.apply(this,arguments),this.notify("element:mousewheel",t,e,i,r)},onmagnet:function(t,e,i){this.dragMagnetStart(t,e,i)},magnetpointerdblclick:function(t,e,i,r){this.notify("element:magnet:pointerdblclick",t,e,i,r)},magnetcontextmenu:function(t,e,i,r){this.notify("element:magnet:contextmenu",t,e,i,r)},dragStart:function(t,e,i){var r=this.getDelegatedView();r&&r.can("elementMove")&&(this.eventData(t,{action:"move",delegatedView:r}),r.eventData(t,{pointerOffset:r.model.position().difference(e,i),restrictedArea:this.paper.getRestrictedArea(r)}))},dragMagnetStart:function(t,e,i){if(this.can("addLinkFromMagnet")){var r=t.currentTarget,n=this.paper;this.eventData(t,{targetMagnet:r}),t.stopPropagation(),n.options.validateMagnet(this,r)?(n.options.magnetThreshold<=0&&this.dragLinkStart(t,r,e,i),this.eventData(t,{action:"magnet"}),this.stopPropagation(t)):this.pointerdown(t,e,i),n.delegateDragEvents(this,t.data)}},dragLinkStart:function(t,e,i,r){this.model.startBatch("add-link");var n=this.addLinkFromMagnet(e,i,r);n.notifyPointerdown(t,i,r),n.eventData(t,n.startArrowheadMove("target",{whenNotAllowed:"remove"})),this.eventData(t,{linkView:n})},addLinkFromMagnet:function(t,e,i){var r=this.paper,n=r.model,s=r.getDefaultLink(this,t);return s.set({source:this.getLinkEnd(t,e,i,s,"source"),target:{x:e,y:i}}).addTo(n,{async:!1,ui:!0}),s.findView(r)},drag:function(t,e,i){var r=this.paper,n=r.options.gridSize,s=this.model,o=this.eventData(t),a=o.pointerOffset,l=o.restrictedArea,h=o.embedding,u=S.snapToGrid(e+a.x,n),c=S.snapToGrid(i+a.y,n);s.position(u,c,{restrictedArea:l,deep:!0,ui:!0}),r.options.embeddingMode&&(h||(this.prepareEmbedding(o),h=!0),this.processEmbedding(o)),this.eventData(t,{embedding:h})},dragMagnet:function(t,e,i){var r=this.eventData(t),n=r.linkView;if(n)n.pointermove(t,e,i);else{var s=this.paper,o=s.options.magnetThreshold,a=this.getEventTarget(t),l=r.targetMagnet;if("onleave"===o){if(l===a||L(l).contains(a))return}else if(s.eventData(t).mousemoved<=o)return;this.dragLinkStart(t,l,e,i)}},dragEnd:function(t,e,i){var r=this.eventData(t);r.embedding&&this.finalizeEmbedding(r)},dragMagnetEnd:function(t,e,i){var r=this.eventData(t).linkView;r&&(r.pointerup(t,e,i),this.model.stopBatch("add-link"))},magnetpointerclick:function(t,e,i,r){var n=this.paper;n.eventData(t).mousemoved>n.options.clickThreshold||this.notify("element:magnet:pointerclick",t,e,i,r)}});k(Tt.prototype,Ct);var St=ht.extend({markup:['<path class="connection" stroke="black" d="M 0 0 0 0"/>','<path class="marker-source" fill="black" stroke="black" d="M 0 0 0 0"/>','<path class="marker-target" fill="black" stroke="black" d="M 0 0 0 0"/>','<path class="connection-wrap" d="M 0 0 0 0"/>','<g class="labels"/>','<g class="marker-vertices"/>','<g class="marker-arrowheads"/>','<g class="link-tools"/>'].join(""),toolMarkup:['<g class="link-tool">','<g class="tool-remove" event="remove">','<circle r="11" />','<path transform="scale(.8) translate(-16, -16)" d="M24.778,21.419 19.276,15.917 24.777,10.415 21.949,7.585 16.447,13.087 10.945,7.585 8.117,10.415 13.618,15.917 8.116,21.419 10.946,24.248 16.447,18.746 21.948,24.248z" />',"<title>Remove link.</title>","</g>",'<g class="tool-options" event="link:options">','<circle r="11" transform="translate(25)"/>','<path fill="white" transform="scale(.55) translate(29, -16)" d="M31.229,17.736c0.064-0.571,0.104-1.148,0.104-1.736s-0.04-1.166-0.104-1.737l-4.377-1.557c-0.218-0.716-0.504-1.401-0.851-2.05l1.993-4.192c-0.725-0.91-1.549-1.734-2.458-2.459l-4.193,1.994c-0.647-0.347-1.334-0.632-2.049-0.849l-1.558-4.378C17.165,0.708,16.588,0.667,16,0.667s-1.166,0.041-1.737,0.105L12.707,5.15c-0.716,0.217-1.401,0.502-2.05,0.849L6.464,4.005C5.554,4.73,4.73,5.554,4.005,6.464l1.994,4.192c-0.347,0.648-0.632,1.334-0.849,2.05l-4.378,1.557C0.708,14.834,0.667,15.412,0.667,16s0.041,1.165,0.105,1.736l4.378,1.558c0.217,0.715,0.502,1.401,0.849,2.049l-1.994,4.193c0.725,0.909,1.549,1.733,2.459,2.458l4.192-1.993c0.648,0.347,1.334,0.633,2.05,0.851l1.557,4.377c0.571,0.064,1.148,0.104,1.737,0.104c0.588,0,1.165-0.04,1.736-0.104l1.558-4.377c0.715-0.218,1.399-0.504,2.049-0.851l4.193,1.993c0.909-0.725,1.733-1.549,2.458-2.458l-1.993-4.193c0.347-0.647,0.633-1.334,0.851-2.049L31.229,17.736zM16,20.871c-2.69,0-4.872-2.182-4.872-4.871c0-2.69,2.182-4.872,4.872-4.872c2.689,0,4.871,2.182,4.871,4.872C20.871,18.689,18.689,20.871,16,20.871z"/>',"<title>Link options.</title>","</g>","</g>"].join(""),doubleToolMarkup:void 0,vertexMarkup:['<g class="marker-vertex-group" transform="translate(<%= x %>, <%= y %>)">','<circle class="marker-vertex" idx="<%= idx %>" r="10" />','<path class="marker-vertex-remove-area" idx="<%= idx %>" d="M16,5.333c-7.732,0-14,4.701-14,10.5c0,1.982,0.741,3.833,2.016,5.414L2,25.667l5.613-1.441c2.339,1.317,5.237,2.107,8.387,2.107c7.732,0,14-4.701,14-10.5C30,10.034,23.732,5.333,16,5.333z" transform="translate(5, -33)"/>','<path class="marker-vertex-remove" idx="<%= idx %>" transform="scale(.8) translate(9.5, -37)" d="M24.778,21.419 19.276,15.917 24.777,10.415 21.949,7.585 16.447,13.087 10.945,7.585 8.117,10.415 13.618,15.917 8.116,21.419 10.946,24.248 16.447,18.746 21.948,24.248z">',"<title>Remove vertex.</title>","</path>","</g>"].join(""),arrowheadMarkup:['<g class="marker-arrowhead-group marker-arrowhead-group-<%= end %>">','<path class="marker-arrowhead" end="<%= end %>" d="M 26 0 L 0 13 L 26 26 z" />',"</g>"].join(""),defaultLabel:void 0,labelMarkup:void 0,_builtins:{defaultLabel:{markup:[{tagName:"rect",selector:"rect"},{tagName:"text",selector:"text"}],attrs:{text:{fill:"#000000",fontSize:14,textAnchor:"middle",yAlignment:"middle",pointerEvents:"none"},rect:{ref:"text",fill:"#ffffff",rx:3,ry:3,refWidth:1,refHeight:1,refX:0,refY:0}},position:{distance:.5}}},defaults:{type:"link",source:{},target:{}},isLink:function(){return!0},disconnect:function(t){return this.set({source:{x:0,y:0},target:{x:0,y:0}},t)},source:function(t,e,i){return void 0===t?P(this.get("source")):(n=t instanceof ht?((r=P(e)||{}).id=t.id,i):R(t)?(r=t,e):((r=P(e)||{}).x=t.x,r.y=t.y,i),this.set("source",r,n));var r,n},target:function(t,e,i){return void 0===t?P(this.get("target")):(n=t instanceof ht?((r=P(e)||{}).id=t.id,i):R(t)?(r=t,e):((r=P(e)||{}).x=t.x,r.y=t.y,i),this.set("target",r,n));var r,n},router:function(t,e,i){if(void 0===t){var r=this.get("router");return r?"object"==typeof r?P(r):r:this.get("manhattan")?{name:"orthogonal"}:null}var n="object"==typeof t||"function"==typeof t,s=n?t:{name:t,args:e},o=n?e:i;return this.set("router",s,o)},connector:function(t,e,i){if(void 0===t){var r=this.get("connector");return r?"object"==typeof r?P(r):r:this.get("smooth")?{name:"smooth"}:null}var n="object"==typeof t||"function"==typeof t,s=n?t:{name:t,args:e},o=n?e:i;return this.set("connector",s,o)},label:function(t,e,i){var r=this.labels();return(t=isFinite(t)&&null!==t?0|t:0)<0&&(t=r.length+t),arguments.length<=1?this.prop(["labels",t]):this.prop(["labels",t],e,i)},labels:function(t,e){return 0===arguments.length?(t=this.get("labels"),Array.isArray(t)?t.slice():[]):(Array.isArray(t)||(t=[]),this.set("labels",t,e))},insertLabel:function(t,e,i){if(!e)throw new Error("dia.Link: no label provided");var r=this.labels(),n=r.length;return(t=isFinite(t)&&null!==t?0|t:n)<0&&(t=n+t+1),r.splice(t,0,e),this.labels(r,i)},appendLabel:function(t,e){return this.insertLabel(-1,t,e)},removeLabel:function(t,e){var i=this.labels();return t=isFinite(t)&&null!==t?0|t:-1,i.splice(t,1),this.labels(i,e)},vertex:function(t,e,i){var r=this.vertices();if((t=isFinite(t)&&null!==t?0|t:0)<0&&(t=r.length+t),arguments.length<=1)return this.prop(["vertices",t]);var n=this._normalizeVertex(e);return this.prop(["vertices",t],n,i)},vertices:function(t,e){if(0===arguments.length)return t=this.get("vertices"),Array.isArray(t)?t.slice():[];Array.isArray(t)||(t=[]);for(var i=[],r=0;r<t.length;r++){var n=t[r],s=this._normalizeVertex(n);i.push(s)}return this.set("vertices",i,e)},insertVertex:function(t,e,i){if(!e)throw new Error("dia.Link: no vertex provided");var r=this.vertices(),n=r.length;(t=isFinite(t)&&null!==t?0|t:n)<0&&(t=n+t+1);var s=this._normalizeVertex(e);return r.splice(t,0,s),this.vertices(r,i)},removeVertex:function(t,e){var i=this.vertices();return t=isFinite(t)&&null!==t?0|t:-1,i.splice(t,1),this.vertices(i,e)},_normalizeVertex:function(t){return!R(t)?{x:t.x,y:t.y}:t},translate:function(e,i,t){return(t=t||{}).translateBy=t.translateBy||this.id,t.tx=e,t.ty=i,this.applyToPoints(function(t){return{x:(t.x||0)+e,y:(t.y||0)+i}},t)},scale:function(e,i,r,t){return this.applyToPoints(function(t){return S.Point(t).scale(e,i,r).toJSON()},t)},applyToPoints:function(t,e){if(!_(t))throw new TypeError("dia.Link: applyToPoints expects its first parameter to be a function.");var i={},r=this.source();r.id||(i.source=t(r));var n=this.target();n.id||(i.target=t(n));var s=this.vertices();return 0<s.length&&(i.vertices=s.map(t)),this.set(i,e)},getSourcePoint:function(){var t=this.getSourceCell();return t?t.getPointFromConnectedLink(this,"source"):new S.Point(this.source())},getTargetPoint:function(){var t=this.getTargetCell();return t?t.getPointFromConnectedLink(this,"target"):new S.Point(this.target())},getPointFromConnectedLink:function(){return this.getPolyline().pointAt(.5)},getPolyline:function(){var t=[this.getSourcePoint(),this.getTargetPoint()],e=this.vertices();return 0<e.length&&Array.prototype.push.apply(t,e.map(S.Point)),new S.Polyline(t)},getBBox:function(){return this.getPolyline().bbox()},reparent:function(t){var e;if(this.graph){var i=this.getSourceElement(),r=this.getTargetElement(),n=this.getParentCell();i&&r&&(e=i===r||i.isEmbeddedIn(r)?r:r.isEmbeddedIn(i)?i:this.graph.getCommonAncestor(i,r)),!n||e&&e.id===n.id||n.unembed(this,t),e&&e.embed(this,t)}return e},hasLoop:function(t){t=t||{};var e=this.source().id,i=this.target().id;if(!e||!i)return!1;var r=e===i;if(!r&&t.deep&&this.graph){var n=this.getSourceCell(),s=this.getTargetCell();r=n.isEmbeddedIn(s)||s.isEmbeddedIn(n)}return r},getSourceCell:function(){var t=this.source(),e=this.graph;return t&&t.id&&e&&e.getCell(t.id)||null},getSourceElement:function(){var t=this,e={};do{if(e[t.id])return null;e[t.id]=!0,t=t.getSourceCell()}while(t&&t.isLink());return t},getTargetCell:function(){var t=this.target(),e=this.graph;return t&&t.id&&e&&e.getCell(t.id)||null},getTargetElement:function(){var t=this,e={};do{if(e[t.id])return null;e[t.id]=!0,t=t.getTargetCell()}while(t&&t.isLink());return t},getRelationshipAncestor:function(){var t;if(this.graph){var e=[this,this.getSourceElement(),this.getTargetElement()].filter(function(t){return!!t});t=this.graph.getCommonAncestor.apply(this.graph,e)}return t||null},isRelationshipEmbeddedIn:function(t){var e=W(t)||H(t)?t:t.id,i=this.getRelationshipAncestor();return!!i&&(i.id===e||i.isEmbeddedIn(e))},_getDefaultLabel:function(){var t=this.get("defaultLabel")||this.defaultLabel||{},e={};return e.markup=t.markup||this.get("labelMarkup")||this.labelMarkup,e.position=t.position,e.attrs=t.attrs,e.size=t.size,e}},{endsEqual:function(t,e){var i=t.port===e.port||!t.port&&!e.port;return t.id===e.id&&i}}),Nt=ht.extend({defaults:{position:{x:0,y:0},size:{width:1,height:1},angle:0},initialize:function(){this._initializePorts(),ht.prototype.initialize.apply(this,arguments)},_initializePorts:function(){},_refreshPorts:function(){},isElement:function(){return!0},position:function(t,e,i){var r=H(e);if((i=(r?i:t)||{}).parentRelative){if(!this.graph)throw new Error("Element must be part of a graph.");var n=this.getParentCell(),s=n&&!n.isLink()?n.get("position"):{x:0,y:0}}if(r){if(i.parentRelative&&(t+=s.x,e+=s.y),i.deep){var o=this.get("position");this.translate(t-o.x,e-o.y,i)}else this.set("position",{x:t,y:e},i);return this}var a=S.Point(this.get("position"));return i.parentRelative?a.difference(s):a},translate:function(t,e,i){if(e=e||0,0===(t=t||0)&&0===e)return this;(i=i||{}).translateBy=i.translateBy||this.id;var r=this.get("position")||{x:0,y:0};if(i.restrictedArea&&i.translateBy===this.id){var n=this.getBBox({deep:!0}),s=i.restrictedArea,o=r.x-n.x,a=r.y-n.y,l=Math.max(s.x+o,Math.min(s.x+s.width+o-n.width,r.x+t)),h=Math.max(s.y+a,Math.min(s.y+s.height+a-n.height,r.y+e));t=l-r.x,e=h-r.y}var u={x:r.x+t,y:r.y+e};return i.tx=t,i.ty=e,i.transition?($(i.transition)||(i.transition={}),this.transition("position",u,k({},i.transition,{valueFunction:p.object})),w(this.getEmbeddedCells(),"translate",t,e,i)):(this.startBatch("translate",i),this.set("position",u,i),w(this.getEmbeddedCells(),"translate",t,e,i),this.stopBatch("translate",i)),this},size:function(t,e,i){var r=this.get("size");return void 0===t?{width:r.width,height:r.height}:($(t)&&(i=e,e=H(t.height)?t.height:r.height,t=H(t.width)?t.width:r.width),this.resize(t,e,i))},resize:function(t,e,i){if(i=i||{},this.startBatch("resize",i),i.direction){var r=this.get("size");switch(i.direction){case"left":case"right":e=r.height;break;case"top":case"bottom":t=r.width}var n=S.normalizeAngle(this.get("angle")||0),s={"top-right":0,right:0,"top-left":1,top:1,"bottom-left":2,left:2,"bottom-right":3,bottom:3}[i.direction];i.absolute&&(s+=Math.floor((n+45)/90),s%=4);var o=this.getBBox(),a=o[["bottomLeft","corner","topRight","origin"][s]](),l=S.Point(a).rotate(o.center(),-n),h=Math.sqrt(t*t+e*e)/2,u=s*Math.PI/2;u+=Math.atan(s%2==0?e/t:t/e),u-=S.toRad(n);var c=S.Point.fromPolar(h,u,l),f=S.Point(c).offset(t/-2,e/-2);this.set("size",{width:t,height:e},i),this.position(f.x,f.y,i)}else this.set("size",{width:t,height:e},i);return this.stopBatch("resize",i),this},scale:function(t,e,i,r){var n=this.getBBox().scale(t,e,i);return this.startBatch("scale",r),this.position(n.x,n.y,r),this.resize(n.width,n.height,r),this.stopBatch("scale"),this},fitEmbeds:function(t){if(t=t||{},!this.graph)throw new Error("Element must be part of a graph.");var e=this.getEmbeddedCells();if(0<e.length){this.startBatch("fit-embeds",t),t.deep&&w(e,"fitEmbeds",t);var i=this.graph.getCellsBBox(e),r=function(t){if(Object(t)===t)return e=i=r=n=0,isFinite(t.vertical)&&(e=r=+t.vertical),isFinite(t.horizontal)&&(i=n=+t.horizontal),isFinite(t.top)&&(e=+t.top),isFinite(t.right)&&(i=+t.right),isFinite(t.bottom)&&(r=+t.bottom),isFinite(t.left)&&(n=+t.left),{top:e,right:i,bottom:r,left:n};var e,i,r,n,s=0;return isFinite(t)&&(s=+t),{top:s,right:s,bottom:s,left:s}}(t.padding);i.moveAndExpand({x:-r.left,y:-r.top,width:r.right+r.left,height:r.bottom+r.top}),this.set({position:{x:i.x,y:i.y},size:{width:i.width,height:i.height}},t),this.stopBatch("fit-embeds")}return this},rotate:function(t,e,i,r){if(i){var n=this.getBBox().center(),s=this.get("size"),o=this.get("position");n.rotate(i,this.get("angle")-t);var a=n.x-s.width/2-o.x,l=n.y-s.height/2-o.y;this.startBatch("rotate",{angle:t,absolute:e,origin:i}),this.position(o.x+a,o.y+l,r),this.rotate(t,e,null,r),this.stopBatch("rotate")}else this.set("angle",e?t:(this.get("angle")+t)%360,r);return this},angle:function(){return S.normalizeAngle(this.get("angle")||0)},getBBox:function(t){if((t=t||{}).deep&&this.graph){var e=this.getEmbeddedCells({deep:!0,breadthFirst:!0});return e.push(this),this.graph.getCellsBBox(e)}var i=this.get("position"),r=this.get("size");return new S.Rect(i.x,i.y,r.width,r.height)},getPointFromConnectedLink:function(t,e){var i=this.getBBox(),r=i.center(),n=t.get(e);if(!n)return r;var s=n.port;if(!s)return r;var o=this.portProp(s,["group"]),a=this.getPortsPositions(o),l=new S.Point(a[s]).offset(i.origin()),h=this.angle();return h&&l.rotate(r,-h),l}});k(Nt.prototype,Pt);var zt={_results:{},_tests:{svgforeignobject:function(){return!!document.createElementNS&&/SVGForeignObject/.test({}.toString.call(document.createElementNS("http://www.w3.org/2000/svg","foreignObject")))}},addTest:function(t,e){return this._tests[t]=e},test:function(t){var e=this._tests[t];if(!e)throw new Error('Test not defined ("'+t+'"). Use `joint.env.addTest(name, fn) to add a new test.`');var i=this._results[t];if(void 0!==i)return i;try{i=e()}catch(t){i=!1}return this._results[t]=i}},_t=Nt.define("basic.Generic",{attrs:{".":{fill:"#ffffff",stroke:"none"}}}),Rt=(_t.define("basic.Rect",{attrs:{rect:{fill:"#ffffff",stroke:"#000000",width:100,height:60},text:{fill:"#000000",text:"","font-size":14,"ref-x":.5,"ref-y":.5,"text-anchor":"middle","y-alignment":"middle","font-family":"Arial, helvetica, sans-serif"}}},{markup:'<g class="rotatable"><g class="scalable"><rect/></g><text/></g>'}),Tt.extend({presentationAttributes:Tt.addPresentationAttributes({attrs:["SCALE"]}),confirmUpdate:function(){var t=Tt.prototype.confirmUpdate.apply(this,arguments);return this.hasFlag(t,"SCALE")&&(this.resize(),this.removeFlag(t,"SCALE")),t}}),_t.define("basic.Text",{attrs:{text:{"font-size":18,fill:"#000000"}}},{markup:'<g class="rotatable"><g class="scalable"><text/></g></g>'}),_t.define("basic.Circle",{size:{width:60,height:60},attrs:{circle:{fill:"#ffffff",stroke:"#000000",r:30,cx:30,cy:30},text:{"font-size":14,text:"","text-anchor":"middle","ref-x":.5,"ref-y":.5,"y-alignment":"middle",fill:"#000000","font-family":"Arial, helvetica, sans-serif"}}},{markup:'<g class="rotatable"><g class="scalable"><circle/></g><text/></g>'})),Mt=(_t.define("basic.Ellipse",{size:{width:60,height:40},attrs:{ellipse:{fill:"#ffffff",stroke:"#000000",rx:30,ry:20,cx:30,cy:20},text:{"font-size":14,text:"","text-anchor":"middle","ref-x":.5,"ref-y":.5,"y-alignment":"middle",fill:"#000000","font-family":"Arial, helvetica, sans-serif"}}},{markup:'<g class="rotatable"><g class="scalable"><ellipse/></g><text/></g>'}),_t.define("basic.Polygon",{size:{width:60,height:40},attrs:{polygon:{fill:"#ffffff",stroke:"#000000"},text:{"font-size":14,text:"","text-anchor":"middle","ref-x":.5,"ref-dy":20,"y-alignment":"middle",fill:"#000000","font-family":"Arial, helvetica, sans-serif"}}},{markup:'<g class="rotatable"><g class="scalable"><polygon/></g><text/></g>'}),_t.define("basic.Polyline",{size:{width:60,height:40},attrs:{polyline:{fill:"#ffffff",stroke:"#000000"},text:{"font-size":14,text:"","text-anchor":"middle","ref-x":.5,"ref-dy":20,"y-alignment":"middle",fill:"#000000","font-family":"Arial, helvetica, sans-serif"}}},{markup:'<g class="rotatable"><g class="scalable"><polyline/></g><text/></g>'}),_t.define("basic.Image",{attrs:{text:{"font-size":14,text:"","text-anchor":"middle","ref-x":.5,"ref-dy":20,"y-alignment":"middle",fill:"#000000","font-family":"Arial, helvetica, sans-serif"}}},{markup:'<g class="rotatable"><g class="scalable"><image/></g><text/></g>'}),_t.define("basic.Path",{size:{width:60,height:60},attrs:{path:{fill:"#ffffff",stroke:"#000000"},text:{"font-size":14,text:"","text-anchor":"middle",ref:"path","ref-x":.5,"ref-dy":10,fill:"#000000","font-family":"Arial, helvetica, sans-serif"}}},{markup:'<g class="rotatable"><g class="scalable"><path/></g><text/></g>'}).define("basic.Rhombus",{attrs:{path:{d:"M 30 0 L 60 30 30 60 0 30 z"},text:{"ref-y":.5,"ref-dy":null,"y-alignment":"middle"}}}),zt.test("svgforeignobject")),Bt=(_t.define("basic.TextBlock",{attrs:{rect:{fill:"#ffffff",stroke:"#000000",width:80,height:100},text:{fill:"#000000","font-size":14,"font-family":"Arial, helvetica, sans-serif"},".content":{text:"","ref-x":.5,"ref-y":.5,"y-alignment":"middle","x-alignment":"middle"}},content:""},{markup:['<g class="rotatable">','<g class="scalable"><rect/></g>',Mt?'<foreignObject class="fobj"><body xmlns="http://www.w3.org/1999/xhtml"><div class="content"/></body></foreignObject>':'<text class="content"/>',"</g>"].join(""),initialize:function(){this.listenTo(this,"change:size",this.updateSize),this.listenTo(this,"change:content",this.updateContent),this.updateSize(this,this.get("size")),this.updateContent(this,this.get("content")),_t.prototype.initialize.apply(this,arguments)},updateSize:function(t,e){this.attr({".fobj":k({},e),div:{style:k({},e)}})},updateContent:function(t,e){var i,r;Mt?this.attr({".content":{html:(i=e,r=T(T.parseHTML("<div>"+i+"</div>",null,!1)),r.find("*").each(function(){var i=this;T.each(i.attributes,function(){var t=this.name,e=this.value;0!==t.indexOf("on")&&0!==e.indexOf("javascript:")||T(i).removeAttr(t)})}),r.html())}}):this.attr({".content":{text:e}})},setForeignObjectSize:function(){this.updateSize.apply(this,arguments)},setDivContent:function(){this.updateContent.apply(this,arguments)}}),Tt.extend({presentationAttributes:Mt?Tt.prototype.presentationAttributes:Tt.addPresentationAttributes({content:["CONTENT"],size:["CONTENT"]}),initFlag:["RENDER","CONTENT"],confirmUpdate:function(){var t=Tt.prototype.confirmUpdate.apply(this,arguments);return this.hasFlag(t,"CONTENT")&&(this.updateContent(this.model),t=this.removeFlag(t,"CONTENT")),t},update:function(t,e){var i=this.model;if(Mt)Tt.prototype.update.call(this,i,e);else{var r=I(e||i.get("attrs"),".content");Tt.prototype.update.call(this,i,r),e&&!D(e,".content")||this.updateContent(i,e)}},updateContent:function(t,e){var i=U({},(e||t.get("attrs"))[".content"]);i=I(i,"text");var r=f(t.get("content"),t.get("size"),i,{svgDocument:this.paper.svg}),n=v({},".content",i,"/");n[".content"].text=r,Tt.prototype.update.call(this,t,n)}}),_t.define("uml.Class",{attrs:{rect:{width:200},".uml-class-name-rect":{stroke:"black","stroke-width":2,fill:"#3498db"},".uml-class-attrs-rect":{stroke:"black","stroke-width":2,fill:"#2980b9"},".uml-class-methods-rect":{stroke:"black","stroke-width":2,fill:"#2980b9"},".uml-class-name-text":{ref:".uml-class-name-rect","ref-y":.5,"ref-x":.5,"text-anchor":"middle","y-alignment":"middle","font-weight":"bold",fill:"black","font-size":12,"font-family":"Times New Roman"},".uml-class-attrs-text":{ref:".uml-class-attrs-rect","ref-y":5,"ref-x":5,fill:"black","font-size":12,"font-family":"Times New Roman"},".uml-class-methods-text":{ref:".uml-class-methods-rect","ref-y":5,"ref-x":5,fill:"black","font-size":12,"font-family":"Times New Roman"}},name:[],attributes:[],methods:[]},{markup:['<g class="rotatable">','<g class="scalable">','<rect class="uml-class-name-rect"/><rect class="uml-class-attrs-rect"/><rect class="uml-class-methods-rect"/>',"</g>",'<text class="uml-class-name-text"/><text class="uml-class-attrs-text"/><text class="uml-class-methods-text"/>',"</g>"].join(""),initialize:function(){this.on("change:name change:attributes change:methods",function(){this.updateRectangles(),this.trigger("uml-update")},this),this.updateRectangles(),_t.prototype.initialize.apply(this,arguments)},getClassName:function(){return this.get("name")},updateRectangles:function(){var r=this.get("attrs"),t=[{type:"name",text:this.getClassName()},{type:"attrs",text:this.get("attributes")},{type:"methods",text:this.get("methods")}],n=0;t.forEach(function(t){var e=Array.isArray(t.text)?t.text:[t.text],i=20*e.length+20;r[".uml-class-"+t.type+"-text"].text=e.join("\n"),r[".uml-class-"+t.type+"-rect"].height=i,r[".uml-class-"+t.type+"-rect"].transform="translate(0,"+n+")",n+=i})}})),Lt=Tt.extend({initialize:function(){Tt.prototype.initialize.apply(this,arguments),this.listenTo(this.model,"uml-update",function(){this.update(),this.resize()})}}),Ft=Bt.define("uml.Abstract",{attrs:{".uml-class-name-rect":{fill:"#e74c3c"},".uml-class-attrs-rect":{fill:"#c0392b"},".uml-class-methods-rect":{fill:"#c0392b"}}},{getClassName:function(){return["<<Abstract>>",this.get("name")]}}),Ot=Lt,Dt=Bt.define("uml.Interface",{attrs:{".uml-class-name-rect":{fill:"#f1c40f"},".uml-class-attrs-rect":{fill:"#f39c12"},".uml-class-methods-rect":{fill:"#f39c12"}}},{getClassName:function(){return["<<Interface>>",this.get("name")]}}),jt=Lt,It=St.define("uml.Generalization",{attrs:{".marker-target":{d:"M 20 0 L 0 10 L 20 20 z",fill:"white"}}}),Vt=St.define("uml.Implementation",{attrs:{".marker-target":{d:"M 20 0 L 0 10 L 20 20 z",fill:"white"},".connection":{"stroke-dasharray":"3,3"}}}),qt=St.define("uml.Aggregation",{attrs:{".marker-target":{d:"M 40 10 L 20 20 L 0 10 L 20 0 z",fill:"white"}}}),Gt=St.define("uml.Composition",{attrs:{".marker-target":{d:"M 40 10 L 20 20 L 0 10 L 20 0 z",fill:"black"}}}),Ut=St.define("uml.Association"),$t=_t.define("uml.State",{attrs:{".uml-state-body":{width:200,height:200,rx:10,ry:10,fill:"#ecf0f1",stroke:"#bdc3c7","stroke-width":3},".uml-state-separator":{stroke:"#bdc3c7","stroke-width":2},".uml-state-name":{ref:".uml-state-body","ref-x":.5,"ref-y":5,"text-anchor":"middle",fill:"#000000","font-family":"Courier New","font-size":14},".uml-state-events":{ref:".uml-state-separator","ref-x":5,"ref-y":5,fill:"#000000","font-family":"Courier New","font-size":14}},name:"State",events:[]},{markup:['<g class="rotatable">','<g class="scalable">','<rect class="uml-state-body"/>',"</g>",'<path class="uml-state-separator"/>','<text class="uml-state-name"/>','<text class="uml-state-events"/>',"</g>"].join(""),initialize:function(){this.on({"change:name":this.updateName,"change:events":this.updateEvents,"change:size":this.updatePath},this),this.updateName(),this.updateEvents(),this.updatePath(),_t.prototype.initialize.apply(this,arguments)},updateName:function(){this.attr(".uml-state-name/text",this.get("name"))},updateEvents:function(){this.attr(".uml-state-events/text",this.get("events").join("\n"))},updatePath:function(){var t="M 0 20 L "+this.get("size").width+" 20";this.attr(".uml-state-separator/d",t,{silent:!0})}}),Ht=Rt.define("uml.StartState",{type:"uml.StartState",attrs:{circle:{fill:"#34495e",stroke:"#2c3e50","stroke-width":2,rx:1}}}),Wt=_t.define("uml.EndState",{size:{width:20,height:20},attrs:{"circle.outer":{transform:"translate(10, 10)",r:10,fill:"#ffffff",stroke:"#2c3e50"},"circle.inner":{transform:"translate(10, 10)",r:6,fill:"#34495e"}}},{markup:'<g class="rotatable"><g class="scalable"><circle class="outer"/><circle class="inner"/></g></g>'}),Jt=St.define("uml.Transition",{attrs:{".marker-target":{d:"M 10 0 L 0 5 L 10 10 z",fill:"#34495e",stroke:"#2c3e50"},".connection":{stroke:"#2c3e50"}}});t.Class=Bt,t.ClassView=Lt,t.Abstract=Ft,t.AbstractView=Ot,t.Interface=Dt,t.InterfaceView=jt,t.Generalization=It,t.Implementation=Vt,t.Aggregation=qt,t.Composition=Gt,t.Association=Ut,t.State=$t,t.StartState=Ht,t.EndState=Wt,t.Transition=Jt}(this.joint.shapes.uml=this.joint.shapes.uml||{},Backbone,_,$,V,g);