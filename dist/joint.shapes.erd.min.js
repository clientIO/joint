/*! JointJS v3.0.0-beta (2019-06-06) - JavaScript diagramming library


This Source Code Form is subject to the terms of the Mozilla Public
License, v. 2.0. If a copy of the MPL was not distributed with this
file, You can obtain one at http://mozilla.org/MPL/2.0/.
*/
this.joint=this.joint||{},this.joint.shapes=this.joint.shapes||{},function(t,r,n,m,j,d){"use strict";r=r&&r.hasOwnProperty("default")?r.default:r,n=n&&n.hasOwnProperty("default")?n.default:n,m=m&&m.hasOwnProperty("default")?m.default:m,j=j&&j.hasOwnProperty("default")?j.default:j;var e,i,v=function(t,e,r){for(var i,n=Array.isArray(e)?e.slice():e.split(r||"/");n.length;){if(i=n.shift(),!(Object(t)===t&&i in t))return;t=t[i]}return t},y=function(t,e,r,i){for(var n=Array.isArray(e)?e:e.split(i||"/"),o=t,s=0,a=n.length;s<a-1;s++)o=o[n[s]]||(o[n[s]]={});return o[n[a-1]]=r,t},x=function(t,e,r){r=r||"/";var i=Array.isArray(e)?e.slice():e.split(r),n=i.pop();if(0<i.length){var o=v(t,i,r);o&&delete o[n]}else delete t[n];return t},u=function(){var n;if("undefined"!=typeof window&&(n=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame),!n){var o=0;n=function(t){var e=(new Date).getTime(),r=Math.max(0,16-(e-o)),i=setTimeout(function(){t(e+r)},r);return o=e+r,i}}return function(t,e){for(var r=[],i=arguments.length-2;0<i--;)r[i]=arguments[i+2];return n(void 0!==e?t.bind.apply(t,[e].concat(r)):t)}}(),o=((i="undefined"!=typeof window)&&(e=window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.webkitCancelRequestAnimationFrame||window.msCancelAnimationFrame||window.msCancelRequestAnimationFrame||window.oCancelAnimationFrame||window.oCancelRequestAnimationFrame||window.mozCancelAnimationFrame||window.mozCancelRequestAnimationFrame),e=e||clearTimeout,i?e.bind(window):e),h=function(t){return D(t)&&"%"===t.slice(-1)},q=function(t,e){var r=parseFloat(t);if(Number.isNaN(r))return null;var i,n={};if(n.value=r,null==e)i="[A-Za-z]*";else if(Array.isArray(e)){if(0===e.length)return null;i=e.join("|")}else D(e)&&(i=e);var o,s=(o=new RegExp("(?:\\d+(?:\\.\\d+)*)("+i+")$").exec(t))?o[1]:null;return null===s?null:(n.unit=s,n)},c={linear:function(t){return t},quad:function(t){return t*t},cubic:function(t){return t*t*t},inout:function(t){if(t<=0)return 0;if(1<=t)return 1;var e=t*t,r=e*t;return 4*(t<.5?r:3*(t-e)+r-.75)},exponential:function(t){return Math.pow(2,10*(t-1))},bounce:function(t){for(var e=0,r=1;;e+=r,r/=2)if((7-4*e)/11<=t){var i=(11-6*e-11*t)/4;return-i*i+r*r}},reverse:function(e){return function(t){return 1-e(1-t)}},reflect:function(e){return function(t){return.5*(t<.5?e(2*t):2-e(2-2*t))}},clamp:function(r,i,n){return i=i||0,n=n||1,function(t){var e=r(t);return e<i?i:n<e?n:e}},back:function(e){return e||(e=1.70158),function(t){return t*t*((e+1)*t-e)}},elastic:function(e){return e||(e=1.5),function(t){return Math.pow(2,10*(t-1))*Math.cos(20*Math.PI*e/3*t)}}},f={number:function(e,t){var r=t-e;return function(t){return e+r*t}},object:function(n,o){var s=Object.keys(n);return function(t){var e,r,i={};for(e=s.length-1;-1!=e;e--)i[r=s[e]]=n[r]+(o[r]-n[r])*t;return i}},hexColor:function(t,e){var r=parseInt(t.slice(1),16),i=parseInt(e.slice(1),16),n=255&r,o=(255&i)-n,s=65280&r,a=(65280&i)-s,l=16711680&r,u=(16711680&i)-l;return function(t){return"#"+(1<<24|n+o*t&255|s+a*t&65280|l+u*t&16711680).toString(16).slice(1)}},unit:function(e,t){var r=/(-?[0-9]*.[0-9]*)(px|em|cm|mm|in|pt|pc|%)/,i=r.exec(e),n=r.exec(t),o=n[1].indexOf("."),s=0<o?n[1].length-o-1:0;e=+i[1];var a=+n[1]-e,l=i[2];return function(t){return(e+a*t).toFixed(s)+l}}},p=(n.assign,n.defaults,n.defaultsDeep,n.assign),b=n.defaults,s=n.defaultsDeep,w=n.invokeMap||n.invoke,a=(n.sortedIndexBy||n.sortedIndex,n.uniqBy||n.uniq),l=n.clone,k=n.cloneDeep,P=n.isEmpty,A=n.isEqual,C=n.isFunction,E=n.isPlainObject,z=n.toArray,B=(n.debounce,n.groupBy,n.sortBy,n.flattenDeep,n.without),L=(n.difference,n.intersection,n.union,n.has),F=n.result,R=n.omit,I=n.pick,M=(n.bindAll,n.forIn),_=(n.camelCase,n.uniqueId),S=function(){if(n.mergeWith){var t=Array.from(arguments),e=t[t.length-1],i=C(e)?e:N;return t.push(function(t,e){var r=i(t,e);return void 0!==r?r:Array.isArray(t)&&!Array.isArray(e)?e:void 0}),n.mergeWith.apply(this,t)}return n.merge.apply(this,arguments)},O=function(t){return!!t&&("object"==typeof t||"function"==typeof t)},T=function(t){var e=Object.prototype.toString;return"number"==typeof t||!!t&&"object"==typeof t&&"[object Number]"===e.call(t)},D=function(t){var e=Object.prototype.toString;return"string"==typeof t||!!t&&"object"==typeof t&&"[object String]"===e.call(t)},N=function(){};function G(o,s){return function(t,e){var r=h(t);t=parseFloat(t),r&&(t/=100);var i={};if(isFinite(t)){var n=r||0<=t&&t<=1?t*e[s]:Math.max(t+e[s],0);i[o]=n}return i}}function V(s,a,l){return function(t,e){var r,i=h(t);if(t=parseFloat(t),i&&(t/=100),isFinite(t)){var n=e[l]();r=i||0<t&&t<1?n[s]+e[a]*t:n[s]+t}var o=d.Point();return o[s]=r||0,o}}function W(n,o,s){return function(t,e){var r;r="middle"===t?e[o]/2:t===s?e[o]:isFinite(t)?-1<t&&t<1?-e[o]*t:-t:h(t)?e[o]*parseFloat(t)/100:0;var i=d.Point();return i[n]=-(e[n]+r),i}}function H(d,t){var p="joint-shape",g=t&&t.resetOffset;return function(t,e,r){var i=m(r),n=i.data(p);if(!n||n.value!==t){var o=d(t);n={value:t,shape:o,shapeBBox:o.bbox()},i.data(p,n)}var s=n.shape.clone(),a=n.shapeBBox.clone(),l=a.origin(),u=e.origin();a.x=u.x,a.y=u.y;var h=e.maxRectScaleToFit(a,u),c=0===a.width||0===e.width?1:h.sx,f=0===a.height||0===e.height?1:h.sy;return s.scale(c,f,l),g&&s.translate(-l.x,-l.y),s}}function K(t){var i=H(function(t){return new d.Path(j.normalizePathData(t))},t);return function(t,e,r){return{d:i(t,e,r).serialize()}}}function X(t){var i=H(d.Polyline,t);return function(t,e,r){return{points:i(t,e,r).serialize()}}}function Y(n,o){var s=new d.Point(1,0);return function(t){var e,r,i=this[n](t);return i?(r=o.rotate?i.vector().vectorAngle(s):0,e=i.start):(e=this.path.start,r=0),0===r?{transform:"translate("+e.x+","+e.y+")"}:{transform:"translate("+e.x+","+e.y+") rotate("+r+")"}}}function Z(t,e,r){return void 0!==r.text}function J(){return this.model.isLink()}function U(t){var e={},r=t.stroke;"string"==typeof r&&(e.stroke=r,e.fill=r);var i=t.strokeOpacity;return void 0===i&&(i=t["stroke-opacity"]),void 0===i&&(i=t.opacity),void 0!==i&&(e["stroke-opacity"]=i,e["fill-opacity"]=i),e}var $,Q,tt={xlinkHref:{set:"xlink:href"},xlinkShow:{set:"xlink:show"},xlinkRole:{set:"xlink:role"},xlinkType:{set:"xlink:type"},xlinkArcrole:{set:"xlink:arcrole"},xlinkTitle:{set:"xlink:title"},xlinkActuate:{set:"xlink:actuate"},xmlSpace:{set:"xml:space"},xmlBase:{set:"xml:base"},xmlLang:{set:"xml:lang"},preserveAspectRatio:{set:"preserveAspectRatio"},requiredExtension:{set:"requiredExtension"},requiredFeatures:{set:"requiredFeatures"},systemLanguage:{set:"systemLanguage"},externalResourcesRequired:{set:"externalResourceRequired"},filter:{qualify:E,set:function(t){return"url(#"+this.paper.defineFilter(t)+")"}},fill:{qualify:E,set:function(t){return"url(#"+this.paper.defineGradient(t)+")"}},stroke:{qualify:E,set:function(t){return"url(#"+this.paper.defineGradient(t)+")"}},sourceMarker:{qualify:E,set:function(t,e,r,i){return t=p(U(i),t),{"marker-start":"url(#"+this.paper.defineMarker(t)+")"}}},targetMarker:{qualify:E,set:function(t,e,r,i){return t=p(U(i),{transform:"rotate(180)"},t),{"marker-end":"url(#"+this.paper.defineMarker(t)+")"}}},vertexMarker:{qualify:E,set:function(t,e,r,i){return t=p(U(i),t),{"marker-mid":"url(#"+this.paper.defineMarker(t)+")"}}},text:{qualify:function(t,e,r){return!r.textWrap||!E(r.textWrap)},set:function(t,e,r,i){var n=m(r),o="joint-text",s=n.data(o),a=I(i,"lineHeight","annotations","textPath","x","textVerticalAnchor","eol"),l=a.fontSize=i["font-size"]||i.fontSize,u=JSON.stringify([t,a]);if(void 0===s||s!==u){l&&r.setAttribute("font-size",l);var h=a.textPath;if(O(h)){var c=h.selector;if("string"==typeof c){var f=this.findBySelector(c)[0];f instanceof SVGPathElement&&(a.textPath=p({"xlink:href":"#"+f.id},h))}}j(r).text(""+t,a),n.data(o,u)}}},textWrap:{qualify:E,set:function(t,e,r,i){var n=t.width||0;h(n)?e.width*=parseFloat(n)/100:n<=0?e.width+=n:e.width=n;var o,s=t.height||0;h(s)?e.height*=parseFloat(s)/100:s<=0?e.height+=s:e.height=s;var a=t.text;void 0===a&&(a=i.text),o=void 0!==a?function(t,e,r,i){i=i||{},r=r||{};var n=e.width,o=e.height,s=i.svgDocument||j("svg").node,a=j("tspan").node,l=j("text").attr(r).append(a).node,u=document.createTextNode("");l.style.opacity=0,l.style.display="block",a.style.display="block",a.appendChild(u),s.appendChild(l),i.svgDocument||document.body.appendChild(s);for(var h,c,f,d=i.separator||" ",p=i.eol||"\n",g=i.hyphen?new RegExp(i.hyphen):/[^\w\d]/,m=t.split(d),v=[],y=[],x=0,b=0,w=m.length;x<w;x++){var k=m[x];if(k)if(p&&0<=k.indexOf(p))if(1<k.length){for(var P=k.split(p),A=0,C=P.length-1;A<C;A++)P.splice(2*A+1,0,p);Array.prototype.splice.apply(m,[x,1].concat(P)),x--,w+=P.length-1}else b++;else{if(u.data=y[b]?y[b]+" "+k:k,a.getComputedTextLength()<=n)y[b]=u.data,(h||c)&&(v[b++]=!0,c=h=0);else{if(!y[b]||h){var E=!!h;if(h=k.length-1,E||!h){if(!h){if(!y[b]){y=[];break}m.splice(x,2,k+m[x+1]),w--,v[b++]=!0,x--;continue}m[x]=k.substring(0,h),m[x+1]=k.substring(h)+m[x+1]}else{if(c)m.splice(x,2,m[x]+m[x+1]),c=0;else{var z=k.search(g);-1<z&&z!==k.length-1&&0!==z&&(c=z+1,h=0),m.splice(x,1,k.substring(0,c||h),k.substring(c||h)),w++}b&&!v[b-1]&&b--}x--;continue}b++,x--}var B;if(void 0!==o)if(void 0===f&&(f=(B="auto"===r.lineHeight?{value:1.5,unit:"em"}:q(r.lineHeight,["em"])||{value:1,unit:"em"}).value,"em"===B.unit&&(f*=l.getBBox().height)),f*y.length>o){var L=Math.floor(o/f)-1;y.splice(L+1);var F=i.ellipsis;if(!F||L<0)break;"string"!=typeof F&&(F="â€¦");var R,I,M=y[L],_=M.length;do{if(I=M[_],R=M.substring(0,_),I?I.match(d)&&(R+=I):R+="string"==typeof d?d:" ",R+=F,u.data=R,a.getComputedTextLength()<=n){y[L]=R;break}_--}while(0<=_);break}}}return i.svgDocument?s.removeChild(l):document.body.removeChild(s),y.join(p)}(""+a,e,{"font-weight":i["font-weight"]||i.fontWeight,"font-size":i["font-size"]||i.fontSize,"font-family":i["font-family"]||i.fontFamily,lineHeight:i.lineHeight},{svgDocument:this.paper.svg,ellipsis:t.ellipsis,hyphen:t.hyphen}):"",tt.text.set.call(this,o,e,r,i)}},title:{qualify:function(t,e){return e instanceof SVGElement},set:function(t,e,r){var i=m(r),n="joint-title",o=i.data(n);if(void 0===o||o!==t){i.data(n,t);var s=r.firstChild;if(s&&"TITLE"===s.tagName.toUpperCase())s.textContent=t;else{var a=document.createElementNS(r.namespaceURI,"title");a.textContent=t,r.insertBefore(a,s)}}}},lineHeight:{qualify:Z},textVerticalAnchor:{qualify:Z},textPath:{qualify:Z},annotations:{qualify:Z},port:{set:function(t){return null===t||void 0===t.id?t:t.id}},style:{qualify:E,set:function(t,e,r){m(r).css(t)}},html:{set:function(t,e,r){m(r).html(t+"")}},ref:{},refX:{position:V("x","width","origin")},refY:{position:V("y","height","origin")},refDx:{position:V("x","width","corner")},refDy:{position:V("y","height","corner")},refWidth:{set:G("width","width")},refHeight:{set:G("height","height")},refRx:{set:G("rx","width")},refRy:{set:G("ry","height")},refRInscribed:{set:($=G("r","width"),Q=G("r","height"),function(t,e){return(e.height>e.width?$:Q)(t,e)})},refRCircumscribed:{set:function(t,e){var r=h(t);t=parseFloat(t),r&&(t/=100);var i,n=Math.sqrt(e.height*e.height+e.width*e.width);return isFinite(t)&&(i=r||0<=t&&t<=1?t*n:Math.max(t+n,0)),{r:i}}},refCx:{set:G("cx","width")},refCy:{set:G("cy","height")},xAlignment:{offset:W("x","width","right")},yAlignment:{offset:W("y","height","bottom")},resetOffset:{offset:function(t,e){return t?{x:-e.x,y:-e.y}:{x:0,y:0}}},refDResetOffset:{set:K({resetOffset:!0})},refDKeepOffset:{set:K({resetOffset:!1})},refPointsResetOffset:{set:X({resetOffset:!0})},refPointsKeepOffset:{set:X({resetOffset:!1})},connection:{qualify:J,set:function(){return{d:this.getSerializedConnection()}}},atConnectionLengthKeepGradient:{qualify:J,set:Y("getTangentAtLength",{rotate:!0})},atConnectionLengthIgnoreGradient:{qualify:J,set:Y("getTangentAtLength",{rotate:!1})},atConnectionRatioKeepGradient:{qualify:J,set:Y("getTangentAtRatio",{rotate:!0})},atConnectionRatioIgnoreGradient:{qualify:J,set:Y("getTangentAtRatio",{rotate:!1})}};tt.refR=tt.refRInscribed,tt.refD=tt.refDResetOffset,tt.refPoints=tt.refPointsResetOffset,tt.atConnectionLength=tt.atConnectionLengthKeepGradient,tt.atConnectionRatio=tt.atConnectionRatioKeepGradient,tt.refX2=tt.refX,tt.refY2=tt.refY,tt.refWidth2=tt.refWidth,tt.refHeight2=tt.refHeight,tt["ref-x"]=tt.refX,tt["ref-y"]=tt.refY,tt["ref-dy"]=tt.refDy,tt["ref-dx"]=tt.refDx,tt["ref-width"]=tt.refWidth,tt["ref-height"]=tt.refHeight,tt["x-alignment"]=tt.xAlignment,tt["y-alignment"]=tt.yAlignment;var et=tt,rt=r.Model.extend({constructor:function(t,e){var r,i=t||{};this.cid=_("c"),this.attributes={},e&&e.collection&&(this.collection=e.collection),e&&e.parse&&(i=this.parse(i,e)||{}),(r=F(this,"defaults"))&&(i=S({},r,i)),this.set(i,e),this.changed={},this.initialize.apply(this,arguments)},translate:function(t,e,r){throw new Error("Must define a translate() method.")},toJSON:function(){var e=this.constructor.prototype.defaults.attrs||{},t=this.attributes.attrs,o={};M(t,function(t,i){var n=e[i];M(t,function(t,r){O(t)&&!Array.isArray(t)?M(t,function(t,e){n&&n[r]&&A(n[r][e],t)||(o[i]=o[i]||{},(o[i][r]||(o[i][r]={}))[e]=t)}):n&&A(n[r],t)||(o[i]=o[i]||{},o[i][r]=t)})});var r=k(R(this.attributes,"attrs"));return r.attrs=o,r},initialize:function(t){t&&t.id||this.set("id",this.generateId(),{silent:!0}),this._transitionIds={},this.processPorts(),this.on("change:attrs",this.processPorts,this)},generateId:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)})},processPorts:function(){var t=this.ports,r={};M(this.get("attrs"),function(t,e){t&&t.port&&(void 0!==t.port.id?r[t.port.id]=t.port:r[t.port]={id:t.port})});var i={};(M(t,function(t,e){r[e]||(i[e]=!0)}),this.graph&&!P(i))&&(this.graph.getConnectedLinks(this,{inbound:!0}).forEach(function(t){i[t.get("target").port]&&t.remove()}),this.graph.getConnectedLinks(this,{outbound:!0}).forEach(function(t){i[t.get("source").port]&&t.remove()}));this.ports=r},remove:function(t){t=t||{};var e=this.graph;if(!e)return this.collection&&this.collection.remove(this,t),this;e.startBatch("remove");var r=this.getParentCell();r&&r.unembed(this);for(var i=this.getEmbeddedCells(),n=0,o=i.length;n<o;n++){var s=i[n];s&&s.remove(t)}return this.trigger("remove",this,e.attributes.cells,t),e.stopBatch("remove"),this},toFront:function(r){var t=this.graph;if(t){r=r||{};var e,i=t.maxZIndex();r.deep?(e=this.getEmbeddedCells({deep:!0,breadthFirst:!0})).unshift(this):e=[this],i=i-e.length+1;var n=t.get("cells"),o=n.indexOf(this)!==n.length-e.length;o||(o=e.some(function(t,e){return t.get("z")!==i+e})),o&&(this.startBatch("to-front"),i+=e.length,e.forEach(function(t,e){t.set("z",i+e,r)}),this.stopBatch("to-front"))}return this},toBack:function(r){var t=this.graph;if(t){r=r||{};var e,i=t.minZIndex();r.deep?(e=this.getEmbeddedCells({deep:!0,breadthFirst:!0})).unshift(this):e=[this];var n=0!==t.get("cells").indexOf(this);n||(n=e.some(function(t,e){return t.get("z")!==i+e})),n&&(this.startBatch("to-back"),i-=e.length,e.forEach(function(t,e){t.set("z",i+e,r)}),this.stopBatch("to-back"))}return this},parent:function(t,e){return void 0===t?this.get("parent"):this.set("parent",t,e)},embed:function(t,e){if(this===t||this.isEmbeddedIn(t))throw new Error("Recursive embedding not allowed.");this.startBatch("embed");var r=p([],this.get("embeds"));return r[t.isLink()?"unshift":"push"](t.id),t.parent(this.id,e),this.set("embeds",a(r),e),this.stopBatch("embed"),this},unembed:function(t,e){return this.startBatch("unembed"),t.unset("parent",e),this.set("embeds",B(this.get("embeds"),t.id),e),this.stopBatch("unembed"),this},getParentCell:function(){var t=this.parent(),e=this.graph;return t&&e&&e.getCell(t)||null},getAncestors:function(){var t=[];if(!this.graph)return t;for(var e=this.getParentCell();e;)t.push(e),e=e.getParentCell();return t},getEmbeddedCells:function(e){if(e=e||{},this.graph){var r;if(e.deep)if(e.breadthFirst){r=[];for(var t=this.getEmbeddedCells();0<t.length;){var i=t.shift();r.push(i),t.push.apply(t,i.getEmbeddedCells())}}else(r=this.getEmbeddedCells()).forEach(function(t){r.push.apply(r,t.getEmbeddedCells(e))});else r=z(this.get("embeds")).map(this.graph.getCell,this.graph);return r}return[]},isEmbeddedIn:function(t,e){var r=D(t)?t:t.id,i=this.parent();if(e=b({deep:!0},e),this.graph&&e.deep){for(;i;){if(i===r)return!0;i=this.graph.getCell(i).parent()}return!1}return i===r},isEmbedded:function(){return!!this.parent()},clone:function(t){if((t=t||{}).deep)return z(function(t){t=a(t);var s=z(t).reduce(function(t,e){return t[e.id]=e.clone(),t},{});return z(t).forEach(function(t){var e=s[t.id];if(e.isLink()){var r=e.source(),i=e.target();r.id&&s[r.id]&&e.prop("source/id",s[r.id].id),i.id&&s[i.id]&&e.prop("target/id",s[i.id].id)}var n=t.get("parent");n&&s[n]&&e.set("parent",s[n].id);var o=z(t.get("embeds")).reduce(function(t,e){return s[e]&&t.push(s[e].id),t},[]);P(o)||e.set("embeds",o)}),s}([this].concat(this.getEmbeddedCells({deep:!0}))));var e=r.Model.prototype.clone.apply(this,arguments);return e.set("id",this.generateId()),e.unset("embeds"),e.unset("parent"),e},prop:function(t,e,r){var i=D(t);if(i||Array.isArray(t)){if(1<arguments.length){var n,o,s=(o=i?(n=t).split("/"):(n=t.join("/"),t.slice()))[0],a=o.length;if((r=r||{}).propertyPath=n,r.propertyValue=e,r.propertyPathArray=o,1===a)return this.set(s,e,r);for(var l={},u=l,h=s,c=1;c<a;c++){var f=o[c],d=Number.isFinite(i?Number(f):f);u=u[h]=d?[]:{},h=f}l=y(l,o,e,"/");var p=S({},this.attributes);r.rewrite&&x(p,n,"/");var g=S(p,l);return this.set(s,g[s],r)}return v(this.attributes,t,"/")}return this.set(S({},this.attributes,t),e)},removeProp:function(t,e){e=e||{};var r=Array.isArray(t)?t:t.split("/"),i=r[0];if("attrs"===i&&(e.dirty=!0),1===r.length)return this.unset(t,e);var n=r.slice(1),o=k(this.get(i));return x(o,n,"/"),this.set(i,o,e)},attr:function(t,e,r){var i=Array.from(arguments);return 0===i.length?this.get("attrs"):(Array.isArray(t)?i[0]=["attrs"].concat(t):D(t)?i[0]="attrs/"+t:i[0]={attrs:t},this.prop.apply(this,i))},removeAttr:function(t,e){return Array.isArray(t)?this.removeProp(["attrs"].concat(t)):this.removeProp("attrs/"+t,e)},transition:function(n,e,o,r){r=r||"/",o=p({duration:100,delay:10,timingFunction:c.linear,valueFunction:f.number},o);var s,a=0,l=function(t){var e,r,i;(r=(t-=a=a||t)/o.duration)<1?this._transitionIds[n]=e=u(l):(r=1,delete this._transitionIds[n]),i=s(o.timingFunction(r)),o.transitionId=e,this.prop(n,i,o),e||this.trigger("transition:end",this,n)}.bind(this),t=function(t){this.stopTransitions(n),s=o.valueFunction(v(this.attributes,n,r),e),this._transitionIds[n]=u(t),this.trigger("transition:start",this,n)}.bind(this);return setTimeout(t,o.delay,l)},getTransitions:function(){return Object.keys(this._transitionIds)},stopTransitions:function(t,e){e=e||"/";var r=t&&t.split(e);return Object.keys(this._transitionIds).filter(r&&function(t){return A(r,t.split(e).slice(0,r.length))}).forEach(function(t){o(this._transitionIds[t]),delete this._transitionIds[t],this.trigger("transition:end",this,t)},this),this},addTo:function(t,e){return t.addCell(this,e),this},findView:function(t){return t.findViewByModel(this)},isElement:function(){return!1},isLink:function(){return!1},startBatch:function(t,e){return this.graph&&this.graph.startBatch(t,p({},e,{cell:this})),this},stopBatch:function(t,e){return this.graph&&this.graph.stopBatch(t,p({},e,{cell:this})),this},getChangeFlag:function(t){var e=0;if(!t)return e;for(var r in t)t.hasOwnProperty(r)&&this.hasChanged(r)&&(e|=t[r]);return e},angle:function(){return 0},position:function(){return new g.Point(0,0)},getPointFromConnectedLink:function(){return new g.Point},getBBox:function(){return new g.Rect(0,0,0,0)}},{getAttributeDefinition:function(t){var e=this.attributes,r=et;return e&&e[t]||r[t]},define:function(t,e,r,i){r=p({defaults:s({type:t},e,this.prototype.defaults)},r);var n=this.extend(r,i);return"undefined"!=typeof joint&&L(joint,"shapes")&&y(joint.shapes,t,n,"."),n}});function it(t,e,r){var i=t.toJSON();return i.angle=e||0,b({},r,i)}function nt(t,e,r){return t.map(function(t,e,r){var i=this.pointAt((e+.5)/r.length);return(t.dx||t.dy)&&i.offset(t.dx||0,t.dy||0),it(i.round(),0,t)},d.line(e,r))}function ot(t,e,s,a){var l=e.center(),u=e.width/e.height,h=e.topMiddle(),c=d.Ellipse.fromRect(e);return t.map(function(t,e,r){var i=s+a(e,r.length),n=h.clone().rotate(l,-i).scale(u,1,l),o=t.compensateRotation?-c.tangentTheta(n):0;return(t.dx||t.dy)&&n.offset(t.dx||0,t.dy||0),t.dr&&n.move(l,t.dr),it(n.round(),o,t)})}function st(t,e){var r=e.x;D(r)&&(r=parseFloat(r)/100*t.width);var i=e.y;return D(i)&&(i=parseFloat(i)/100*t.height),d.point(r||0,i||0)}var at=Object.freeze({absolute:function(t,e,r){return t.map(st.bind(null,e))},fn:function(t,e,r){return r.fn(t,e,r)},line:function(t,e,r){return nt(t,st(e,r.start||e.origin()),st(e,r.end||e.corner()))},left:function(t,e,r){return nt(t,e.origin(),e.bottomLeft())},right:function(t,e,r){return nt(t,e.topRight(),e.corner())},top:function(t,e,r){return nt(t,e.origin(),e.topRight())},bottom:function(t,e,r){return nt(t,e.bottomLeft(),e.corner())},ellipseSpread:function(t,e,r){var i=r.startAngle||0,n=r.step||360/t.length;return ot(t,e,i,function(t){return t*n})},ellipse:function(t,e,r){var i=r.startAngle||0,n=r.step||20;return ot(t,e,i,function(t,e){return(t+.5-e/2)*n})}});function lt(t,e){return s({},t,e,{x:0,y:0,angle:0,attrs:{".":{y:"0","text-anchor":"start"}}})}function ut(t,e,r,i){i=b({},i,{offset:15});var n,o,s,a,l=e.center().theta(t),u=ht(e),h=i.offset,c=0;a=l<u[1]||l>u[2]?(s=".3em",n=h,o=0,"start"):l<u[0]?(s="0",n=0,o=-h,r?(c=-90,"start"):"middle"):l<u[3]?(s=".3em",n=-h,o=0,"end"):(s=".6em",n=0,o=h,r?(c=90,"start"):"middle");var f=Math.round;return lt({x:f(n),y:f(o),angle:c,attrs:{".":{y:s,"text-anchor":a}}})}function ht(t){var e=t.center(),r=e.theta(t.origin()),i=e.theta(t.bottomLeft()),n=e.theta(t.corner());return[r,e.theta(t.topRight()),n,i]}function ct(t,e,r,i){var n,o,s,a,l=e.center().theta(t),u=(i=b({},i,{offset:15})).offset,h=0,c=ht(e);a=l<c[1]||l>c[2]?(s=".3em",n=-u,o=0,"end"):l<c[0]?(s=".6em",n=0,o=u,r?(h=90,"start"):"middle"):l<c[3]?(s=".3em",n=u,o=0,"start"):(s="0em",n=0,o=-u,r?(h=-90,"start"):"middle");var f=Math.round;return lt({x:f(n),y:f(o),angle:h,attrs:{".":{y:s,"text-anchor":a}}})}function ft(t,e,r){r=b({},r,{offset:20});var i,n=d.point(0,0),o=-t.theta(n),s=o,a=t.clone().move(n,r.offset).difference(t).round(),l=".3em";(o+90)%180==0?(i=e?"end":"middle",e||-270!==o||(l="0em")):-270<o&&o<-90?(i="start",s=o-180):i="end";var u=Math.round;return lt({x:u(a.x),y:u(a.y),angle:e?s:0,attrs:{".":{y:l,"text-anchor":i}}})}var dt=Object.freeze({manual:function(t,e,r){return lt(r,e)},left:function(t,e,r){return lt(r,{x:-15,attrs:{".":{y:".3em","text-anchor":"end"}}})},right:function(t,e,r){return lt(r,{x:15,attrs:{".":{y:".3em","text-anchor":"start"}}})},top:function(t,e,r){return lt(r,{y:-15,attrs:{".":{"text-anchor":"middle"}}})},bottom:function(t,e,r){return lt(r,{y:15,attrs:{".":{y:".6em","text-anchor":"middle"}}})},outsideOriented:function(t,e,r){return ut(t,e,!0,r)},outside:function(t,e,r){return ut(t,e,!1,r)},insideOriented:function(t,e,r){return ct(t,e,!0,r)},inside:function(t,e,r){return ct(t,e,!1,r)},radial:function(t,e,r){return ft(t.difference(e.center()),!1,r)},radialOriented:function(t,e,r){return ft(t.difference(e.center()),!0,r)}}),pt=function(t){var e=k(t)||{};this.ports=[],this.groups={},this.portLayoutNamespace=at,this.portLabelLayoutNamespace=dt,this._init(e)};pt.prototype={getPorts:function(){return this.ports},getGroup:function(t){return this.groups[t]||{}},getPortsByGroup:function(e){return this.ports.filter(function(t){return t.group===e})},getGroupPortsMetrics:function(t,n){var e=this.getGroup(t),r=this.getPortsByGroup(t),i=e.position||{},o=i.name,s=this.portLayoutNamespace;s[o]||(o="left");var a=i.args||{},l=r.map(function(t){return t&&t.position&&t.position.args}),u=s[o](l,n,a),h={ports:r,result:[]};return z(u).reduce(function(t,e,r){var i=t.ports[r];return t.result.push({portId:i.id,portTransformation:e,labelTransformation:this._getPortLabelLayout(i,d.Point(e),n),portAttrs:i.attrs,portSize:i.size,labelSize:i.label.size}),t}.bind(this),h),h.result},_getPortLabelLayout:function(t,e,r){var i=this.portLabelLayoutNamespace,n=t.label.position.name||"left";return i[n]?i[n](e,r,t.label.position.args):null},_init:function(t){if(O(t.groups))for(var e=Object.keys(t.groups),r=0,i=e.length;r<i;r++){var n=e[r];this.groups[n]=this._evaluateGroup(t.groups[n])}for(var o=z(t.items),s=0,a=o.length;s<a;s++)this.ports.push(this._evaluatePort(o[s]))},_evaluateGroup:function(t){return S(t,{position:this._getPosition(t.position,!0),label:this._getLabel(t,!0)})},_evaluatePort:function(t){var e=p({},t),r=this.getGroup(t.group);return e.markup=e.markup||r.markup,e.attrs=S({},r.attrs,e.attrs),e.position=this._createPositionNode(r,e),e.label=S({},r.label,this._getLabel(e)),e.z=this._getZIndex(r,e),e.size=p({},r.size,e.size),e},_getZIndex:function(t,e){return T(e.z)?e.z:T(t.z)||"auto"===t.z?t.z:"auto"},_createPositionNode:function(t,e){return S({name:"left",args:{}},t.position,{args:e.args})},_getPosition:function(t,e){var r,i={};C(t)?(r="fn",i.fn=t):D(t)?r=t:void 0===t?r=e?"left":null:Array.isArray(t)?(r="absolute",i.x=t[0],i.y=t[1]):O(t)&&(r=t.name,p(i,t.args));var n={args:i};return r&&(n.name=r),n},_getLabel:function(t,e){var r=t.label||{},i=r;return i.position=this._getPosition(r.position,e),i}};var gt={_initializePorts:function(){this._createPortData(),this.on("change:ports",function(){this._processRemovedPort(),this._createPortData()},this)},_processRemovedPort:function(){var t=this.get("ports")||{},e={};z(t.items).forEach(function(t){e[t.id]=!0});var r=this.previous("ports")||{},i={};z(r.items).forEach(function(t){e[t.id]||(i[t.id]=!0)});var n=this.graph;n&&!P(i)&&(n.getConnectedLinks(this,{inbound:!0}).forEach(function(t){i[t.get("target").port]&&t.remove()}),n.getConnectedLinks(this,{outbound:!0}).forEach(function(t){i[t.get("source").port]&&t.remove()}))},hasPorts:function(){var t=this.prop("ports/items");return Array.isArray(t)&&0<t.length},hasPort:function(t){return-1!==this.getPortIndex(t)},getPorts:function(){return k(this.prop("ports/items"))||[]},getPort:function(e){return k(z(this.prop("ports/items")).find(function(t){return t.id&&t.id===e}))},getPortsPositions:function(t){return this._portSettingsData.getGroupPortsMetrics(t,d.Rect(this.size())).reduce(function(t,e){var r=e.portTransformation;return t[e.portId]={x:r.x,y:r.y,angle:r.angle},t},{})},getPortIndex:function(t){var e=O(t)?t.id:t;return this._isValidPortId(e)?z(this.prop("ports/items")).findIndex(function(t){return t.id===e}):-1},addPort:function(t,e){if(!O(t)||Array.isArray(t))throw new Error("Element: addPort requires an object.");var r=p([],this.prop("ports/items"));return r.push(t),this.prop("ports/items",r,e),this},portProp:function(t,e,r,i){var n=this.getPortIndex(t);if(-1===n)throw new Error("Element: unable to find port with id "+t);var o=Array.prototype.slice.call(arguments,1);return Array.isArray(e)?o[0]=["ports","items",n].concat(e):D(e)?o[0]=["ports/items/",n,"/",e].join(""):(o=["ports/items/"+n],E(e)&&(o.push(e),o.push(r))),this.prop.apply(this,o)},_validatePorts:function(){var t=this.get("ports")||{},e=[],r=z((t=t||{}).items);return r.forEach(function(t){"object"!=typeof t&&e.push("Element: invalid port ",t),this._isValidPortId(t.id)||(t.id=this.generatePortId())},this),a(r,"id").length!==r.length&&e.push("Element: found id duplicities in ports."),e},generatePortId:function(){return this.generateId()},_isValidPortId:function(t){return null!=t&&!O(t)},addPorts:function(t,e){return t.length&&this.prop("ports/items",p([],this.prop("ports/items")).concat(t),e),this},removePort:function(t,e){var r=e||{},i=p([],this.prop("ports/items")),n=this.getPortIndex(t);return-1!==n&&(i.splice(n,1),r.rewrite=!0,this.prop("ports/items",i,r)),this},removePorts:function(t,e){var r;if(Array.isArray(t)){if(r=e||{},t.length){r.rewrite=!0;var i=p([],this.prop("ports/items")).filter(function(r){return!t.some(function(t){var e=O(t)?t.id:t;return r.id===e})});this.prop("ports/items",i,r)}}else(r=t||{}).rewrite=!0,this.prop("ports/items",[],r);return this},_createPortData:function(){var t,e=this._validatePorts();if(0<e.length)throw this.set("ports",this.previous("ports")),new Error(e.join(" "));this._portSettingsData&&(t=this._portSettingsData.getPorts()),this._portSettingsData=new pt(this.get("ports"));var r=this._portSettingsData.getPorts();if(t){var i=r.filter(function(e){if(!t.find(function(t){return t.id===e.id}))return e}),n=t.filter(function(e){if(!r.find(function(t){return t.id===e.id}))return e});0<n.length&&this.trigger("ports:remove",this,n),0<i.length&&this.trigger("ports:add",this,i)}}},mt=rt.extend({defaults:{position:{x:0,y:0},size:{width:1,height:1},angle:0},initialize:function(){this._initializePorts(),rt.prototype.initialize.apply(this,arguments)},_initializePorts:function(){},_refreshPorts:function(){},isElement:function(){return!0},position:function(t,e,r){var i=T(e);if((r=(i?r:t)||{}).parentRelative){if(!this.graph)throw new Error("Element must be part of a graph.");var n=this.getParentCell(),o=n&&!n.isLink()?n.get("position"):{x:0,y:0}}if(i){if(r.parentRelative&&(t+=o.x,e+=o.y),r.deep){var s=this.get("position");this.translate(t-s.x,e-s.y,r)}else this.set("position",{x:t,y:e},r);return this}var a=d.Point(this.get("position"));return r.parentRelative?a.difference(o):a},translate:function(t,e,r){if(e=e||0,0===(t=t||0)&&0===e)return this;(r=r||{}).translateBy=r.translateBy||this.id;var i=this.get("position")||{x:0,y:0};if(r.restrictedArea&&r.translateBy===this.id){var n=this.getBBox({deep:!0}),o=r.restrictedArea,s=i.x-n.x,a=i.y-n.y,l=Math.max(o.x+s,Math.min(o.x+o.width+s-n.width,i.x+t)),u=Math.max(o.y+a,Math.min(o.y+o.height+a-n.height,i.y+e));t=l-i.x,e=u-i.y}var h={x:i.x+t,y:i.y+e};return r.tx=t,r.ty=e,r.transition?(O(r.transition)||(r.transition={}),this.transition("position",h,p({},r.transition,{valueFunction:f.object})),w(this.getEmbeddedCells(),"translate",t,e,r)):(this.startBatch("translate",r),this.set("position",h,r),w(this.getEmbeddedCells(),"translate",t,e,r),this.stopBatch("translate",r)),this},size:function(t,e,r){var i=this.get("size");return void 0===t?{width:i.width,height:i.height}:(O(t)&&(r=e,e=T(t.height)?t.height:i.height,t=T(t.width)?t.width:i.width),this.resize(t,e,r))},resize:function(t,e,r){if(r=r||{},this.startBatch("resize",r),r.direction){var i=this.get("size");switch(r.direction){case"left":case"right":e=i.height;break;case"top":case"bottom":t=i.width}var n=d.normalizeAngle(this.get("angle")||0),o={"top-right":0,right:0,"top-left":1,top:1,"bottom-left":2,left:2,"bottom-right":3,bottom:3}[r.direction];r.absolute&&(o+=Math.floor((n+45)/90),o%=4);var s=this.getBBox(),a=s[["bottomLeft","corner","topRight","origin"][o]](),l=d.Point(a).rotate(s.center(),-n),u=Math.sqrt(t*t+e*e)/2,h=o*Math.PI/2;h+=Math.atan(o%2==0?e/t:t/e),h-=d.toRad(n);var c=d.Point.fromPolar(u,h,l),f=d.Point(c).offset(t/-2,e/-2);this.set("size",{width:t,height:e},r),this.position(f.x,f.y,r)}else this.set("size",{width:t,height:e},r);return this.stopBatch("resize",r),this},scale:function(t,e,r,i){var n=this.getBBox().scale(t,e,r);return this.startBatch("scale",i),this.position(n.x,n.y,i),this.resize(n.width,n.height,i),this.stopBatch("scale"),this},fitEmbeds:function(t){if(t=t||{},!this.graph)throw new Error("Element must be part of a graph.");var e=this.getEmbeddedCells();if(0<e.length){this.startBatch("fit-embeds",t),t.deep&&w(e,"fitEmbeds",t);var r=this.graph.getCellsBBox(e),i=function(t){if(Object(t)===t)return e=r=i=n=0,isFinite(t.vertical)&&(e=i=+t.vertical),isFinite(t.horizontal)&&(r=n=+t.horizontal),isFinite(t.top)&&(e=+t.top),isFinite(t.right)&&(r=+t.right),isFinite(t.bottom)&&(i=+t.bottom),isFinite(t.left)&&(n=+t.left),{top:e,right:r,bottom:i,left:n};var e,r,i,n,o=0;return isFinite(t)&&(o=+t),{top:o,right:o,bottom:o,left:o}}(t.padding);r.moveAndExpand({x:-i.left,y:-i.top,width:i.right+i.left,height:i.bottom+i.top}),this.set({position:{x:r.x,y:r.y},size:{width:r.width,height:r.height}},t),this.stopBatch("fit-embeds")}return this},rotate:function(t,e,r,i){if(r){var n=this.getBBox().center(),o=this.get("size"),s=this.get("position");n.rotate(r,this.get("angle")-t);var a=n.x-o.width/2-s.x,l=n.y-o.height/2-s.y;this.startBatch("rotate",{angle:t,absolute:e,origin:r}),this.position(s.x+a,s.y+l,i),this.rotate(t,e,null,i),this.stopBatch("rotate")}else this.set("angle",e?t:(this.get("angle")+t)%360,i);return this},angle:function(){return d.normalizeAngle(this.get("angle")||0)},getBBox:function(t){if((t=t||{}).deep&&this.graph){var e=this.getEmbeddedCells({deep:!0,breadthFirst:!0});return e.push(this),this.graph.getCellsBBox(e)}var r=this.get("position"),i=this.get("size");return new d.Rect(r.x,r.y,i.width,i.height)},getPointFromConnectedLink:function(t,e){var r=this.getBBox(),i=r.center(),n=t.get(e);if(!n)return i;var o=n.port;if(!o)return i;var s=this.portProp(o,["group"]),a=this.getPortsPositions(s),l=new d.Point(a[o]).offset(r.origin()),u=this.angle();return u&&l.rotate(i,-u),l}});p(mt.prototype,gt);var vt=rt.extend({markup:['<path class="connection" stroke="black" d="M 0 0 0 0"/>','<path class="marker-source" fill="black" stroke="black" d="M 0 0 0 0"/>','<path class="marker-target" fill="black" stroke="black" d="M 0 0 0 0"/>','<path class="connection-wrap" d="M 0 0 0 0"/>','<g class="labels"/>','<g class="marker-vertices"/>','<g class="marker-arrowheads"/>','<g class="link-tools"/>'].join(""),toolMarkup:['<g class="link-tool">','<g class="tool-remove" event="remove">','<circle r="11" />','<path transform="scale(.8) translate(-16, -16)" d="M24.778,21.419 19.276,15.917 24.777,10.415 21.949,7.585 16.447,13.087 10.945,7.585 8.117,10.415 13.618,15.917 8.116,21.419 10.946,24.248 16.447,18.746 21.948,24.248z" />',"<title>Remove link.</title>","</g>",'<g class="tool-options" event="link:options">','<circle r="11" transform="translate(25)"/>','<path fill="white" transform="scale(.55) translate(29, -16)" d="M31.229,17.736c0.064-0.571,0.104-1.148,0.104-1.736s-0.04-1.166-0.104-1.737l-4.377-1.557c-0.218-0.716-0.504-1.401-0.851-2.05l1.993-4.192c-0.725-0.91-1.549-1.734-2.458-2.459l-4.193,1.994c-0.647-0.347-1.334-0.632-2.049-0.849l-1.558-4.378C17.165,0.708,16.588,0.667,16,0.667s-1.166,0.041-1.737,0.105L12.707,5.15c-0.716,0.217-1.401,0.502-2.05,0.849L6.464,4.005C5.554,4.73,4.73,5.554,4.005,6.464l1.994,4.192c-0.347,0.648-0.632,1.334-0.849,2.05l-4.378,1.557C0.708,14.834,0.667,15.412,0.667,16s0.041,1.165,0.105,1.736l4.378,1.558c0.217,0.715,0.502,1.401,0.849,2.049l-1.994,4.193c0.725,0.909,1.549,1.733,2.459,2.458l4.192-1.993c0.648,0.347,1.334,0.633,2.05,0.851l1.557,4.377c0.571,0.064,1.148,0.104,1.737,0.104c0.588,0,1.165-0.04,1.736-0.104l1.558-4.377c0.715-0.218,1.399-0.504,2.049-0.851l4.193,1.993c0.909-0.725,1.733-1.549,2.458-2.458l-1.993-4.193c0.347-0.647,0.633-1.334,0.851-2.049L31.229,17.736zM16,20.871c-2.69,0-4.872-2.182-4.872-4.871c0-2.69,2.182-4.872,4.872-4.872c2.689,0,4.871,2.182,4.871,4.872C20.871,18.689,18.689,20.871,16,20.871z"/>',"<title>Link options.</title>","</g>","</g>"].join(""),doubleToolMarkup:void 0,vertexMarkup:['<g class="marker-vertex-group" transform="translate(<%= x %>, <%= y %>)">','<circle class="marker-vertex" idx="<%= idx %>" r="10" />','<path class="marker-vertex-remove-area" idx="<%= idx %>" d="M16,5.333c-7.732,0-14,4.701-14,10.5c0,1.982,0.741,3.833,2.016,5.414L2,25.667l5.613-1.441c2.339,1.317,5.237,2.107,8.387,2.107c7.732,0,14-4.701,14-10.5C30,10.034,23.732,5.333,16,5.333z" transform="translate(5, -33)"/>','<path class="marker-vertex-remove" idx="<%= idx %>" transform="scale(.8) translate(9.5, -37)" d="M24.778,21.419 19.276,15.917 24.777,10.415 21.949,7.585 16.447,13.087 10.945,7.585 8.117,10.415 13.618,15.917 8.116,21.419 10.946,24.248 16.447,18.746 21.948,24.248z">',"<title>Remove vertex.</title>","</path>","</g>"].join(""),arrowheadMarkup:['<g class="marker-arrowhead-group marker-arrowhead-group-<%= end %>">','<path class="marker-arrowhead" end="<%= end %>" d="M 26 0 L 0 13 L 26 26 z" />',"</g>"].join(""),defaultLabel:void 0,labelMarkup:void 0,_builtins:{defaultLabel:{markup:[{tagName:"rect",selector:"rect"},{tagName:"text",selector:"text"}],attrs:{text:{fill:"#000000",fontSize:14,textAnchor:"middle",yAlignment:"middle",pointerEvents:"none"},rect:{ref:"text",fill:"#ffffff",rx:3,ry:3,refWidth:1,refHeight:1,refX:0,refY:0}},position:{distance:.5}}},defaults:{type:"link",source:{},target:{}},isLink:function(){return!0},disconnect:function(t){return this.set({source:{x:0,y:0},target:{x:0,y:0}},t)},source:function(t,e,r){return void 0===t?l(this.get("source")):(n=t instanceof rt?((i=l(e)||{}).id=t.id,r):E(t)?(i=t,e):((i=l(e)||{}).x=t.x,i.y=t.y,r),this.set("source",i,n));var i,n},target:function(t,e,r){return void 0===t?l(this.get("target")):(n=t instanceof rt?((i=l(e)||{}).id=t.id,r):E(t)?(i=t,e):((i=l(e)||{}).x=t.x,i.y=t.y,r),this.set("target",i,n));var i,n},router:function(t,e,r){if(void 0===t){var i=this.get("router");return i?"object"==typeof i?l(i):i:this.get("manhattan")?{name:"orthogonal"}:null}var n="object"==typeof t||"function"==typeof t,o=n?t:{name:t,args:e},s=n?e:r;return this.set("router",o,s)},connector:function(t,e,r){if(void 0===t){var i=this.get("connector");return i?"object"==typeof i?l(i):i:this.get("smooth")?{name:"smooth"}:null}var n="object"==typeof t||"function"==typeof t,o=n?t:{name:t,args:e},s=n?e:r;return this.set("connector",o,s)},label:function(t,e,r){var i=this.labels();return(t=isFinite(t)&&null!==t?0|t:0)<0&&(t=i.length+t),arguments.length<=1?this.prop(["labels",t]):this.prop(["labels",t],e,r)},labels:function(t,e){return 0===arguments.length?(t=this.get("labels"),Array.isArray(t)?t.slice():[]):(Array.isArray(t)||(t=[]),this.set("labels",t,e))},insertLabel:function(t,e,r){if(!e)throw new Error("dia.Link: no label provided");var i=this.labels(),n=i.length;return(t=isFinite(t)&&null!==t?0|t:n)<0&&(t=n+t+1),i.splice(t,0,e),this.labels(i,r)},appendLabel:function(t,e){return this.insertLabel(-1,t,e)},removeLabel:function(t,e){var r=this.labels();return t=isFinite(t)&&null!==t?0|t:-1,r.splice(t,1),this.labels(r,e)},vertex:function(t,e,r){var i=this.vertices();if((t=isFinite(t)&&null!==t?0|t:0)<0&&(t=i.length+t),arguments.length<=1)return this.prop(["vertices",t]);var n=this._normalizeVertex(e);return this.prop(["vertices",t],n,r)},vertices:function(t,e){if(0===arguments.length)return t=this.get("vertices"),Array.isArray(t)?t.slice():[];Array.isArray(t)||(t=[]);for(var r=[],i=0;i<t.length;i++){var n=t[i],o=this._normalizeVertex(n);r.push(o)}return this.set("vertices",r,e)},insertVertex:function(t,e,r){if(!e)throw new Error("dia.Link: no vertex provided");var i=this.vertices(),n=i.length;(t=isFinite(t)&&null!==t?0|t:n)<0&&(t=n+t+1);var o=this._normalizeVertex(e);return i.splice(t,0,o),this.vertices(i,r)},removeVertex:function(t,e){var r=this.vertices();return t=isFinite(t)&&null!==t?0|t:-1,r.splice(t,1),this.vertices(r,e)},_normalizeVertex:function(t){return!E(t)?{x:t.x,y:t.y}:t},translate:function(e,r,t){return(t=t||{}).translateBy=t.translateBy||this.id,t.tx=e,t.ty=r,this.applyToPoints(function(t){return{x:(t.x||0)+e,y:(t.y||0)+r}},t)},scale:function(e,r,i,t){return this.applyToPoints(function(t){return d.Point(t).scale(e,r,i).toJSON()},t)},applyToPoints:function(t,e){if(!C(t))throw new TypeError("dia.Link: applyToPoints expects its first parameter to be a function.");var r={},i=this.source();i.id||(r.source=t(i));var n=this.target();n.id||(r.target=t(n));var o=this.vertices();return 0<o.length&&(r.vertices=o.map(t)),this.set(r,e)},getSourcePoint:function(){var t=this.getSourceCell();return t?t.getPointFromConnectedLink(this,"source"):new d.Point(this.source())},getTargetPoint:function(){var t=this.getTargetCell();return t?t.getPointFromConnectedLink(this,"target"):new d.Point(this.target())},getPointFromConnectedLink:function(){return this.getPolyline().pointAt(.5)},getPolyline:function(){var t=[this.getSourcePoint(),this.getTargetPoint()],e=this.vertices();return 0<e.length&&Array.prototype.push.apply(t,e.map(d.Point)),new d.Polyline(t)},getBBox:function(){return this.getPolyline().bbox()},reparent:function(t){var e;if(this.graph){var r=this.getSourceElement(),i=this.getTargetElement(),n=this.getParentCell();r&&i&&(e=r===i||r.isEmbeddedIn(i)?i:i.isEmbeddedIn(r)?r:this.graph.getCommonAncestor(r,i)),!n||e&&e.id===n.id||n.unembed(this,t),e&&e.embed(this,t)}return e},hasLoop:function(t){t=t||{};var e=this.source().id,r=this.target().id;if(!e||!r)return!1;var i=e===r;if(!i&&t.deep&&this.graph){var n=this.getSourceCell(),o=this.getTargetCell();i=n.isEmbeddedIn(o)||o.isEmbeddedIn(n)}return i},getSourceCell:function(){var t=this.source(),e=this.graph;return t&&t.id&&e&&e.getCell(t.id)||null},getSourceElement:function(){var t=this,e={};do{if(e[t.id])return null;e[t.id]=!0,t=t.getSourceCell()}while(t&&t.isLink());return t},getTargetCell:function(){var t=this.target(),e=this.graph;return t&&t.id&&e&&e.getCell(t.id)||null},getTargetElement:function(){var t=this,e={};do{if(e[t.id])return null;e[t.id]=!0,t=t.getTargetCell()}while(t&&t.isLink());return t},getRelationshipAncestor:function(){var t;if(this.graph){var e=[this,this.getSourceElement(),this.getTargetElement()].filter(function(t){return!!t});t=this.graph.getCommonAncestor.apply(this.graph,e)}return t||null},isRelationshipEmbeddedIn:function(t){var e=D(t)||T(t)?t:t.id,r=this.getRelationshipAncestor();return!!r&&(r.id===e||r.isEmbeddedIn(e))},_getDefaultLabel:function(){var t=this.get("defaultLabel")||this.defaultLabel||{},e={};return e.markup=t.markup||this.get("labelMarkup")||this.labelMarkup,e.position=t.position,e.attrs=t.attrs,e.size=t.size,e}},{endsEqual:function(t,e){var r=t.port===e.port||!t.port&&!e.port;return t.id===e.id&&r}}),yt=mt.define("erd.Entity",{size:{width:150,height:60},attrs:{".outer":{fill:"#2ECC71",stroke:"#27AE60","stroke-width":2,points:"100,0 100,60 0,60 0,0"},".inner":{fill:"#2ECC71",stroke:"#27AE60","stroke-width":2,points:"95,5 95,55 5,55 5,5",display:"none"},text:{text:"Entity","font-family":"Arial","font-size":14,"ref-x":.5,"ref-y":.5,"y-alignment":"middle","text-anchor":"middle"}}},{markup:'<g class="rotatable"><g class="scalable"><polygon class="outer"/><polygon class="inner"/></g><text/></g>'}),xt=yt.define("erd.WeakEntity",{attrs:{".inner":{display:"auto"},text:{text:"Weak Entity"}}}),bt=mt.define("erd.Relationship",{size:{width:80,height:80},attrs:{".outer":{fill:"#3498DB",stroke:"#2980B9","stroke-width":2,points:"40,0 80,40 40,80 0,40"},".inner":{fill:"#3498DB",stroke:"#2980B9","stroke-width":2,points:"40,5 75,40 40,75 5,40",display:"none"},text:{text:"Relationship","font-family":"Arial","font-size":12,"ref-x":.5,"ref-y":.5,"y-alignment":"middle","text-anchor":"middle"}}},{markup:'<g class="rotatable"><g class="scalable"><polygon class="outer"/><polygon class="inner"/></g><text/></g>'}),wt=bt.define("erd.IdentifyingRelationship",{attrs:{".inner":{display:"auto"},text:{text:"Identifying"}}}),kt=mt.define("erd.Attribute",{size:{width:100,height:50},attrs:{ellipse:{transform:"translate(50, 25)"},".outer":{stroke:"#D35400","stroke-width":2,cx:0,cy:0,rx:50,ry:25,fill:"#E67E22"},".inner":{stroke:"#D35400","stroke-width":2,cx:0,cy:0,rx:45,ry:20,fill:"#E67E22",display:"none"},text:{"font-family":"Arial","font-size":14,"ref-x":.5,"ref-y":.5,"y-alignment":"middle","text-anchor":"middle"}}},{markup:'<g class="rotatable"><g class="scalable"><ellipse class="outer"/><ellipse class="inner"/></g><text/></g>'}),Pt=kt.define("erd.Multivalued",{attrs:{".inner":{display:"block"},text:{text:"multivalued"}}}),At=kt.define("erd.Derived",{attrs:{".outer":{"stroke-dasharray":"3,5"},text:{text:"derived"}}}),Ct=kt.define("erd.Key",{attrs:{ellipse:{"stroke-width":4},text:{text:"key","font-weight":"800","text-decoration":"underline"}}}),Et=kt.define("erd.Normal",{attrs:{text:{text:"Normal"}}}),zt=mt.define("erd.ISA",{type:"erd.ISA",size:{width:100,height:50},attrs:{polygon:{points:"0,0 50,50 100,0",fill:"#F1C40F",stroke:"#F39C12","stroke-width":2},text:{text:"ISA","font-size":18,"ref-x":.5,"ref-y":.3,"y-alignment":"middle","text-anchor":"middle"}}},{markup:'<g class="rotatable"><g class="scalable"><polygon/></g><text/></g>'}),Bt=vt.define("erd.Line",{},{cardinality:function(t){this.set("labels",[{position:-20,attrs:{text:{dy:-8,text:t}}}])}});t.Entity=yt,t.WeakEntity=xt,t.Relationship=bt,t.IdentifyingRelationship=wt,t.Attribute=kt,t.Multivalued=Pt,t.Derived=At,t.Key=Ct,t.Normal=Et,t.ISA=zt,t.Line=Bt}(this.joint.shapes.erd=this.joint.shapes.erd||{},Backbone,_,$,V,g);