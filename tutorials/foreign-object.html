<!DOCTYPE html>
<html lang="en">
    <head>

        <meta name="description" content="Create interactive diagrams in JavaScript easily. JointJS plugins for ERD, Org chart, FSA, UML, PN, DEVS, LDM diagrams are ready to use." />

        <link rel="stylesheet" href="css/tutorial.css" />
        <link rel="stylesheet" href="../node_modules/prism-themes/themes/prism-one-light.css">

        <!-- Dependencies: -->
        <script src="../node_modules/jquery/dist/jquery.js"></script>
        <script src="../node_modules/lodash/lodash.js"></script>
        <script src="../node_modules/backbone/backbone.js"></script>


        <link rel="stylesheet" type="text/css" href="../build/joint.min.css" />
        <script type="text/javascript" src="../build/joint.min.js"></script>

        <title>JointJS - JavaScript diagramming library - Getting started.</title>

        <style>
             g[data-type="example.Form"] {
                filter: drop-shadow(0.35rem 0.35rem 0.4rem rgba(0, 0, 0, 0.5));
            }

            form {
                font-size: 16px;
                margin: 1.2rem;
            }

            label {
                display: inline-block;
                margin-bottom: 0.4rem;
            }

            input {
                box-sizing: border-box;
                font-size: inherit;
                margin-bottom: 0.8rem;
                width: 100%;
            }
        </style>

    </head>
    <body class="language-javascript tutorial-page">


        <div id="foreign-object" class="tutorial">

            <h1>Foreign Object</h1>

            <p>
                In the wonderful world of SVG elements, 
                <a href="https://developer.mozilla.org/en-US/docs/Web/SVG/Element/foreignObject" target="_blank"><code>foreignObject</code></a> 
                stands out from the rest as it provides some unique behaviour that other SVG elements do not. SVG, like other XML dialects, is
                namespaced. That means if you want to include elements from a different XML namespace right in your SVG, you need some
                mechanism to enable this functionality. That's where <code>foreignObject</code> comes into play.
            </p>

            <p>
                How does this relate to creating diagrams with JointJS? While JointJS provides a lot of functionality and customization
                for users, we as developers are a habitual bunch. If we want to create some basic interactive elements, we often want to
                reach for technologies we are already familiar with, and in Web land, the dominant force in this regard is still good old HTML.
            </p>

            <p>
                Historically, recommending <code>foreignObject</code> to users of JointJS was a little bit tricky, the main reason for this was the
                inherent lack of support for <code>foreignObject</code> in Internet Explorer. Hence, the difficulty in integrating support into the 
                library due to the requirement of supporting all users, including those who were still using IE. Luckily for us, 
                the days in which we had to support IE are now at an end, and all other major browsers have full support which can be
                seen in the following <a href="https://caniuse.com/?search=foreignObject" target="_blank">caniuse</a> reference table.
            </p>

            <p>
                Now that we can more confidently recommend the use of <code>foreignObject</code> with JointJS, users can now enjoy the benefits of
                HTML in their diagrams. Embedding HTML text in SVG, creating basic interactive elements like buttons, or working
                with HTML inputs should now be a more straightforward process. With this addition, combining the power of JointJS 
                with <code>foreignObject</code> opens up a world of possibilities for interactivity within your JointJS diagrams.
            </p>

            <p>
                In order to get a general idea of how <code>foreignObject</code> can be utilized in SVG, let's start with a simple example without using
                JointJS.
            </p>

            <h3>Using foreignObject</h3>

            <p>
                In the following example, <code>foreignObject</code> is placed within our SVG tag. When using HTML elements within
                <code>foreignObject</code>, note, that it's mandatory to include the XHTML namespace on the outermost element. In 
                this instance, that is our <code>div</code> element. This example creates a simple card-like SVG <code>rect</code>
                element where the user is easily able to select the text.
            </p>

            <pre><code>&lt;svg version="1.1" width="300" height="110" xmlns="http://www.w3.org/2000/svg"&gt;
    &lt;style&gt;
        foreignObject p {
            color: white;
            font: 16px sans-serif;
            margin: 0;
        }
    &lt;/style&gt;
    &lt;rect x="0", width="180" height="100" rx="5" ry="5" fill="#4b5d67" /&gt;
    &lt;foreignObject x="10" y="10" width="160" height="80"&gt;
        &lt;div xmlns="http://www.w3.org/1999/xhtml"&gt;
            &lt;p style="padding: 5px">Lorem ipsum dolor sit amet, consectetur adipiscing elit.&lt;/p&gt;
        &lt;/div&gt;
    &lt;/foreignObject&gt;
&lt;/svg&gt;
</code></pre>

        <svg version="1.1" width="300" height="110" xmlns="http://www.w3.org/2000/svg">
            <style>
                svg {
                    margin-top: 10px;
                }    
                foreignObject p {
                    color: white;
                    font: 16px sans-serif;
                    margin: 0;
                }
            </style>
            <rect x="0", width="180" height="100" rx="5" ry="5" fill="#4b5d67" />
            <foreignObject x="10" y="10" width="160" height="80">
                <div xmlns="http://www.w3.org/1999/xhtml">
                    <p style="padding: 5px">Lorem ipsum dolor sit amet consectetur adipisicing elit.</p>
                </div>
            </foreignObject>
        </svg>

        <p>
            Now that we have a better understanding of what <code>foreignObject</code> is all about, how would we create 
            an equivalent example with JointJS? Using <code>foreignObject</code> with JointJS is much the same as creating any 
            <a href="/tutorial/custom-elements" target="_blank"><code>custom element</code></a> which you can see in the following
            code example.
        </p>

        <pre><code>const namespace = joint.shapes;

const graph = new joint.dia.Graph({}, { cellNamespace: namespace });

const paper = new joint.dia.Paper({
    // paper options
    guard: (evt) => ['P'].includes(evt.target.tagName)
});

const Card = joint.dia.Element.define('example.ForeignObject', {
    attrs: {
        body: {
            width: 'calc(w)',
            height: 'calc(h)',
            stroke: '#4b5d67',
            fill: '#4b5d67',
            strokeWidth: 1,
            rx: 5,
            ry: 5
        },
        foreignObject: {
            width: 160,
            height: 80,
            x: 10,
            y: 10
        }
    },
}, {
    markup: [
        {
            tagName: 'rect',
            selector: 'body'
        },
        {
            tagName: 'foreignObject',
            selector: 'foreignObject',
            children: [
                {
                    tagName: 'div',
                    namespaceURI: 'http://www.w3.org/1999/xhtml',
                    selector: 'content',
                    style: {
                        fontFamily: 'sans-serif',
                        fontSize: 16,
                        color: 'white'
                    },
                    children: [
                        {
                            tagName: 'p',
                            selector: 'textContent',
                            style: {
                                padding: 5,
                                margin: 0
                            },
                            textContent: 'Lorem ipsum dolor sit amet, consectetur adipiscing elit.'
                        }
                    ]
                }
            ]
        }
    ]
});

joint.shapes.example.ForeignObjectView = joint.dia.ElementView.extend();

const card = new Card({
    position: { x: 10, y: 10 },
    attrs: {
        body: { width: 180, height: 100 }
    }
});

card.addTo(graph);
</code></pre>

        <p>
            As mentioned earlier, we would like to create an equivalent example with JointJS, that means selecting text needs
            to be possible. In order to achieve this functionality, we need to use the <code>paper</code>
            <a href="/docs/jointjs#dia.Paper.prototype.options.guard" target="_blank"><code>guard</code></a> option available
            in JointJS to prevent the <code>paper</code> from handling UI events related to <code>&lt;p&gt;</code>
            tags. In our <code>guard</code> function, we can return <code>true</code> if the <code>evt.target.tagName</code> 
            is <code>'P'</code>.
        </p>

        <p>
            While <code>guard</code> will handle events, we also need to allow the user select text via CSS. As the default CSS 
            in JointJS sets the <code>user-select</code> property to <code>'none'</code>, we need to override this on our element.
            The <code>guard</code> option combined the with following CSS override enables users to select text in the same manner 
            as the vanilla SVG example from earlier. We can also adjust the <code>cursor</code> value in order to see the text cursor.
        </p>

        <pre><code>g[data-type="example.ForeignObject"] {
    -webkit-user-select: text;  // prefix needed for Safari
    user-select: text;
}

g[data-type="example.ForeignObject"] p {
    cursor: auto;
}
</code></pre>

        <p>
            As our <code>foreignObject</code> might contain lots of HTML, there are moments when we certainly want to
            be more concise when creating custom elements. Taking advantage of
            <a href="/docs/jointjs#util.svg" target="_blank"><code>util.svg</code></a> in JointJS,
            we can convert a string into a <a href="/docs/jointjs#dia.Cell.markup" target="_blank""><code>markup</code></a>
            object while declaring a <code>Cell</code>. The resulting custom element will be more compact, and maybe easier to
            read for some users.
        </p>

        <pre><code>const Card = joint.dia.Element.define('example.ForeignObject', {
    attrs: {
        body: {
            width: 'calc(w)',
            height: 'calc(h)',
            stroke: '#4b5d67',
            fill: '#4b5d67',
            strokeWidth: 1,
            rx: 5,
            ry: 5
        },
        foreignObject: {
            width: 160,
            height: 80,
            x: 10,
            y: 10
        }
    },
}, {
    // The /* xml */ comment is optional.
    // It is used to tell the IDE that the markup is XML.
    markup: joint.util.svg/* xml */`
        &lt;rect @selector="body"/&gt;
        &lt;foreignObject @selector="foreignObject"&gt;
            &lt;div @selector="content"
                    xmlns="http://www.w3.org/1999/xhtml"
                    style="font-family: sans-serif; font-size: 16px; color: white;"
            &gt;
                &lt;p @selector="textContent"
                    style="margin: 0; padding: 5px"
                &gt;Lorem ipsum dolor sit amet, consectetur adipiscing elit.
                &lt;/p&gt;
            &lt;/div&gt;
        &lt;/foreignObject&gt;
    `
});
</code></pre>

        <h3>Accepting User Input</h3>

        <p>
            While creating a static card-like element was a good introduction to working with <code>foreignObject</code>, a lot
            of users will mostly likely want to work with more interactive elements. One of the most common interactive controls on 
            the web for submitting information is a <code>form</code>, so let's try to create a custom element which accepts some 
            data from the user.
        </p>

        <p>
            The base of our custom element will be much like the previous example. The only difference in terms of element structure
            will be the HTML for our <code>form</code> located within the <code>foreignObject</code> element.
        </p>

        <pre><code>const Form = joint.dia.Element.define('example.Form', {
    attrs: {
        body: {
            width: 'calc(w)',
            height: 'calc(h)',
            fill: 'white',
            rx: 5,
            ry: 5
        },
        foreignObject: {
            width: 'calc(w)',
            height: 'calc(h)',
            x: 0,
            y: 10
        }
    }
}, {
    markup: joint.util.svg/* xml */`
        &lt;rect @selector="body" /&gt;
        &lt;foreignObject @selector="foreignObject"&gt;
            &lt;div @selector="content"
                xmlns="http://www.w3.org/1999/xhtml"
                style="font-family: sans-serif;"
            &gt;
                &lt;form @selector="formContent" id="form"&gt;
                    &lt;label @selector="label" for="name">Name&gt;/label&gt;
                    &lt;input @selector="name" type="text" id="name" name="name"/&gt;
                    &lt;input @selector="submit" type="submit" value="submit"/&gt;
                &lt;/form&gt;
            &lt;/div&gt;
        &lt;/foreignObject&gt;
    `
}, {});
</code></pre>

        <p>
            Just to make our form a little more presentable, we will also add the following CSS.
        </p>

        <pre><code>g[data-type="example.Form"] {
    filter: drop-shadow(0.35rem 0.35rem 0.4rem rgba(0, 0, 0, 0.5));
}

form {
    font-size: 16px;
    margin: 1.2rem;
}

label {
    display: inline-block;
    margin-bottom: 0.4rem;
}

input {
    box-sizing: border-box;
    font-size: inherit;
    margin-bottom: 0.8rem;
    width: 100%;
}   
</code></pre>

        <p>
            The joy of working with <code>foreignObject</code> in our shapes is that we still get to take advantage of some neat functionality such
            as clicking on a <code>label</code> element, and the related <code>input</code> will be focused. In our case, the <code>label</code> has
            the attribute <code></code> which corresponds to the <code>input</code> with the same <code>'id'</code> attribute.
        </p>

        <p>
            We will however need to remove focus when the user clicks on a blank <code>paper</code> area, or on another element. We can do this with
            the following event:
        </p>

        <pre><code>paper.on('blank:pointerdown cell:pointerdown', () => {
        document.activeElement.blur();
});
</code></pre>

        <p>
            Once again, as we want to prevent the <code>paper</code> from handling browser UI events relating to our <code>input</code>,
            we can include it in the paper <code>guard</code> option. Now, we can type normally in our <code>input</code>.
        </p>

        <pre><code>// paper option
guard: (evt) => ['INPUT'].includes(evt.target.tagName)
</code></pre>

        <p>
            At this stage, we have handled most of the functionality related to our events. Mostly likely when using a form, you will want to
            prevent the default browser behaviour when submitting user data. We will simply query our form, and add an event listener. If using
            the <code>paper</code> <code>async</code> option, you may need to update all views in the DOM via the <code>paper</code> 
            <a href="/docs/jointjs#dia.Paper.prototype.dumpViews"><code>dumpViews()</code></a> method.
        </p>

        <pre><code>paper.dumpViews();

const formHTML = document.querySelector('form');
    
formHTML.addEventListener('submit', (e) => {
    e.preventDefault();
});
</code></pre>

        <div class="paper" id="paper-foreign-object"></div>

        <h3>Conclusion</h3>

        <p>
            We believe <code>foreignObject</code> support is a big step forward for JointJS. It will allow our users to create 
            even more innovative and interactive diagramming solutions, and we can't wait to see what they create.
        </p>

        <script src="../node_modules/prismjs/prism.js"></script>

        <script src="js/foreign-object.js"></script>
    </body>
</html>

